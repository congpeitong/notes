<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-07-08 Fri 17:26 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Spring学习笔记（上册）</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="CONGPEITONG" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Spring学习笔记（上册）</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga7aad82">1. spring概述</a>
<ul>
<li><a href="#orge0ec164">1.1. 学习spring原因</a></li>
<li><a href="#org132635a">1.2. 什么是spring</a>
<ul>
<li><a href="#org933872a">1.2.1. 内部技术</a></li>
<li><a href="#org7b7a849">1.2.2. spring集成其它框架</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6271647">2. 控制反转(IOC)与依赖注入(DI)</a>
<ul>
<li><a href="#org0ea7f37">2.1. spring中三个核心概念</a></li>
<li><a href="#org779056c">2.2. 依赖关系</a></li>
<li><a href="#org14573d4">2.3. spring容器</a></li>
<li><a href="#org071b70c">2.4. IOC:控制反转</a></li>
<li><a href="#orgcb17e28">2.5. DI:依赖注入</a></li>
<li><a href="#org800bf62">2.6. 总结</a></li>
</ul>
</li>
<li><a href="#orge30bd9c">3. spring容器基本使用及原理</a>
<ul>
<li><a href="#org92e3ee3">3.1. IOC容器</a>
<ul>
<li><a href="#org40e5f8b">3.1.1. spring IOC 容器是如何知道需要管理哪些对象的</a></li>
</ul>
</li>
<li><a href="#org6d9bf7e">3.2. Bean概念</a></li>
<li><a href="#orgf026444">3.3. spring容器使用步骤</a></li>
<li><a href="#org0d1e296">3.4. spring容器对象</a>
<ul>
<li><a href="#org29ab18f">3.4.1. BeanFactory接口</a></li>
<li><a href="#org68b6613">3.4.2. ApplicationContext接口</a></li>
<li><a href="#org4022dbb">3.4.3. ClassPathXmlApplicationContext类</a></li>
<li><a href="#org802a4c0">3.4.4. AnnotationConfigApplicationContext类</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgf0575f2">4. xml中bean定义详解</a>
<ul>
<li><a href="#org593c681">4.1. bean概念</a></li>
<li><a href="#orgdfa70ae">4.2. bean xml配置文件格式</a></li>
<li><a href="#orgdeb8ede">4.3. bean元素详解</a>
<ul>
<li><a href="#orgd12b926">4.3.1. 作用</a></li>
<li><a href="#org4aaa2f9">4.3.2. 格式</a></li>
</ul>
</li>
<li><a href="#org1a4667a">4.4. 名称和别名详解</a>
<ul>
<li><a href="#orge2a12d9">4.4.1. 名称</a></li>
<li><a href="#org0a6fbe7">4.4.2. 别名</a></li>
</ul>
</li>
<li><a href="#org41625ad">4.5. 通过import元素引入外部配置</a></li>
</ul>
</li>
<li><a href="#org1d8c7d5">5. 容器创建bean实例有多少种</a>
<ul>
<li><a href="#org7bba7f5">5.1. 通过反射调用构造方法创建bean对象</a>
<ul>
<li><a href="#org76f9a98">5.1.1. 语法</a></li>
</ul>
</li>
<li><a href="#org0b0ac62">5.2. 通过静态工厂方法创建bean对象</a>
<ul>
<li><a href="#org48d4b46">5.2.1. 语法</a></li>
</ul>
</li>
<li><a href="#org05ea415">5.3. 通过实例工厂方法创建bean对象</a>
<ul>
<li><a href="#org2573af8">5.3.1. 语法</a></li>
</ul>
</li>
<li><a href="#orgbfc518c">5.4. 通过FactoryBean创建bean对象</a>
<ul>
<li><a href="#org3989ab5">5.4.1. 语法</a></li>
<li><a href="#orgffa700a">5.4.2. 案例</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org68bac2d">6. bean作用域scope详解</a>
<ul>
<li><a href="#org51dd347">6.1. singleton</a>
<ul>
<li><a href="#orgc25db22">6.1.1. 案例</a></li>
<li><a href="#org5eb320d">6.1.2. 单例bean使用注意</a></li>
</ul>
</li>
<li><a href="#org3c0bd03">6.2. prototype</a>
<ul>
<li><a href="#org7d641a3">6.2.1. 案例</a></li>
<li><a href="#org2fc344f">6.2.2. 多例bean使用注意</a></li>
</ul>
</li>
<li><a href="#orgf6069a6">6.3. spring web容器环境独有的三个作用域</a>
<ul>
<li><a href="#org57c60cd">6.3.1. request</a></li>
<li><a href="#org393525d">6.3.2. session</a></li>
<li><a href="#orge66759e">6.3.3. application</a></li>
</ul>
</li>
<li><a href="#orgbce26ea">6.4. 自定义作用域的实现（自定义scope）</a>
<ul>
<li><a href="#orgf454713">6.4.1. 实现scope接口</a></li>
<li><a href="#orgcaba446">6.4.2. 将自定义的scope注册到容器</a></li>
<li><a href="#org5dcf18d">6.4.3. 使用自定义的作用域</a></li>
<li><a href="#org602920d">6.4.4. 实现</a></li>
</ul>
</li>
<li><a href="#orgeae26c9">6.5. 总结</a></li>
</ul>
</li>
<li><a href="#org7ddab30">7. 依赖注入之手动注入</a>
<ul>
<li><a href="#org73616cd">7.1. 什么是依赖</a>
<ul>
<li><a href="#org37e9937">7.1.1. 依赖对象的初始化方式</a></li>
</ul>
</li>
<li><a href="#org1b22f8a">7.2. spring依赖注入</a>
<ul>
<li><a href="#orga3ce396">7.2.1. 通过构造器注入</a></li>
<li><a href="#org3f79e20">7.2.2. setter注入</a></li>
<li><a href="#orgb8eb9ce">7.2.3. 注入特殊类型的对象</a></li>
<li><a href="#org4e5a204">7.2.4. 其它常见类型注入详解</a></li>
</ul>
</li>
<li><a href="#org0b5c383">7.3. 总结</a></li>
</ul>
</li>
<li><a href="#org4c00fb5">8. 依赖注入之自动注入(autowire)详解</a>
<ul>
<li><a href="#org3bb236b">8.1. 手动注入不足</a></li>
<li><a href="#org3f0ef63">8.2. Class.isAssignableFrom方法</a>
<ul>
<li><a href="#orgf58e9d1">8.2.1. 用法</a></li>
</ul>
</li>
<li><a href="#orgb1d3778">8.3. 自动注入</a>
<ul>
<li><a href="#org5881bd7">8.3.1. 按照名称进行注入(byName)</a></li>
<li><a href="#orgf11293e">8.3.2. 按照类型进行自动注入</a></li>
<li><a href="#org2aba135">8.3.3. 注入类型匹配的所有bean(<b>重点</b>)</a></li>
<li><a href="#org1d5639b">8.3.4. 按照构造函数进行自动注入</a></li>
<li><a href="#orgfaa12b2">8.3.5. autowire=default</a></li>
</ul>
</li>
<li><a href="#org98fd13c">8.4. 总结</a></li>
</ul>
</li>
<li><a href="#org4769e69">9. depend-on</a>
<ul>
<li><a href="#org29f5f00">9.1. 无任何依赖bean创建和销毁顺序</a></li>
<li><a href="#orge50cc86">9.2. 通过构造器强依赖bean创建和销毁顺序</a></li>
<li><a href="#orgdf743fd">9.3. 通过depend-on干预bean创建和销毁顺序</a>
<ul>
<li><a href="#org162c44e">9.3.1. depend-on使用方式：</a></li>
</ul>
</li>
<li><a href="#orgffa6c2d">9.4. 总结</a></li>
</ul>
</li>
<li><a href="#org724ba89">10. primary可以解决什么问题？</a>
<ul>
<li><a href="#orgcd8f449">10.1. 问题提出</a></li>
<li><a href="#org1c9d852">10.2. 解决方案</a></li>
<li><a href="#orgb748897">10.3. 示例：</a></li>
</ul>
</li>
<li><a href="#org8979a0b">11. autowire-candidate属性</a></li>
<li><a href="#org229b038">12. lazy-init: bean延迟初始化</a>
<ul>
<li><a href="#org040d246">12.1. bean初始化两种方式</a>
<ul>
<li><a href="#orgc2b627a">12.1.1. bean实时初始化</a></li>
<li><a href="#org1153fbb">12.1.2. bean延迟初始化</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org9714dd2">13. 使用继承简化bean的配置(abstract &amp; parent)</a>
<ul>
<li><a href="#org67756cb">13.1. 案例引入</a></li>
<li><a href="#org80fcc1a">13.2. 通过继承优化代码</a></li>
</ul>
</li>
<li><a href="#orgbe64089">14. lookup-method和replaced-method</a>
<ul>
<li><a href="#org7845a29">14.1. lookup-method: 方法查找</a>
<ul>
<li><a href="#orgb46bb79">14.1.1. 案例回顾</a></li>
<li><a href="#org611521c">14.1.2. 单例bean中使用多例bean:ApplicationContext接口的方式</a></li>
<li><a href="#org24d26c1">14.1.3. 单例bean中使用多例bean: lookup-method方式实现</a></li>
</ul>
</li>
<li><a href="#orgbf9e7a8">14.2. replaced-method: 方法替换</a>
<ul>
<li><a href="#org566fc48">14.2.1. replaced-method的使用3个步骤</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org10e52d0">15. 代理详解（java动态代理&amp;CGLIB代理）</a>
<ul>
<li><a href="#org1be0fcd">15.1. jdk动态代理详解</a>
<ul>
<li><a href="#org5009cfd">15.1.1. java.lang.reflect.Proxy</a></li>
<li><a href="#orgc8d9a12">15.1.2. isProxy方法</a></li>
<li><a href="#orgd548c69">15.1.3. getInvocationHandler方法</a></li>
<li><a href="#org758bb7d">15.1.4. 创建代理：方式1</a></li>
<li><a href="#org44cbb0c">15.1.5. 创建代理：方式2</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgfad9afd">16. java注解</a>
<ul>
<li><a href="#orge1ad8bc">16.1. 什么是注解</a></li>
<li><a href="#orgb9335d4">16.2. 注解的使用方式</a>
<ul>
<li><a href="#orgf709024">16.2.1. 步骤</a></li>
<li><a href="#org57a90e7">16.2.2. 定义注解</a></li>
<li><a href="#orgd6b5da0">16.2.3. 使用注解</a></li>
<li><a href="#org4147f86">16.2.4. 综合案例</a></li>
<li><a href="#org2a28879">16.2.5. @Target(ElementType.TYPE<sub>PARAMETER</sub>)</a></li>
<li><a href="#org5928bb0">16.2.6. @Target(ElementType.TYPE<sub>USE</sub>)</a></li>
</ul>
</li>
<li><a href="#org56036f9">16.3. 注解信息的获取</a>
<ul>
<li><a href="#orgaafa2d5">16.3.1. AnnotateElement</a></li>
<li><a href="#org1bc011c">16.3.2. AnnotateElement常用方法</a></li>
<li><a href="#orgbc3cd5d">16.3.3. 案例</a></li>
</ul>
</li>
<li><a href="#org21de5bc">16.4. @Inherit: 实现类之间的注解继承</a>
<ul>
<li><a href="#org4358b5a">16.4.1. 用法</a></li>
<li><a href="#org1b87ec7">16.4.2. 案例</a></li>
</ul>
</li>
<li><a href="#orgac83d7d">16.5. @Repeatable重复使用注解</a>
<ul>
<li><a href="#org8227d41">16.5.1. 使用步骤</a></li>
</ul>
</li>
<li><a href="#org6181e67">16.6. <code>=以上是Java中对注解的支持，下面是spring中对于注解方面的支持=</code></a></li>
<li><a href="#org3d8dddb">16.7. Spring中对于注解方面的支持</a>
<ul>
<li><a href="#org044f57a">16.7.1. 先瞅一个问题</a></li>
<li><a href="#orgfcb5b54">16.7.2. Spring @AliasFor: 对注解进行增强</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org021a4ed">17. @Configration和@Bean注解</a>
<ul>
<li><a href="#org34df195">17.1. 前言</a></li>
<li><a href="#orgff17e6b">17.2. @Configration注解</a>
<ul>
<li><a href="#orgc857eea">17.2.1. 用法</a></li>
<li><a href="#org369b157">17.2.2. 总结 @Configuration 使用步骤：</a></li>
</ul>
</li>
<li><a href="#org9e12fa0">17.3. @Bean注解</a>
<ul>
<li><a href="#org7e01af7">17.3.1. 用法</a></li>
<li><a href="#orge6703ed">17.3.2. 案例</a></li>
</ul>
</li>
<li><a href="#org28bf29b">17.4. @Configuration加不加到底区别在哪里呢</a></li>
</ul>
</li>
<li><a href="#org5d2ef2e">18. @ComponentScan,@ComponentScans详解</a>
<ul>
<li><a href="#org1eb9956">18.1. 灵魂拷问</a></li>
<li><a href="#orgc05c3cc">18.2. 背景介绍</a></li>
<li><a href="#org1d458d4">18.3. @ComponentScan</a>
<ul>
<li><a href="#orge955255">18.3.1. 注解的定义</a></li>
</ul>
</li>
<li><a href="#orgc295a68">18.4. @Component,@Repository,@Service,@Controller</a>
<ul>
<li><a href="#orgdc916df">18.4.1. @Component注解</a></li>
<li><a href="#org8ec2521">18.4.2. @Repository注解</a></li>
<li><a href="#org5a25609">18.4.3. @Service和@Controller注解源码和@Respository源码类似</a></li>
<li><a href="#org4553381">18.4.4. 总结</a></li>
</ul>
</li>
<li><a href="#org1c42401">18.5. 案例</a>
<ul>
<li><a href="#orgf4d493b">18.5.1. 案例1：任何参数未设置</a></li>
<li><a href="#org07e1385">18.5.2. 案例2： 指定需要扫描的包</a></li>
<li><a href="#org0577b6e">18.5.3. 案例3：basePackageClasses指定扫描范围</a></li>
</ul>
</li>
<li><a href="#org561101e">18.6. includeFilters的使用</a>
<ul>
<li><a href="#orgcbdb167">18.6.1. 用法</a></li>
<li><a href="#org1f59671">18.6.2. 案例：扫描包含注解的类</a></li>
</ul>
</li>
<li><a href="#org131a58c">18.7. 总结</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orga7aad82" class="outline-2">
<h2 id="orga7aad82"><span class="section-number-2">1</span> spring概述</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orge0ec164" class="outline-3">
<h3 id="orge0ec164"><span class="section-number-3">1.1</span> 学习spring原因</h3>
<div class="outline-text-3" id="text-1-1">
<ol class="org-ol">
<li>最大程度简化了开发
spring是一个非常优秀的Java框架，其目的是为了简化Java企业级的开发。</li>
<li>大量公司使用</li>
<li>顶级源码设计
spring框架源码设计非常优秀，在Java开源项目中可以说是顶级的，所以想提升代码能力，强烈建议多看看spring源码，还有jdk源码。</li>
</ol>
</div>
</div>
<div id="outline-container-org132635a" class="outline-3">
<h3 id="org132635a"><span class="section-number-3">1.2</span> 什么是spring</h3>
<div class="outline-text-3" id="text-1-2">
<p>
spring是一个简化Java企业级开发的一个框架，
</p>
</div>
<div id="outline-container-org933872a" class="outline-4">
<h4 id="org933872a"><span class="section-number-4">1.2.1</span> 内部技术</h4>
<div class="outline-text-4" id="text-1-2-1">
<ul class="org-ul">
<li>控制反转</li>
<li>依赖注入</li>
<li>面向切面编程</li>
<li>spring事务管理，</li>
</ul>
</div>
</div>
<div id="outline-container-org7b7a849" class="outline-4">
<h4 id="org7b7a849"><span class="section-number-4">1.2.2</span> spring集成其它框架</h4>
<div class="outline-text-4" id="text-1-2-2">
<ul class="org-ul">
<li>springMVC</li>
<li>springboot</li>
<li>springcloud</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-org6271647" class="outline-2">
<h2 id="org6271647"><span class="section-number-2">2</span> 控制反转(IOC)与依赖注入(DI)</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org0ea7f37" class="outline-3">
<h3 id="org0ea7f37"><span class="section-number-3">2.1</span> spring中三个核心概念</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>控制反转（IOC）</li>
<li>依赖注入（DI）</li>
<li>面向切面编程（AOP）</li>
</ul>
</div>
</div>
<div id="outline-container-org779056c" class="outline-3">
<h3 id="org779056c"><span class="section-number-3">2.2</span> 依赖关系</h3>
<div class="outline-text-3" id="text-2-2">
<p>
当A对象需要调用B对象的方法来实现时，说明A依赖于对象B，A和B是依赖关系。
</p>
</div>
</div>
<div id="outline-container-org14573d4" class="outline-3">
<h3 id="org14573d4"><span class="section-number-3">2.3</span> spring容器</h3>
<div class="outline-text-3" id="text-2-3">
<p>
spring容器的概念，容器可以放很多东西，当我们的程序启动的时候会创建spring容器，会给spring容器一个清单，清单中列出了需要创建的对象以及对象依赖关系，
spring容器会创建和组装好清单中的对象，然后将这些对象存放在spring容器中，当程序中需要使用的时候，可以到容器中查找获取，然后直接使用。
</p>
</div>
</div>
<div id="outline-container-org071b70c" class="outline-3">
<h3 id="org071b70c"><span class="section-number-3">2.4</span> IOC:控制反转</h3>
<div class="outline-text-3" id="text-2-4">
<p>
使用者之前需要一个对象（B）的时候都需要自己去创建和组装所依赖的对象，而现在这些创建和组装都会交给spring容器去帮助完成了，使用者只需要去spring容器中查找需要使用的对象就可以了；
这个过程中B对象的的创建和组装过程被反转了，之前是使用者自己主动去控制的，现在交给spring容器去创建和组装了，对象的构建过程被反转了，所以叫做控制反转；
IOC是面向对象编程中的一种设计原则，主要是为了降低系统代码的耦合度，让系统更加有利于去维护和扩展。
</p>
</div>
</div>
<div id="outline-container-orgcb17e28" class="outline-3">
<h3 id="orgcb17e28"><span class="section-number-3">2.5</span> DI:依赖注入</h3>
<div class="outline-text-3" id="text-2-5">
<p>
依赖注入是spring容器中创建对象时给其设置依赖对象的方式，比如给spring一个清单，清单中列出了需要创建B对象以及其它的一些对象（可能包含了B类型中需要依赖的对象），
此时spring在创建B对象的时候，会看到B对象需要依赖于哪些对象，然后去查找以下清单中有没有包含这些被依赖的对象，如果有就去将其创建好，然后将其传递给B对象；
可能B需要依赖于很多对象，B创建之前完全不需要知道其他对象是否存在或者其它对象在哪里以及被他们是如何创建的，而spring容器会将b依赖对象主动创建好并将其注入到B中去,
比如spring容器创建B的时候，发现B需要依赖于A，那么spring容器在清单中找到A的定义并将其创建好之后，注入到B对象中。
</p>
</div>
</div>
<div id="outline-container-org800bf62" class="outline-3">
<h3 id="org800bf62"><span class="section-number-3">2.6</span> 总结</h3>
<div class="outline-text-3" id="text-2-6">
<ol class="org-ol">
<li>IOC控制反转：它是一种设计理念，将对象的创建和组装的主动权交给了spring容器去做，控制的动作被反转了，降低了系统的耦合度，有利于系统维护和扩展，
主要就是指需要使用的对象的组装的控制权被反转了，之前是自己要做的，现在交给spring容器去做了。</li>
<li>DI依赖注入，表示spring容器中创建对象时给其设置依赖对象的方式，通过某些注入的方式可以让系统更加灵活，比如自动注入等可以让系统变得很灵活。</li>
<li>spring容器：主要负责容器中对象的创建，组装，对象查找，</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orge30bd9c" class="outline-2">
<h2 id="orge30bd9c"><span class="section-number-2">3</span> spring容器基本使用及原理</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org92e3ee3" class="outline-3">
<h3 id="org92e3ee3"><span class="section-number-3">3.1</span> IOC容器</h3>
<div class="outline-text-3" id="text-3-1">
<p>
IOC容器是具有依赖注入功能的容器，负责 <b>对象的实例化</b>  <b>对象的初始化</b>  <b>对象和对象之间依赖关系配置</b>  <b>对象的销毁</b>  <b>对外提供对象的查找</b> 等操作，对象
的整个生命周期都是由容器来控制的。我们需要使用的对象都要都由IOC容器进行管理，不需要我们再去手动通过new的方式去创建对象，由IOC容器直接帮我们
组装好，当我们需要使用的时候直接从IOC容器中直接获取就可以了。
</p>
</div>
<div id="outline-container-org40e5f8b" class="outline-4">
<h4 id="org40e5f8b"><span class="section-number-4">3.1.1</span> spring IOC 容器是如何知道需要管理哪些对象的</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
需要我们给IOC提供一个配置清单，这个配置支持 <b>XML格式</b> 和 <b>Java注解</b> 的方式。在配置文件中列出需要让IOC容器管理的对象，以及可以指定IOC容器如何构建
这些对象的，当spring容器启动的时候，就会去加载这个配置文件，然后将这些对象给组装好以供外部访问者使用。
</p>

<p>
这里所说的IOC容器也叫做spring容器。
</p>
</div>
</div>
</div>

<div id="outline-container-org6d9bf7e" class="outline-3">
<h3 id="org6d9bf7e"><span class="section-number-3">3.2</span> Bean概念</h3>
<div class="outline-text-3" id="text-3-2">
<p>
由spring容器管理的对象统称为Bean对象，Bean就是普通的Java对象，和我们自己new的对象其实是一样的，只是这些对象是由spring去创建和管理的，我们需要在
配置文件中告诉spring容器需要创建哪些bean对象，所以需要先在配置文件中定义好需要创建的bean对象，这些配置统称为bean定义配置元数据信息，spring容器
通过读取这些bean配置元数据信息来构建和组装我们需要的对象。
</p>
</div>
</div>
<div id="outline-container-orgf026444" class="outline-3">
<h3 id="orgf026444"><span class="section-number-3">3.3</span> spring容器使用步骤</h3>
<div class="outline-text-3" id="text-3-3">
<ol class="org-ol">
<li>引入spring相关的maven依赖</li>
<li>创建bean配置文件，比如 bean.xml 配置文件</li>
<li>在bean xml文件中定义好需要spring容器管理的bean对象</li>
<li>创建spring容器，并给spring容器指定需要装载的bean配置文件，当spring容器启动之后，会加载这些配置文件，然后创建好配置文件中定义好的bean对象，
将这些对象放在容器中以供使用</li>
<li>通过容器提供的方法获取容器中的对象，然后使用</li>
</ol>
</div>
</div>
<div id="outline-container-org0d1e296" class="outline-3">
<h3 id="org0d1e296"><span class="section-number-3">3.4</span> spring容器对象</h3>
<div class="outline-text-3" id="text-3-4">
<p>
spring 内部提供了很多spring容器的接口和对象，看几个比较常见的几个容器接口和具体的实现类
</p>
</div>
<div id="outline-container-org29ab18f" class="outline-4">
<h4 id="org29ab18f"><span class="section-number-4">3.4.1</span> BeanFactory接口</h4>
<div class="outline-text-4" id="text-3-4-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframwork</span>.<span style="color: #a45bad;">beans</span>.<span style="color: #a45bad;">factory</span>.BeanFactory
</pre>
</div>
<p>
spring容器中具有代表性的容器就是BeanFactory接口，这个是spring容器的顶层接口，提供了容器最基本的功能
</p>
</div>
<ol class="org-ol">
<li><a id="org0837699"></a>常用的几个方法<br />
<div class="outline-text-5" id="text-3-4-1-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#25353;bean&#30340;id&#25110;&#32773;&#21035;&#21517;&#26597;&#25214;&#23481;&#22120;&#20013;&#30340;bean</span>
<span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #bc6ec5; font-weight: bold;">getBean</span><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">BeansException</span>;
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#36825;&#26159;&#19968;&#20010;&#27867;&#22411;&#26041;&#27861;&#65292;&#25353;&#29031;bean&#30340;id&#25110;&#32773;&#21035;&#21517;&#26597;&#25214;&#25351;&#23450;&#31867;&#22411;&#30340;bean&#65292;&#36820;&#22238;&#25351;&#23450;&#31867;&#22411;&#30340;bean&#23545;&#35937;</span>
<span style="color: #4f97d7;">&lt;</span><span style="color: #ce537a; font-weight: bold;">T</span><span style="color: #4f97d7;">&gt;</span> T getBean<span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span>, <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">T</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">requiredType</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">BeansException</span>;
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#36820;&#22238;&#23481;&#22120;&#20013;&#25351;&#23450;&#31867;&#22411;&#30340;bean&#23545;&#35937;</span>
<span style="color: #4f97d7;">&lt;</span><span style="color: #ce537a; font-weight: bold;">T</span><span style="color: #4f97d7;">&gt;</span> T getBean<span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">T</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">requiredType</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">BeansException</span>;
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#33719;&#21462;&#25351;&#23450;&#31867;&#22411;bean&#23545;&#35937;&#30340;&#33719;&#21462;&#22120;&#65292;&#36825;&#20010;&#26041;&#27861;&#27604;&#36739;&#29305;&#21035;&#20197;&#21518;&#19987;&#38376;&#26469;&#35762;</span>
<span style="color: #4f97d7;">&lt;</span><span style="color: #ce537a; font-weight: bold;">T</span><span style="color: #4f97d7;">&gt;</span> <span style="color: #ce537a; font-weight: bold;">ObjectProvider</span><span style="color: #4f97d7;">&lt;</span><span style="color: #ce537a; font-weight: bold;">T</span><span style="color: #4f97d7;">&gt;</span> getBeanProvider<span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">T</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">requiredType</span><span style="color: #4f97d7;">)</span>;
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org68b6613" class="outline-4">
<h4 id="org68b6613"><span class="section-number-4">3.4.2</span> ApplicationContext接口</h4>
<div class="outline-text-4" id="text-3-4-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframwork</span>.<span style="color: #a45bad;">context</span>.ApplicationContext
</pre>
</div>
<p>
这个接口继承了BeanFactory接口，所以内部包含了BeanFactory所有的功能，并且在其上进行了扩展，增加了很多企业级的功能
</p>
<ul class="org-ul">
<li>AOP</li>
<li>国际化</li>
<li>事件支持</li>
<li>。。。。。</li>
</ul>
</div>
</div>
<div id="outline-container-org4022dbb" class="outline-4">
<h4 id="org4022dbb"><span class="section-number-4">3.4.3</span> ClassPathXmlApplicationContext类</h4>
<div class="outline-text-4" id="text-3-4-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframwor</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">support</span>.Classpathxmlapplicationcontext
</pre>
</div>
<p>
这个类实现了ApplicationContext接口，注意一下这个类名称包含了ClassPath XML,说明了这个容器类可以从ClassPath中加载bean xml配置文件，
然后创建xml中配置的bean对象
</p>
</div>
</div>
<div id="outline-container-org802a4c0" class="outline-4">
<h4 id="org802a4c0"><span class="section-number-4">3.4.4</span> AnnotationConfigApplicationContext类</h4>
<div class="outline-text-4" id="text-3-4-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframwor</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.AnnotationConfigApplicationContext
</pre>
</div>
<p>
这个类也实现了ApplicationContext接口，注意类名包含了Annotation和config这两个单词，上面我们说过，bean的定义支持xml方式和注解方式，
当我们使用注解的方式定义bean的时候，就需要用这个容器来装载了，这个容器内部会解析注解来构建和管理需要的bean。
</p>

<p>
注解的方式相对xml方便一些，也是我们比较推荐的方式，后面我们会大量使用这种方式，具体会详解。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf0575f2" class="outline-2">
<h2 id="orgf0575f2"><span class="section-number-2">4</span> xml中bean定义详解</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org593c681" class="outline-3">
<h3 id="org593c681"><span class="section-number-3">4.1</span> bean概念</h3>
<div class="outline-text-3" id="text-4-1">
<p>
被spring管理的对象统称为bean，我们程序中需要用到很多对象，我们将这些对象让spring去帮我们创建和管理，我们可以通过bean xml配置文件
告诉spring容器需要管理哪些bean,spring帮我们创建和组装好这些bean对象，spring内部将这些名称和具体的bean对象进行绑定，
然后spring容器可以通过这个的名称找对我们需要的对象，这个名称叫做bean名称，
在一个spring容器中需要是唯一的。
</p>
</div>
</div>
<div id="outline-container-orgdfa70ae" class="outline-3">
<h3 id="orgdfa70ae"><span class="section-number-3">4.2</span> bean xml配置文件格式</h3>
<div class="outline-text-3" id="text-4-2">
<p>
bean xml文件用于定义spring容器需要管理的bean，常见的格式如下：
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="color: #4f97d7; font-weight: bold;">xml</span> <span style="color: #9f8766;">version="1.0" encoding="UTF-8"</span>?&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">beans</span> <span style="color: #4f97d7;">xmlns</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans"</span>
        <span style="color: #4f97d7;">xmlns</span>:<span style="color: #7590db;">xsi</span>=<span style="color: #2d9574;">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span style="color: #4f97d7;">xsi</span>:<span style="color: #7590db;">schemaLocation</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans</span>
<span style="color: #2d9574;">        http://www.springframework.org/schema/beans/spring-beans-4.3.xsd"</span>&gt;

        &lt;<span style="color: #bc6ec5; font-weight: bold;">import</span> <span style="color: #7590db;">resource</span>=<span style="color: #2d9574;">"&#24341;&#20837;&#20854;&#20182;bean xml&#37197;&#32622;&#25991;&#20214;"</span> /&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"bean&#26631;&#35782;"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"&#23436;&#25972;&#31867;&#22411;&#21517;&#31216;"</span>/&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">alias</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"bean&#26631;&#35782;"</span> <span style="color: #7590db;">alias</span>=<span style="color: #2d9574;">"&#21035;&#21517;"</span> /&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">beans</span>&gt;
</pre>
</div>
<p>
beans是根元素，下面可以包含任意数量的import，bean，alias元素，下面我们对每个元素进行详解。
</p>
</div>
</div>
<div id="outline-container-orgdeb8ede" class="outline-3">
<h3 id="orgdeb8ede"><span class="section-number-3">4.3</span> bean元素详解</h3>
<div class="outline-text-3" id="text-4-3">
</div>
<div id="outline-container-orgd12b926" class="outline-4">
<h4 id="orgd12b926"><span class="section-number-4">4.3.1</span> 作用</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
用来定义一个bean对象
</p>
</div>
</div>
<div id="outline-container-org4aaa2f9" class="outline-4">
<h4 id="org4aaa2f9"><span class="section-number-4">4.3.2</span> 格式</h4>
<div class="outline-text-4" id="text-4-3-2">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"bean&#21807;&#19968;&#26631;&#35782;"</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"bean&#21517;&#31216;"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"&#23436;&#25972;&#31867;&#22411;&#21517;&#31216;"</span> <span style="color: #7590db;">factory-bean</span>=<span style="color: #2d9574;">"&#24037;&#21378;bean&#21517;&#31216;"</span> <span style="color: #7590db;">factory-method</span>=<span style="color: #2d9574;">"&#24037;&#21378;&#26041;&#27861;"</span>/&gt;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org1a4667a" class="outline-3">
<h3 id="org1a4667a"><span class="section-number-3">4.4</span> 名称和别名详解</h3>
<div class="outline-text-3" id="text-4-4">
</div>
<div id="outline-container-orge2a12d9" class="outline-4">
<h4 id="orge2a12d9"><span class="section-number-4">4.4.1</span> 名称</h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
每个bean都有一个名称，叫做bean名称，bean名称在一个spring容器中必须是唯一的，否则会报错，通过bean名称可以从spring容器中获取对应的bean对象。
</p>
</div>
</div>
<div id="outline-container-org0a6fbe7" class="outline-4">
<h4 id="org0a6fbe7"><span class="section-number-4">4.4.2</span> 别名</h4>
<div class="outline-text-4" id="text-4-4-2">
</div>
<ol class="org-ol">
<li><a id="org1c26d73"></a>什么是别名<br />
<div class="outline-text-5" id="text-4-4-2-1">
<p>
相当于人的外号一样，一个人可能有很多外号，当别人喊这个人的名称和外号的时候，都可以找到这个人。那么bean也是一样，也可以给bean起几个外号，
这个外号在bean中叫做bean的别名，spring容器允许使用者通过名称或者别名获取到对应的bean对象。
</p>
</div>
</li>
<li><a id="org1a0dbef"></a>别名定义规则<br />
<div class="outline-text-5" id="text-4-4-2-2">
<p>
名称和别名可以通过bean元素中的id和name来定义，规则如下
</p>
<ol class="org-ol">
<li>当id存在的时候，不管name有没有，取id为bean的名称。</li>
<li>当id不存在的时候，此时需要看name，name的值可以通过 , ; 空格来分隔，最后会按照分隔符得到一个spring数组，数组的第一个元素作为bean的名称，
其它的作为bean的别名。</li>
<li>当id和name都存在的时候，id未bean名称，name用来定义多个别名</li>
<li>当id和name都不指定的时候,bean名称自动生成，生成规则下面详细说明。</li>
</ol>
</div>
</li>
<li><a id="org70d08d4"></a>bean名称和别名的各种写法<br />
<div class="outline-text-5" id="text-4-4-2-3">
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #2aa1ae; background-color: #292e34;">&lt;!-- </span><span style="color: #2aa1ae; background-color: #292e34;">&#36890;&#36807;id&#23450;&#20041;bean&#21517;&#31216;:user1 </span><span style="color: #2aa1ae; background-color: #292e34;">--&gt;</span>
&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"user1"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.example.UserModel</span><span style="color: #2d9574;">/</span><span style="color: #2d9574;">&gt;</span>

<span style="color: #2d9574;">&lt;!-- &#36890;&#36807;name&#23450;&#20041;bean&#21517;&#31216;&#65306;user2 --&gt;</span>
<span style="color: #2d9574;">&lt;</span><span style="color: #bc6ec5; font-weight: bold;">bean</span><span style="color: #2d9574;"> </span><span style="color: #7590db;">name</span><span style="color: #2d9574;">="</span>user2<span style="color: #2d9574;">" </span><span style="color: #7590db;">class</span><span style="color: #2d9574;">="</span>com.example.UserModel<span style="color: #2d9574;">"</span><span style="color: #2d9574;">/</span><span style="color: #2d9574;">&gt;</span>

<span style="color: #2d9574;">&lt;!-- id&#20026;&#21517;&#31216;&#65292;name&#20026;&#21035;&#21517;&#65307;bean&#21517;&#31216;&#65306;user3,1&#20010;&#21035;&#21517;&#65306;user3_1 --&gt;</span>
<span style="color: #2d9574;">&lt;</span><span style="color: #bc6ec5; font-weight: bold;">bean</span><span style="color: #2d9574;"> </span><span style="color: #7590db;">name</span><span style="color: #2d9574;">="</span>user3<span style="color: #2d9574;">" </span><span style="color: #7590db;">name</span><span style="color: #2d9574;">="</span>user3_1<span style="color: #2d9574;">" </span><span style="color: #7590db;">class</span><span style="color: #2d9574;">="</span>com.example.UserModel<span style="color: #2d9574;">"</span><span style="color: #2d9574;">/</span><span style="color: #2d9574;">&gt;</span>

<span style="color: #2d9574;">&lt;!-- id&#20026;&#21517;&#31216;&#65306;user4, &#22810;&#20010;&#21035;&#21517;&#65306;user4_1,user4_2,user4_3,user4_4 --&gt;</span>
<span style="color: #2d9574;">&lt;</span><span style="color: #bc6ec5; font-weight: bold;">bean</span><span style="color: #2d9574;"> </span><span style="color: #7590db;">id</span><span style="color: #2d9574;">="</span>user4<span style="color: #2d9574;">" </span><span style="color: #7590db;">name</span><span style="color: #2d9574;">="</span>user4_1,user4_2;user4_3 user4_4<span style="color: #2d9574;">" </span><span style="color: #7590db;">class</span><span style="color: #2d9574;">="</span>com.example.UserModel<span style="color: #2d9574;">"</span><span style="color: #2d9574;">/</span><span style="color: #2d9574;">&gt;</span>

<span style="color: #2d9574;">&lt;!-- bean&#21517;&#31216;&#65306;user5, &#21035;&#21517;&#65306;user5_1,user5_2,user5_3,user5_4 --&gt;</span>
<span style="color: #2d9574;">&lt;</span><span style="color: #bc6ec5; font-weight: bold;">bean</span><span style="color: #2d9574;"> </span><span style="color: #7590db;">name</span><span style="color: #2d9574;">="</span>user5,user5_1,user5_2,user5_3,user5_4<span style="color: #2d9574;">" </span><span style="color: #7590db;">class</span><span style="color: #2d9574;">="</span>com.example.UserModel<span style="color: #2d9574;">"</span><span style="color: #2d9574;">/</span><span style="color: #2d9574;">&gt;</span>
</pre>
</div>
<p>
java输出结果
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">Example</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">main</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #2d9574;">[]</span> <span style="color: #7590db;">args</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">1.bean&#37197;&#32622;&#25991;&#20214;&#20301;&#32622;</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">beanXml</span> = <span style="color: #2d9574;">"classpath:/com/example/beans.xml"</span>;
    <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">2.&#21019;&#24314;ClassPathXmlApplicationContext&#23481;&#22120;&#65292;&#32473;&#23481;&#22120;&#25351;&#23450;&#38656;&#35201;&#21152;&#36733;&#30340;bean&#37197;&#32622;&#25991;&#20214;</span>
    <span style="color: #ce537a; font-weight: bold;">ClassPathXmlApplicationContext</span> <span style="color: #7590db;">context</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">ClassPathXmlApplicationContext</span><span style="color: #2d9574;">(</span>beanXml<span style="color: #2d9574;">)</span>;
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">beanName</span> : Arrays.asList<span style="color: #67b11d;">(</span><span style="color: #2d9574;">"user1"</span>, <span style="color: #2d9574;">"user2"</span>, <span style="color: #2d9574;">"user3"</span>, <span style="color: #2d9574;">"user4"</span>,<span style="color: #2d9574;">"user5"</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
      <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">&#33719;&#21462;bean&#30340;&#21035;&#21517;</span>
      <span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #67b11d;">[]</span> <span style="color: #7590db;">aliases</span> = context.getAliases<span style="color: #67b11d;">(</span>beanName<span style="color: #67b11d;">)</span>;
      System.out.println<span style="color: #67b11d;">(</span>String.format<span style="color: #b1951d;">(</span><span style="color: #2d9574;">"beanName:%s,&#21035;&#21517;:[%s]"</span>, beanName,String.join<span style="color: #4f97d7;">(</span><span style="color: #2d9574;">","</span>, aliases<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>;
    <span style="color: #2d9574;">}</span>
    System.out.println<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"spring&#23481;&#22120;&#20013;&#25152;&#26377;bean&#22914;&#19979;&#65306;"</span><span style="color: #2d9574;">)</span>;
    <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">getBeanDefinitionNames&#29992;&#20110;&#33719;&#21462;&#23481;&#22120;&#20013;&#25152;&#26377;bean&#30340;&#21517;&#31216;</span>
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">beanName</span> : context.getBeanDefinitionNames<span style="color: #67b11d;">()</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
      <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">&#33719;&#21462;bean&#30340;&#21035;&#21517;</span>
      <span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #67b11d;">[]</span> <span style="color: #7590db;">aliases</span> = context.getAliases<span style="color: #67b11d;">(</span>beanName<span style="color: #67b11d;">)</span>;
      System.out.println<span style="color: #67b11d;">(</span>String.format<span style="color: #b1951d;">(</span><span style="color: #2d9574;">"beanName:%s,&#21035;&#21517;:[%s]"</span>, beanName,String.join<span style="color: #4f97d7;">(</span><span style="color: #2d9574;">","</span>, aliases<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>;
    <span style="color: #2d9574;">}</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="org4563853"></a>id和name都未指定<br />
<div class="outline-text-6" id="text-4-4-2-3-1">
<p>
当id和name都未指定的时候，bean名称和别名由spring自动生成。
</p>
</div>
<ol class="org-ol">
<li><a id="orge390004"></a>bean名称为<br />
<div class="outline-text-7" id="text-4-4-2-3-1-1">
<p>
bean的class的完整类名#编号
</p>

<p>
编号是从0开始的同种类型的没有定义名称的依次递增。
</p>
</div>
</li>
<li><a id="org4d73406"></a>别名为完整的类名<br /></li>
</ol>
</li>
<li><a id="orga491ace"></a>alias元素<br />
<div class="outline-text-6" id="text-4-4-2-3-2">
<p>
alias元素也剋用来给某个bean定义别名，语法为：
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">alias</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"&#38656;&#35201;&#23450;&#20041;&#21035;&#21517;&#30340;bean"</span> <span style="color: #7590db;">alias</span>=<span style="color: #2d9574;">"&#21035;&#21517;"</span>/&gt;
<span style="color: #2aa1ae; background-color: #292e34;">&lt;!-- </span><span style="color: #2aa1ae; background-color: #292e34;">&#20363;&#22914; </span><span style="color: #2aa1ae; background-color: #292e34;">--&gt;</span>
&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"user6"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.javacode2018.lesson001.demo2.UserModel"</span> /&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">alias</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"user6"</span> <span style="color: #7590db;">alias</span>=<span style="color: #2d9574;">"user6_1"</span> /&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">alias</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"user6"</span> <span style="color: #7590db;">alias</span>=<span style="color: #2d9574;">"user6_2"</span> /&gt;
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
</div>
<div id="outline-container-org41625ad" class="outline-3">
<h3 id="org41625ad"><span class="section-number-3">4.5</span> 通过import元素引入外部配置</h3>
<div class="outline-text-3" id="text-4-5">
<p>
当我们的系统比较大的时候，会分成很多模块，每个模块会对应一个bean xml文件，我们可以在一个总的bean xml中对其它bean xml进行汇总，相当于把多个bean xmln
内容合并到了一个里面，可以通过import元素引入其它bean配置文件。
</p>

<p>
语法：
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">import</span> <span style="color: #7590db;">resource</span>=<span style="color: #2d9574;">"&#20854;&#23427;&#37197;&#32622;&#25991;&#20214;&#30340;&#20301;&#32622;"</span>/&gt;
<span style="color: #2aa1ae; background-color: #292e34;">&lt;!-- </span><span style="color: #2aa1ae; background-color: #292e34;">&#20363;&#22914; </span><span style="color: #2aa1ae; background-color: #292e34;">--&gt;</span>
&lt;?<span style="color: #4f97d7; font-weight: bold;">xml</span> <span style="color: #9f8766;">version="1.0" encoding="UTF-8"</span>?&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">beans</span> <span style="color: #4f97d7;">xmlns</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans"</span>
<span style="color: #4f97d7;">xmlns</span>:<span style="color: #7590db;">xsi</span>=<span style="color: #2d9574;">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span style="color: #4f97d7;">xsi</span>:<span style="color: #7590db;">schemaLocation</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans</span>
<span style="color: #2d9574;">http://www.springframework.org/schema/beans/spring-beans-4.3.xsd"</span>&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">import</span> <span style="color: #7590db;">resource</span>=<span style="color: #2d9574;">"user.xml"</span> /&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">import</span> <span style="color: #7590db;">resource</span>=<span style="color: #2d9574;">"order.xml"</span> /&gt;

&lt;/<span style="color: #bc6ec5; font-weight: bold;">beans</span>&gt;
</pre>
</div>

<p>
*
</p>
</div>
</div>
</div>

<div id="outline-container-org1d8c7d5" class="outline-2">
<h2 id="org1d8c7d5"><span class="section-number-2">5</span> 容器创建bean实例有多少种</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org7bba7f5" class="outline-3">
<h3 id="org7bba7f5"><span class="section-number-3">5.1</span> 通过反射调用构造方法创建bean对象</h3>
<div class="outline-text-3" id="text-5-1">
<p>
调用类的构造方法获取对应的bean实例，是使用最多的方式，这种方式只需要在xml bean元素中指定class属性,spring容器内部自动会自动调用该类型的构造方法来创建bean对象，将其放在容器中以供使用。
</p>
</div>
<div id="outline-container-org76f9a98" class="outline-4">
<h4 id="org76f9a98"><span class="section-number-4">5.1.1</span> 语法</h4>
<div class="outline-text-4" id="text-5-1-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"bean&#21517;&#31216;"</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"bean&#21517;&#31216;&#25110;&#21035;&#21517;"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"bean&#30340;&#23436;&#25972;&#31867;&#22411;&#21517;&#31216;"</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"0"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span> /&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"1"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span> /&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"2"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span> /&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"3"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span> /&gt;
  ......
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"4"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span> /&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
</pre>
</div>
<ul class="org-ul">
<li>constructor-arg: 用于指定构造方法参数的值</li>
<li>index: 构造方法中参数的位置，从0开始，依次递增</li>
<li>value: 指定参数的值</li>
<li>ref: 当插入的值为容器内其它bean的时候，这个值为容器中对应的bean的名称</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org0b0ac62" class="outline-3">
<h3 id="org0b0ac62"><span class="section-number-3">5.2</span> 通过静态工厂方法创建bean对象</h3>
<div class="outline-text-3" id="text-5-2">
<p>
我们可以通过创建静态工厂，内部提供一些静态方法来生成所需的对象，将这些静态方法创建的对象交给spring以供使用.
</p>
</div>
<div id="outline-container-org48d4b46" class="outline-4">
<h4 id="org48d4b46"><span class="section-number-4">5.2.1</span> 语法</h4>
<div class="outline-text-4" id="text-5-2-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"bean&#21517;&#31216;"</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"&#38745;&#24577;&#24037;&#21378;&#23436;&#25972;&#31867;&#21517;"</span> <span style="color: #7590db;">factory-method</span>=<span style="color: #2d9574;">"&#38745;&#24577;&#24037;&#21378;&#26041;&#27861;"</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"0"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span> /&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"1"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span> /&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"2"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span> /&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"3"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span> /&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
</pre>
</div>
<ul class="org-ul">
<li>class: 指定静态工厂完整的类名</li>
<li>factory-method: 静态工厂中的静态方法，返回需要的对象</li>
<li>constructor-arg: 用于指定静态方法参数的值，用法和上面介绍的构造方法一样</li>
</ul>
<p>
spring容器会自动调用静态工厂的静态方法获取指定的对象，将其放在容器中以供使用
</p>
</div>
</div>
</div>
<div id="outline-container-org05ea415" class="outline-3">
<h3 id="org05ea415"><span class="section-number-3">5.3</span> 通过实例工厂方法创建bean对象</h3>
<div class="outline-text-3" id="text-5-3">
<p>
让spring容器去调用某些对象的某些实例方法来生成bean对象放在容器中以供使用。
</p>
</div>
<div id="outline-container-org2573af8" class="outline-4">
<h4 id="org2573af8"><span class="section-number-4">5.3.1</span> 语法</h4>
<div class="outline-text-4" id="text-5-3-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"bean&#21517;&#31216;"</span> <span style="color: #7590db;">factory-bean</span>=<span style="color: #2d9574;">"&#38656;&#35201;&#35843;&#29992;&#30340;&#23454;&#20363;&#23545;&#35937;bean&#21517;&#31216;"</span> <span style="color: #7590db;">factory-method</span>=<span style="color: #2d9574;">"bean&#23545;&#35937;&#20013;&#30340;&#26041;&#27861;"</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"0"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"1"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"2"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"3"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"4"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"bean&#30340;&#20540;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
</pre>
</div>
<p>
spring容器以 <b>factory-bean 的值为bean名称查找对应的bean对象，然后调用该对象中 *factory-method</b> 属性值指定的方法，将这个方法返回的对象作为当前的bean对象放在容器中以供使用。
</p>
</div>
</div>
</div>
<div id="outline-container-orgbfc518c" class="outline-3">
<h3 id="orgbfc518c"><span class="section-number-3">5.4</span> 通过FactoryBean创建bean对象</h3>
<div class="outline-text-3" id="text-5-4">
<p>
前面说到了BeanFactor接口，BeanFactory是spring容器的顶层接口，而这里要说的是FactoryBean，也是一个接口，这两个接口很容器混淆，FactoryBean可以容器spring容器通过这个接口
的实现来创建我们需要的bean对象。
</p>

<p>
FactoryBean接口源码：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">interface</span> <span style="color: #ce537a; font-weight: bold;">FactoryBean</span><span style="color: #4f97d7;">&lt;</span><span style="color: #ce537a; font-weight: bold;">T</span><span style="color: #4f97d7;">&gt;</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #9f8766;">/**</span>
<span style="color: #9f8766;">   * &#36820;&#22238;&#21019;&#24314;&#22909;&#30340;&#23545;&#35937;</span>
<span style="color: #9f8766;">  */</span>
  <span style="color: #a45bad;">@Nullable</span>
  <span style="color: #ce537a; font-weight: bold;">T</span> <span style="color: #bc6ec5; font-weight: bold;">getObject</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">Exception</span>;
  <span style="color: #9f8766;">/**</span>
<span style="color: #9f8766;">  * &#36820;&#22238;&#38656;&#35201;&#21019;&#24314;&#30340;&#23545;&#35937;&#30340;&#31867;&#22411;</span>
<span style="color: #9f8766;">  */</span>
  <span style="color: #a45bad;">@Nullable</span>
  <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span>?<span style="color: #bc6ec5;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">getObjectType</span><span style="color: #bc6ec5;">()</span>;
  <span style="color: #9f8766;">/**</span>
<span style="color: #9f8766;">  * bean&#26159;&#21542;&#26159;&#21333;&#20363;&#30340;</span>
<span style="color: #9f8766;">  */</span>
  <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #ce537a; font-weight: bold;">boolean</span> <span style="color: #bc6ec5; font-weight: bold;">isSingleton</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">true</span>;
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
接口中有三个方法，前面两个方法需要我们去实现，getObject方法内部由开发者自己去实现对象的创建，然后将创建好的对象返回给spring容器，
getObjectType需要指定我们创建的bean类型；最后一个方法isSingleton表示通过这个接口创建的对象是否是单例的，如果返回false,那么每次
从容器中获取对象的时候都会调用这个接口的getObject()去生成bean对象。
</p>
</div>
<div id="outline-container-org3989ab5" class="outline-4">
<h4 id="org3989ab5"><span class="section-number-4">5.4.1</span> 语法</h4>
<div class="outline-text-4" id="text-5-4-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"bean&#21517;&#31216;"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"FactoryBean&#25509;&#21475;&#23454;&#29616;&#31867;"</span> /&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-orgffa700a" class="outline-4">
<h4 id="orgffa700a"><span class="section-number-4">5.4.2</span> 案例</h4>
<div class="outline-text-4" id="text-5-4-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UserFactoryBean</span> <span style="color: #4f97d7; font-weight: bold;">implements</span> <span style="color: #ce537a; font-weight: bold;">FactoryBean</span><span style="color: #4f97d7;">&lt;</span><span style="color: #ce537a; font-weight: bold;">UserModel</span><span style="color: #4f97d7;">&gt;</span> <span style="color: #4f97d7;">{</span>

  <span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #7590db;">count</span> = 1;

  <span style="color: #a45bad;">@Nullable</span>
  <span style="color: #a45bad;">@Override</span>
  <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">UserModel</span> <span style="color: #bc6ec5; font-weight: bold;">getObject</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">Exception</span> <span style="color: #bc6ec5;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
    <span style="color: #ce537a; font-weight: bold;">UserModel</span> <span style="color: #7590db;">userModel</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">UserModel</span><span style="color: #2d9574;">()</span>;
    userModel.setName<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"&#25105;&#26159;&#36890;&#36807;FactoryBean&#21019;&#24314;&#30340;&#31532;"</span> + count + <span style="color: #2d9574;">"&#23545;&#35937;"</span><span style="color: #2d9574;">)</span>; <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">@4</span>
    <span style="color: #4f97d7; font-weight: bold;">return</span> userModel;
  <span style="color: #bc6ec5;">}</span>

  <span style="color: #a45bad;">@Nullable</span>
  <span style="color: #a45bad;">@Override</span>
  <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span>?<span style="color: #bc6ec5;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">getObjectType</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">return</span> UserModel.<span style="color: #4f97d7; font-weight: bold;">class</span>; <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
  <span style="color: #bc6ec5;">}</span>

  <span style="color: #a45bad;">@Override</span>
  <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">boolean</span> <span style="color: #bc6ec5; font-weight: bold;">isSingleton</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">true</span>; <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@3</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<ul class="org-ul">
<li>@1: 返回了一个创建好的usermodel对象</li>
<li>@2： 返回对象的Class对象</li>
<li>@3： 返回true，表示创建的对象是单例的，那么我们每次从容器中获取这个对象的时候都是同一个对象</li>
<li>@4： 此处用到了一个count,通过这个可以看出isSingleton不同返回值的时候从容器获取bean是否是同一个。</li>
</ul>
</div>
<ol class="org-ol">
<li><a id="org810f580"></a>bean xml配置<br />
<div class="outline-text-5" id="text-5-4-2-1">
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #2aa1ae; background-color: #292e34;">&lt;!-- </span><span style="color: #2aa1ae; background-color: #292e34;">&#36890;&#36807;FactoryBean &#21019;&#24314;UserModel&#23545;&#35937; </span><span style="color: #2aa1ae; background-color: #292e34;">--&gt;</span>
&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"createByFactoryBean"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.example.UserFactoryBean"</span>/&gt;
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org68bac2d" class="outline-2">
<h2 id="org68bac2d"><span class="section-number-2">6</span> bean作用域scope详解</h2>
<div class="outline-text-2" id="text-6">
<p>
应用中，有时候我们需要一个对象在整个应用中只有一个，有些对象希望每次使用的时候都重新创建一个，spring对我们这种需求也提供了支持，在spring中这个叫做bean的作用域，
xml中定义bean的时候，可以通过scope属性指定bean的作用域；
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">scope</span>=<span style="color: #2d9574;">"&#20316;&#29992;&#22495;"</span> /&gt;
</pre>
</div>
</div>
<div id="outline-container-org51dd347" class="outline-3">
<h3 id="org51dd347"><span class="section-number-3">6.1</span> singleton</h3>
<div class="outline-text-3" id="text-6-1">
<p>
当scope的值设置为singleton的时候，整个spring容器只会存在一个bean实例，通过容器多次查找bean的时候(调用BeanFactory的getBean方法或者bean之间注入依赖的bean对象的时候)，
返回的都是同一个bean对象，singleton是scope的默认值，所以spring容器中默认创建的bean对象是单例的，通常spring容器在启动的时候，会将scope为singleton的bean创建好放在容器中
(有个特殊的情况，当bean的lazy为true的时候，表示懒加载，那么使用的时候才会创建),用的时候直接返回。
</p>
</div>
<div id="outline-container-orgc25db22" class="outline-4">
<h4 id="orgc25db22"><span class="section-number-4">6.1.1</span> 案例</h4>
<div class="outline-text-4" id="text-6-1-1">
</div>
<ol class="org-ol">
<li><a id="org7a99679"></a>bean xml配置<br />
<div class="outline-text-5" id="text-6-1-1-1">
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #2aa1ae; background-color: #292e34;">&lt;!-- </span><span style="color: #2aa1ae; background-color: #292e34;">&#21333;&#20363;bean&#65292;scope&#35774;&#32622;&#20026;singleton </span><span style="color: #2aa1ae; background-color: #292e34;">--&gt;</span>
&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"singletonBean"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo4.BeanScopeModel"</span> <span style="color: #7590db;">scope</span>=<span style="color: #2d9574;">"singleton"</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"0"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"singleton"</span>/&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
</pre>
</div>
</div>
</li>
<li><a id="orgf4a3374"></a>BeanScopeModel代码<br />
<div class="outline-text-5" id="text-6-1-1-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">BeanScopeModel</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #bc6ec5; font-weight: bold;">BeanScopeModel</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">beanScope</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span>String.format<span style="color: #67b11d;">(</span><span style="color: #2d9574;">"create BeanScopeModel,{sope=%s},{this=%s}"</span>, beanScope, <span style="color: #4f97d7; font-weight: bold;">this</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
上面构造方法中输出了一段文字，是从容器中获取bean的时候创建的还是容器启动的时候创建的。（启动时）
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org5eb320d" class="outline-4">
<h4 id="org5eb320d"><span class="section-number-4">6.1.2</span> 单例bean使用注意</h4>
<div class="outline-text-4" id="text-6-1-2">
<p>
单例bean是整个应用共享的，所以需要考虑到线程安全的问题，之前在玩springMVC的时候，springMVC中的controller默认是单例的，有些开发者在controller中创建了一些变量，那么这些变量实际上就变成共享的了，
controller可能会被很多线程同时访问，这些线程并发去修改controller中的共享变量，可能会出现数据错乱的问题，所以使用的时候需要特别注意。
</p>
</div>
</div>
</div>

<div id="outline-container-org3c0bd03" class="outline-3">
<h3 id="org3c0bd03"><span class="section-number-3">6.2</span> prototype</h3>
<div class="outline-text-3" id="text-6-2">
<p>
如果scope被设置成prototype类型了，表示这个bean是多例的，通过容器每次获取的bean都是不同的实例，每次获取都会重新创建一个bean实例对象。
</p>
</div>
<div id="outline-container-org7d641a3" class="outline-4">
<h4 id="org7d641a3"><span class="section-number-4">6.2.1</span> 案例</h4>
<div class="outline-text-4" id="text-6-2-1">
</div>
<ol class="org-ol">
<li><a id="org54c1f53"></a>bean xml配置<br />
<div class="outline-text-5" id="text-6-2-1-1">
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #2aa1ae; background-color: #292e34;">&lt;!-- </span><span style="color: #2aa1ae; background-color: #292e34;">&#22810;&#20363;bean&#65292;scope&#34987;&#35774;&#32622;&#20026;prototype </span><span style="color: #2aa1ae; background-color: #292e34;">--&gt;</span>
&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"prototypeBean"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo4.BeanScopeModel"</span> <span style="color: #7590db;">scope</span>=<span style="color: #2d9574;">"prototype"</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"0"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"prototype"</span>/&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org2fc344f" class="outline-4">
<h4 id="org2fc344f"><span class="section-number-4">6.2.2</span> 多例bean使用注意</h4>
<div class="outline-text-4" id="text-6-2-2">
<p>
多例bean每次获取的时候都会重新创建,如果这个bean比较复杂，创建时间比较长，会影响系统的性能，这个地方需要注意
</p>
</div>
</div>
</div>
<div id="outline-container-orgf6069a6" class="outline-3">
<h3 id="orgf6069a6"><span class="section-number-3">6.3</span> spring web容器环境独有的三个作用域</h3>
<div class="outline-text-3" id="text-6-3">
</div>
<div id="outline-container-org57c60cd" class="outline-4">
<h4 id="org57c60cd"><span class="section-number-4">6.3.1</span> request</h4>
<div class="outline-text-4" id="text-6-3-1">
<p>
当一个bean的作用域为request时，表示再一次http请求中，一个bean对应一个实例；对每个http请求都会创建一个bean实例,request结束的时候，
这个bean也就结束了，request作用域用在spring容器的web环境中，这个以后讲springMVC的时候就会说,spring中有个web容器接口webapplicationcontext，
这个里面对request作用域提供了支持,配置方式如下：
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">scope</span>=<span style="color: #2d9574;">"request"</span> /&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org393525d" class="outline-4">
<h4 id="org393525d"><span class="section-number-4">6.3.2</span> session</h4>
<div class="outline-text-4" id="text-6-3-2">
<p>
这个和request类似，也是用在web环境中，session级别共享的bean,每个会话对应一个bean实例，不同的session对应不同的bean实例，springMVC中会提到
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">scope</span>=<span style="color: #2d9574;">"session"</span> /&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-orge66759e" class="outline-4">
<h4 id="orge66759e"><span class="section-number-4">6.3.3</span> application</h4>
<div class="outline-text-4" id="text-6-3-3">
<p>
全局web应用级别的作用域，也是web环境中使用，一个web应用程序对应一个bean实例，通常情况下和singleton效果类似，不过也有不一样的地方，singleton
是每个spring容器中只有一个bean实例，一般我们的程序只有一个spring容器，但是，一个应用程序中可以创建多个spring容器，不同的容器中可以存在同名的bean，
但是scope=application的时候，不管应用中有多少个spring容器，这个应用中同名的bean只有一个。
</p>
</div>
</div>
</div>
<div id="outline-container-orgbce26ea" class="outline-3">
<h3 id="orgbce26ea"><span class="section-number-3">6.4</span> 自定义作用域的实现（自定义scope）</h3>
<div class="outline-text-3" id="text-6-4">
</div>
<div id="outline-container-orgf454713" class="outline-4">
<h4 id="orgf454713"><span class="section-number-4">6.4.1</span> 实现scope接口</h4>
<div class="outline-text-4" id="text-6-4-1">
<p>
#+begin<sub>src</sub> java
public interface Scope {
  /**
</p>
<ul class="org-ul">
<li>返回当前作用域中name对应的bean对象</li>
<li>name：需要检索的bean的名称</li>
<li>objectFactory：如果name对应的bean在当前作用域中没有找到，那么可以调用这个ObjectFactory来创建这个对象</li>
</ul>
<p>
**/
Object get(String name, ObjectFactory&lt;?&gt; objectFactory);
/**
</p>
<ul class="org-ul">
<li>将name对应的bean从当前作用域中移除</li>
</ul>
<p>
**/
@Nullable
Object remove(String name);
/**
</p>
<ul class="org-ul">
<li>用于注册销毁回调，如果想要销毁相应的对象,则由Spring容器注册相应的销毁回调，而由自定义作用域选择是不是要销毁相应的对象</li>
</ul>
<p>
*/
void registerDestructionCallback(String name, Runnable callback);
/**
</p>
<ul class="org-ul">
<li>用于解析相应的上下文数据，比如request作用域将返回request中的属性。</li>
</ul>
<p>
*/
@Nullable
Object resolveContextualObject(String key);
/**
</p>
<ul class="org-ul">
<li>作用域的会话标识，比如session作用域将是sessionId</li>
</ul>
<p>
  */
  @Nullable
  String getConversationId();
}
```
</p>
</div>
</div>
<div id="outline-container-orgcaba446" class="outline-4">
<h4 id="orgcaba446"><span class="section-number-4">6.4.2</span> 将自定义的scope注册到容器</h4>
<div class="outline-text-4" id="text-6-4-2">
<p>
需要调用 <b>org.springframework.beans.factory.ConfigurableBeanFactory#registerScope</b> 的方法，看一下这个方法的声明。
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #9f8766;">/**</span>
<span style="color: #9f8766;">*&#21521;&#23481;&#22120;&#20013;&#27880;&#20876;&#33258;&#23450;&#20041;&#30340;scope</span>
<span style="color: #9f8766;">*scopeName: &#20316;&#29992;&#22495;&#21517;&#31216;</span>
<span style="color: #9f8766;">*scope:&#20316;&#29992;&#22495;&#23545;&#35937;</span>
<span style="color: #9f8766;">**/</span>
<span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">registerScope</span><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">scopeName</span>, <span style="color: #ce537a; font-weight: bold;">Scope</span> <span style="color: #7590db;">scope</span><span style="color: #4f97d7;">)</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-org5dcf18d" class="outline-4">
<h4 id="org5dcf18d"><span class="section-number-4">6.4.3</span> 使用自定义的作用域</h4>
<div class="outline-text-4" id="text-6-4-3">
<p>
定义bean的时候，指定bean的scope属性为自定义的作用域名称。
</p>
</div>
</div>
<div id="outline-container-org602920d" class="outline-4">
<h4 id="org602920d"><span class="section-number-4">6.4.4</span> 实现</h4>
<div class="outline-text-4" id="text-6-4-4">
<p>
实现一个线程级别的bean作用域，同一个线程中同名的bean是同一个实例，不同的线程中的bean是不同的实例，
</p>
</div>
<ol class="org-ol">
<li><a id="org0a0e1cd"></a>需求中要求bean在线程中是贡献的，所以我们可以通过ThreadLocal来实现，ThreadLocal可以实现线程中数据的共享。<br /></li>
<li><a id="org314c80f"></a>代码ThreadScope.java<br />
<div class="outline-text-5" id="text-6-4-4-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ThreadScope</span> <span style="color: #4f97d7; font-weight: bold;">implements</span> <span style="color: #ce537a; font-weight: bold;">Scope</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">final</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">THREAD_SCOPE</span> = <span style="color: #2d9574;">"thread"</span>; <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">ThreadLocal</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">Map</span><span style="color: #2d9574;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span>,<span style="color: #ce537a; font-weight: bold;">Ojbect</span><span style="color: #2d9574;">&gt;</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">beanMap</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">ThreadLocal</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
            <span style="color: #a45bad;">@override</span>
            <span style="color: #4f97d7; font-weight: bold;">protected</span> <span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #bc6ec5; font-weight: bold;">initiaValue</span><span style="color: #2d9574;">()</span> <span style="color: #2d9574;">{</span>
                <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">HashMap</span><span style="color: #67b11d;">&lt;&gt;()</span>;
            <span style="color: #2d9574;">}</span>
        <span style="color: #bc6ec5;">}</span>;
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #bc6ec5; font-weight: bold;">get</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span>, <span style="color: #ce537a; font-weight: bold;">ObjectFactory</span><span style="color: #2d9574;">&lt;</span>?<span style="color: #2d9574;">&gt;</span> <span style="color: #7590db;">objectFactory</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #7590db;">bean</span> = beanMap.get<span style="color: #2d9574;">()</span>.get<span style="color: #2d9574;">(</span>name<span style="color: #2d9574;">)</span>;
        <span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span>Objects.isNull<span style="color: #67b11d;">(</span>bean<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
            bean = objectFactory.getObject<span style="color: #67b11d;">()</span>;
            beanMap.get<span style="color: #67b11d;">()</span>.put<span style="color: #67b11d;">(</span>name, bean<span style="color: #67b11d;">)</span>;
        <span style="color: #2d9574;">}</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> bean;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #a45bad;">@Nullable</span>
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #bc6ec5; font-weight: bold;">remove</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">this</span>.beanMap.get<span style="color: #2d9574;">()</span>.remove<span style="color: #2d9574;">(</span>name<span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">registerDestructionCallback</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span>, <span style="color: #ce537a; font-weight: bold;">Runnable</span> <span style="color: #7590db;">callback</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">bean&#20316;&#29992;&#22495;&#33539;&#22260;&#32467;&#26463;&#30340;&#26102;&#20505;&#35843;&#29992;&#30340;&#26041;&#27861;&#65292;&#29992;&#20110;bean&#28165;&#29702;</span>
        System.out.println<span style="color: #2d9574;">(</span>name<span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #a45bad;">@Nullable</span>
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #bc6ec5; font-weight: bold;">resolveContextualObject</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">key</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">null</span>;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #a45bad;">@Nullable</span>
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">getConversationId</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> Thread.currentThread<span style="color: #2d9574;">()</span>.getName<span style="color: #2d9574;">()</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
@1: 定义了作用域的名称为一个常量thread，可以在定义bean的时候给scope使用。
</p>
</div>
</li>
<li><a id="org90beb9b"></a>BeanScopeModel.java<br />
<div class="outline-text-5" id="text-6-4-4-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">BeanScopeModel</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #bc6ec5; font-weight: bold;">BeanScopeModel</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">beanScope</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span>String.format<span style="color: #67b11d;">(</span><span style="color: #2d9574;">"&#32447;&#31243;:%s,create BeanScopeModel,{sope=%s},{this=%s}"</span>, Thread.currentThread<span style="color: #b1951d;">()</span>, beanScope, <span style="color: #4f97d7; font-weight: bold;">this</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
上面的构造方法中会输出当前线程的信息，到时候可以看到创建bean的线程。
</p>
</div>
</li>
<li><a id="org34f0fbd"></a>配置文件 beans-thread.xml<br />
<div class="outline-text-5" id="text-6-4-4-4">
<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="color: #4f97d7; font-weight: bold;">xml</span> <span style="color: #9f8766;">version="1.0" encoding="UTF-8"</span>?&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">beans</span> <span style="color: #4f97d7;">xmlns</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans"</span>
       <span style="color: #4f97d7;">xmlns</span>:<span style="color: #7590db;">xsi</span>=<span style="color: #2d9574;">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span style="color: #4f97d7;">xsi</span>:<span style="color: #7590db;">schemaLocation</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans</span>
<span style="color: #2d9574;">                           http://www.springframework.org/schema/beans/spring-beans-4.3.xsd"</span>&gt;
  <span style="color: #2aa1ae; background-color: #292e34;">&lt;!-- </span><span style="color: #2aa1ae; background-color: #292e34;">&#33258;&#23450;&#20041;&#30340;bean </span><span style="color: #2aa1ae; background-color: #292e34;">--&gt;</span>
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"threadBean"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.javacode2018.lesson001.demo4.BeanScopeModel"</span> <span style="color: #7590db;">scope</span>=<span style="color: #2d9574;">"thread"</span>&gt;
    &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"0"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"thread"</span>/&gt;
  &lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">beans</span>&gt;
</pre>
</div>
<p>
注意上面的scope是我们自定义的，值为thread
</p>
</div>
</li>
<li><a id="orgb9ee957"></a>测试用例<br />
<div class="outline-text-5" id="text-6-4-4-5">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ThradScopeTest</span><span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">main</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #2d9574;">[]</span> <span style="color: #7590db;">args</span><span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">InterruptedException</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#37197;&#32622;&#25991;&#20214;&#20301;&#32622;</span>
        <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">beanXml</span> = <span style="color: #2d9574;">"classpath:/com/example/beans-thread.xml"</span>;
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#25163;&#21160;&#21019;&#24314;&#23481;&#22120;</span>
        <span style="color: #ce537a; font-weight: bold;">ClassPathXmlApplicationContext</span> <span style="color: #7590db;">context</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">ClassPathXmlApplicationContext</span><span style="color: #2d9574;">(){</span>
                <span style="color: #a45bad;">@Override</span>
                <span style="color: #4f97d7; font-weight: bold;">protected</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">postProcessBeanFactory</span><span style="color: #67b11d;">(</span><span style="color: #ce537a; font-weight: bold;">ConfigurableListableBeanFactory</span> <span style="color: #7590db;">beanFactory</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">{</span>
                    <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#21521;&#23481;&#22120;&#20013;&#27880;&#20876;&#33258;&#23450;&#20041;&#30340;scope</span>
                    beanFactory.registerScope<span style="color: #b1951d;">(</span><span style="color: #a45bad;">ThreadScope</span>.THREAD_SCOPE, <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">ThreadScope</span><span style="color: #4f97d7;">()</span><span style="color: #b1951d;">)</span>; <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
                    supper.postProcessBeanFactory<span style="color: #b1951d;">(</span>beanFactory<span style="color: #b1951d;">)</span>;
                <span style="color: #67b11d;">}</span>
            <span style="color: #2d9574;">}</span>;
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#35835;&#21462;&#37197;&#32622;&#25991;&#20214;&#20301;&#32622;</span>
        context.setConfigLocation<span style="color: #2d9574;">(</span>beanXml<span style="color: #2d9574;">)</span>;
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#21551;&#21160;&#23481;&#22120;</span>
        context.refresh<span style="color: #2d9574;">()</span>;
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#20351;&#29992;&#23481;&#22120;&#33719;&#21462;bean</span>
        <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #7590db;">i</span> = 0; i &lt; 2; i++<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
            <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">Thread</span><span style="color: #67b11d;">(</span><span style="color: #b1951d;">()</span> -&gt; <span style="color: #b1951d;">{</span>
                    System.out.println<span style="color: #4f97d7;">(</span>Thread.currentThread<span style="color: #bc6ec5;">()</span> + <span style="color: #2d9574;">","</span> + context.getBean<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"threadBean"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>;
                    System.out.println<span style="color: #4f97d7;">(</span>Thread.currentThread<span style="color: #bc6ec5;">()</span> + <span style="color: #2d9574;">","</span> + context.getBean<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"threadBean"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>;
            <span style="color: #b1951d;">}</span><span style="color: #67b11d;">)</span>.start<span style="color: #67b11d;">()</span>;
            <span style="color: #a45bad;">TimeUnit</span>.SECONDS.sleep<span style="color: #67b11d;">(</span>1<span style="color: #67b11d;">)</span>;
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orgeae26c9" class="outline-3">
<h3 id="orgeae26c9"><span class="section-number-3">6.5</span> 总结</h3>
<div class="outline-text-3" id="text-6-5">
<ol class="org-ol">
<li>spring容器自带的有两种作用域，分别是singleton和prototyp,还有三种分别是 spring web 容器环境中才支持的request,session, application</li>
<li>singleton是spring容器默认的作用域，一个spring容器中同名的bean实例只有一个，多次获取得到的是同一个bean;单线程的bean需要考虑线程安全问题。</li>
<li>prototype是多例的，每次从容器中获取同名的bean，都会重新创建一个；多例bean使用的时候需要考虑创建bean对性能的影响。</li>
<li>一个应用中可以有多个spring容器</li>
<li>自定义scope 3个步骤，实现Scope接口，将实现类注册到spring容器，使用自定义的sope</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org7ddab30" class="outline-2">
<h2 id="org7ddab30"><span class="section-number-2">7</span> 依赖注入之手动注入</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org73616cd" class="outline-3">
<h3 id="org73616cd"><span class="section-number-3">7.1</span> 什么是依赖</h3>
<div class="outline-text-3" id="text-7-1">
<p>
通常情况下，系统中类和类之间是有依赖关系的，如果一个类对外提供的功能需要通过调用其它类的方法来实现的时候，说明这两个类之间存在依赖关系。
</p>
</div>
<div id="outline-container-org37e9937" class="outline-4">
<h4 id="org37e9937"><span class="section-number-4">7.1.1</span> 依赖对象的初始化方式</h4>
<div class="outline-text-4" id="text-7-1-1">
<ul class="org-ul">
<li>通过构造器设置依赖对</li>
<li>通过set方法设置依赖对象</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org1b22f8a" class="outline-3">
<h3 id="org1b22f8a"><span class="section-number-3">7.2</span> spring依赖注入</h3>
<div class="outline-text-3" id="text-7-2">
</div>
<div id="outline-container-orga3ce396" class="outline-4">
<h4 id="orga3ce396"><span class="section-number-4">7.2.1</span> 通过构造器注入</h4>
<div class="outline-text-4" id="text-7-2-1">
<p>
构造器的参数就是被依赖的对象，狗在其注入又分为3种注入方式：
</p>
<ul class="org-ul">
<li>根据构造器参数索引注入</li>
<li>根据构造器参数类型注入</li>
<li>根据构造器参数名称注入</li>
</ul>
</div>
<ol class="org-ol">
<li><a id="orgf128cda"></a>根据构造器参数索引注入<br />
<ol class="org-ol">
<li><a id="org0908d8d"></a>用法<br />
<div class="outline-text-6" id="text-7-2-1-1-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">""</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"0"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#19978;&#28023;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"1"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#27784;&#38451;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">index</span>=<span style="color: #2d9574;">"2"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#27494;&#27721;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>
</pre>
</div>
<ul class="org-ul">
<li>constructor-arg 用户指定构造器的参数</li>
<li>index:构造器参数的位置</li>
<li>value:构造器参数的值，value只能用来给简单的参数设置值，value对应的属性类型只能为byte,int,long,float,double,boolean,
Byte,Long,Float,Double,枚举,spring容器内部注入的时候会将value的值转换为对应的类型</li>
</ul>
</div>
</li>
<li><a id="org40a682e"></a>优缺点<br />
<div class="outline-text-6" id="text-7-2-1-1-2">
<ol class="org-ol">
<li>参数位置的注入对参数的顺序有很强的依赖性，若构造函数的参数位置被人调整过，会导致注入出错</li>
</ol>
<p>
2.通常情况下，不建议去代码中修改构造函数，如果愮新增参数的，可以新增一个构造函数来实现，这算是一个扩展，不会影响目前已有的功能。
</p>
</div>
</li>
</ol>
</li>
<li><a id="orgbc19af0"></a>根据构造器参数类型注入<br />
<ol class="org-ol">
<li><a id="org4fddb40"></a>用法<br />
<div class="outline-text-6" id="text-7-2-1-2-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">""</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">type</span>=<span style="color: #2d9574;">"&#21442;&#25968;&#31867;&#22411;"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#21442;&#25968;&#20540;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">type</span>=<span style="color: #2d9574;">"&#21442;&#25968;&#31867;&#22411;"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#21442;&#25968;&#20540;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">type</span>=<span style="color: #2d9574;">"&#21442;&#25968;&#31867;&#22411;"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#21442;&#25968;&#20540;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
</pre>
</div>
<ul class="org-ul">
<li>constructor-arg:用户指定构造器的参数</li>
<li>type:构造器参数的完整类型，如：java.lang.String,int,double</li>
<li>value:构造器参数的值，value只能用来给简单的类型设置值</li>
</ul>
</div>
</li>
<li><a id="org95855d6"></a>有缺点<br />
<div class="outline-text-6" id="text-7-2-1-2-2">
<p>
实际上按照参数位置或者按照参数的类型注入，都有一个问题，很难通过bean的配置文件知道这个参数是对应UserModel种的哪个属性的，代码的可读性不好，
比如我想知道这每个参数对应的UserModel中的哪个属性，必须要去看UserModel源码。
</p>
</div>
</li>
</ol>
</li>

<li><a id="org8108e62"></a>根据构造器参数名称注入<br />
<ol class="org-ol">
<li><a id="org21e39b9"></a>用法<br />
<div class="outline-text-6" id="text-7-2-1-3-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">""</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"&#21442;&#25968;&#31867;&#22411;"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#21442;&#25968;&#20540;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"&#21442;&#25968;&#31867;&#22411;"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#21442;&#25968;&#20540;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"&#21442;&#25968;&#31867;&#22411;"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#21442;&#25968;&#20540;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
</pre>
</div>
<ul class="org-ul">
<li>constructor-arg:用户指定构造器的参数</li>
<li>name:构造参数名称</li>
<li>value:构造器参数的值，value只能用来给简单的类型设置</li>
</ul>
</div>
<ol class="org-ol">
<li><a id="org63d5f27"></a>关于方法参数名称的问题<br />
<div class="outline-text-7" id="text-7-2-1-3-1-1">
<p>
java通过反射的方式可以获取到方法的参数名称，不过源码中的参数通过编译之后会变成class对象，通常情况下源码变成class文件之后，
参数的真实名称会丢失，参数的名称会变成arg0，arg1,arg2,这样的，和实际的参数名称不一样了， <b>如果需要将源码中的参数名称保留在编译之后的class文件中，编译
的时候需要用到下面的命令</b>
</p>
<div class="org-src-container">
<pre class="src src-shell">javac -parameters java&#28304;&#30721;
</pre>
</div>
<p>
但是我们难以保证编译代码的时候，操作人员一定会带上 <b>-parameters</b> 参数，所以方法的参数可能在class文件中会对视，导致反射获取到的参数名称和实际参数名称不符，
这个需要我们先了解一下。
</p>

<p>
参数名称可能不稳定的问题，spring提供了解决方案，通过Constructorproperties注解来定义参数的名称，将这个注解加在构造方法上面：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@ConstructorProperties</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span><span style="color: #2d9574;">"&#31532;&#19968;&#20010;&#21442;&#25968;&#21517;&#31216;"</span>, <span style="color: #2d9574;">"&#31532;&#20108;&#20010;&#21442;&#25968;&#30340;&#21517;&#31216;"</span>,...<span style="color: #2d9574;">"&#31532;n&#20010;&#21442;&#25968;&#30340;&#21517;&#31216;"</span><span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #bc6ec5; font-weight: bold;">&#31867;&#21517;</span><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">p1</span>, <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">p2</span>...,<span style="color: #ce537a; font-weight: bold;">&#21442;&#25968;n</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7;">{}</span>
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-org3f79e20" class="outline-4">
<h4 id="org3f79e20"><span class="section-number-4">7.2.2</span> setter注入</h4>
<div class="outline-text-4" id="text-7-2-2">
<p>
通常情况下，我们的类都是标准的javabean,javabean类特点：
</p>
<ul class="org-ul">
<li>属性都是private级别的</li>
<li>属性通常情况下通过一组setter，getter方法来访问</li>
<li>setter方法，以set开头后跟首字母大写的属性名，如： <b>setUserName</b> ,简单属性一般只有一个方法参数，方法返回值通常为void;</li>
<li>getter方法，一般属性以get开头，对于boolean类型一般以is开头，后跟首字母大写的属性名，如： <b>getUserName,isOk</b>;</li>
</ul>

<p>
spring对符合javabean特点的类,提供了setter方法的注入，会调用对应属性的setter方法将被以来的对象注入进去。
</p>
</div>
<ol class="org-ol">
<li><a id="orgf6bbe20"></a>用法<br />
<div class="outline-text-5" id="text-7-2-2-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">""</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"&#23646;&#24615;&#21517;&#31216;"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#23646;&#24615;&#20540;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">property</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"&#23646;&#24615;&#21517;&#31216;"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#23646;&#24615;&#20540;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">property</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"&#23646;&#24615;&#21517;&#31216;"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#23646;&#24615;&#20540;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">property</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"&#23646;&#24615;&#21517;&#31216;"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#23646;&#24615;&#20540;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">property</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
</pre>
</div>
<ul class="org-ul">
<li>property: 用于对属性的值进行配置，可以有多个</li>
<li>name: 属性的名称</li>
<li>value：属性的值</li>
</ul>
</div>
</li>
<li><a id="orge119b97"></a>优缺点<br />
<div class="outline-text-5" id="text-7-2-2-2">
<p>
setter注入相对于构造函数注入要灵活一些，构造函数需要指定对应构造函数中所有参数的值，而setter注入的方式没有这种限制，不需要对所有的属性
都进行注入，可以按需进行注入
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgb8eb9ce" class="outline-4">
<h4 id="orgb8eb9ce"><span class="section-number-4">7.2.3</span> 注入特殊类型的对象</h4>
<div class="outline-text-4" id="text-7-2-3">
</div>
<ol class="org-ol">
<li><a id="org729bd06"></a>注入容器中的bean<br />
<div class="outline-text-5" id="text-7-2-3-1">
<p>
注入容器中的bean的有两种写法
</p>
<ul class="org-ul">
<li>ref属性方式</li>
<li>内置bean的方式</li>
</ul>
</div>
<ol class="org-ol">
<li><a id="org6ffb76a"></a>ref属性方式<br />
<div class="outline-text-6" id="text-7-2-3-1-1">
<p>
将上面介绍的constructor-arg或者property元素的value属性名称替换为ref,ref属性的值为容器中其它bean的名称
</p>

<p>
构造器方式，将value替换为ref
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#38656;&#35201;&#27880;&#20837;&#30340;bean&#30340;&#21517;&#31216;"</span> /&gt;
</pre>
</div>
<p>
setter方式，将value替换为ref
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"&#23646;&#24615;&#21517;&#31216;"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"&#38656;&#35201;&#27880;&#20837;&#30340;bean&#21517;&#31216;"</span> /&gt;
</pre>
</div>
</div>
</li>
<li><a id="orgdec0ab5"></a>内置bean的方式<br />
<div class="outline-text-6" id="text-7-2-3-1-2">
<p>
构造器方式：
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>
    &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">""</span> /&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">constructor-arg</span>&gt;
</pre>
</div>
<p>
setter方式：
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">property</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">""</span> /&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">property</span>&gt;
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-org4e5a204" class="outline-4">
<h4 id="org4e5a204"><span class="section-number-4">7.2.4</span> 其它常见类型注入详解</h4>
<div class="outline-text-4" id="text-7-2-4">
</div>
<ol class="org-ol">
<li><a id="org31105a4"></a>注入java.util.List(List元素)<br />
<div class="outline-text-5" id="text-7-2-4-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">list</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;spring&lt;/<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">ref</span> <span style="color: #7590db;">bean</span>=<span style="color: #2d9574;">"bean&#21517;&#31216;"</span>/&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">list</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">list</span>&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">array</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">array</span>&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">map</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">map</span>&gt;

&lt;/<span style="color: #bc6ec5; font-weight: bold;">list</span>&gt;
</pre>
</div>
</div>
</li>
<li><a id="org124e1f4"></a>注入java.util.Set(Set元素)<br />
<div class="outline-text-5" id="text-7-2-4-2">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">set</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;spring&lt;/<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">ref</span> <span style="color: #7590db;">bean</span>=<span style="color: #2d9574;">"bean&#21517;&#31216;"</span>/&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">list</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">list</span>&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">array</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">array</span>&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">map</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">map</span>&gt;

&lt;/<span style="color: #bc6ec5; font-weight: bold;">set</span>&gt;
</pre>
</div>
</div>
</li>
<li><a id="org28713c1"></a>注入java.util.Map(Map元素)<br />
<div class="outline-text-5" id="text-7-2-4-3">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">map</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">entry</span> <span style="color: #7590db;">key</span>=<span style="color: #2d9574;">"aaa"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"30"</span> <span style="color: #7590db;">key-ref</span>=<span style="color: #2d9574;">"key&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span> <span style="color: #7590db;">value-ref</span>=<span style="color: #2d9574;">"value&#24341;&#29992;&#30340;bean&#21517;&#31216;"</span>&gt;&lt;/<span style="color: #bc6ec5; font-weight: bold;">entry</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">entry</span>&gt;
    &lt;<span style="color: #bc6ec5; font-weight: bold;">key</span>&gt;
      value&#23545;&#24212;&#30340;&#20540;&#65292;&#21487;&#20197;&#20026;&#20219;&#24847;&#31867;&#22411;
    &lt;/<span style="color: #bc6ec5; font-weight: bold;">key</span>&gt;
    &lt;<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;
      value&#23545;&#24212;&#30340;&#20540;&#65292;&#21487;&#20197;&#20026;&#20219;&#24847;&#31867;&#22411;
    &lt;/<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;
  &lt;/<span style="color: #bc6ec5; font-weight: bold;">entry</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">map</span>&gt;

</pre>
</div>
</div>
</li>
<li><a id="orgcdb1e56"></a>注入数组(array数组)<br />
<div class="outline-text-5" id="text-7-2-4-4">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">array</span>&gt;
  &#25968;&#32452;&#20013;&#30340;&#20803;&#32032;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">array</span>&gt;
</pre>
</div>
</div>
</li>
<li><a id="org44597bb"></a>注入java.util.Properties(Props元素)<br />
<div class="outline-text-5" id="text-7-2-4-5">
<p>
Properties类相当于键值都是String类型的Map对象，使用props进行注入，如下：
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">props</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">prop</span> <span style="color: #7590db;">key</span>=<span style="color: #2d9574;">"key1"</span>&gt;value1&lt;/<span style="color: #bc6ec5; font-weight: bold;">prop</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">prop</span> <span style="color: #7590db;">key</span>=<span style="color: #2d9574;">"key2"</span>&gt;value2&lt;/<span style="color: #bc6ec5; font-weight: bold;">prop</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">prop</span> <span style="color: #7590db;">key</span>=<span style="color: #2d9574;">"key3"</span>&gt;value3&lt;/<span style="color: #bc6ec5; font-weight: bold;">prop</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">props</span>&gt;
</pre>
</div>
</div>
</li>
<li><a id="org6b5021b"></a>案例<br />
<div class="outline-text-5" id="text-7-2-4-6">
<p>
diOtherTypeModel.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">DiOtherTypeModel</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">List</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">list1</span>;
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">Set</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">UserModel</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">set1</span>;
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">Map</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span>, <span style="color: #ce537a; font-weight: bold;">Integer</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">map1</span>;
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">int</span><span style="color: #bc6ec5;">[]</span> <span style="color: #7590db;">array1</span>;
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">Properties</span> <span style="color: #7590db;">properties1</span>;
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">List</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">getList1</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> list1;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setList1</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">List</span><span style="color: #2d9574;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #2d9574;">&gt;</span> <span style="color: #7590db;">list1</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.list1 = list1;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Set</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">UserModel</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">getSet1</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> set1;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setSet1</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Set</span><span style="color: #2d9574;">&lt;</span><span style="color: #ce537a; font-weight: bold;">UserModel</span><span style="color: #2d9574;">&gt;</span> <span style="color: #7590db;">set1</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.set1 = set1;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Map</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span>, <span style="color: #ce537a; font-weight: bold;">Integer</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">getMap1</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> map1;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setMap1</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Map</span><span style="color: #2d9574;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span>, <span style="color: #ce537a; font-weight: bold;">Integer</span><span style="color: #2d9574;">&gt;</span> <span style="color: #7590db;">map1</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.map1 = map1;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">int</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">getArray1</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> array1;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setArray1</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">int</span><span style="color: #2d9574;">[]</span> <span style="color: #7590db;">array1</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.array1 = array1;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Properties</span> <span style="color: #bc6ec5; font-weight: bold;">getProperties1</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> properties1;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setProperties1</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Properties</span> <span style="color: #7590db;">properties1</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.properties1 = properties1;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">toString</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #2d9574;">"DiOtherTypeModel{"</span> +
            <span style="color: #2d9574;">"list1="</span> + list1 +
            <span style="color: #2d9574;">", set1="</span> + set1 +
            <span style="color: #2d9574;">", map1="</span> + map1 +
            <span style="color: #2d9574;">", array1="</span> + Arrays.toString<span style="color: #2d9574;">(</span>array1<span style="color: #2d9574;">)</span> +
            <span style="color: #2d9574;">", properties1="</span> + properties1 +
            <span style="color: #2d9574;">'}'</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
diOtherType.xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="color: #4f97d7; font-weight: bold;">xml</span> <span style="color: #9f8766;">version="1.0" encoding="UTF-8"</span>?&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">beans</span> <span style="color: #4f97d7;">xmlns</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans"</span>
       <span style="color: #4f97d7;">xmlns</span>:<span style="color: #7590db;">xsi</span>=<span style="color: #2d9574;">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span style="color: #4f97d7;">xsi</span>:<span style="color: #7590db;">schemaLocation</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans</span>
<span style="color: #2d9574;">                           http://www.springframework.org/schema/beans/spring-beans-4.3.xsd"</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"user1"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.example.UserModel"</span>/&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"user2"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.example.UserModel"</span>/&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"diOtherType"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.example.DiOtherTypeModel"</span>&gt;
    <span style="color: #2aa1ae; background-color: #292e34;">&lt;!-- </span><span style="color: #2aa1ae; background-color: #292e34;">&#27880;&#20837;java.util.List&#23545;&#35937; </span><span style="color: #2aa1ae; background-color: #292e34;">--&gt;</span>
    &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"list1"</span>&gt;
      &lt;<span style="color: #bc6ec5; font-weight: bold;">list</span>&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;Spring&lt;/<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;SpringBoot&lt;/<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;
      &lt;/<span style="color: #bc6ec5; font-weight: bold;">list</span>&gt;
    &lt;/<span style="color: #bc6ec5; font-weight: bold;">property</span>&gt;
    <span style="color: #2aa1ae; background-color: #292e34;">&lt;!-- </span><span style="color: #2aa1ae; background-color: #292e34;">&#27880;&#20837;java.util.Set&#23545;&#35937; </span><span style="color: #2aa1ae; background-color: #292e34;">--&gt;</span>
    &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"set1"</span>&gt;
      &lt;<span style="color: #bc6ec5; font-weight: bold;">set</span>&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">ref</span> <span style="color: #7590db;">bean</span>=<span style="color: #2d9574;">"user1"</span>/&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">ref</span> <span style="color: #7590db;">bean</span>=<span style="color: #2d9574;">"user2"</span>/&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">ref</span> <span style="color: #7590db;">bean</span>=<span style="color: #2d9574;">"user1"</span>/&gt;
      &lt;/<span style="color: #bc6ec5; font-weight: bold;">set</span>&gt;
    &lt;/<span style="color: #bc6ec5; font-weight: bold;">property</span>&gt;
    <span style="color: #2aa1ae; background-color: #292e34;">&lt;!-- </span><span style="color: #2aa1ae; background-color: #292e34;">&#27880;&#20837;java.util.Map&#23545;&#35937; </span><span style="color: #2aa1ae; background-color: #292e34;">--&gt;</span>
    &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"map1"</span>&gt;
      &lt;<span style="color: #bc6ec5; font-weight: bold;">map</span>&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">entry</span> <span style="color: #7590db;">key</span>=<span style="color: #2d9574;">"&#36335;&#20154;&#30002;Java"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"30"</span>/&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">entry</span> <span style="color: #7590db;">key</span>=<span style="color: #2d9574;">"&#36335;&#20154;"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"28"</span>/&gt;
      &lt;/<span style="color: #bc6ec5; font-weight: bold;">map</span>&gt;
    &lt;/<span style="color: #bc6ec5; font-weight: bold;">property</span>&gt;
    <span style="color: #2aa1ae; background-color: #292e34;">&lt;!-- </span><span style="color: #2aa1ae; background-color: #292e34;">&#27880;&#20837;&#25968;&#32452;&#23545;&#35937; </span><span style="color: #2aa1ae; background-color: #292e34;">--&gt;</span>
    &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"array1"</span>&gt;
      &lt;<span style="color: #bc6ec5; font-weight: bold;">array</span>&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;10&lt;/<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;9&lt;/<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;8&lt;/<span style="color: #bc6ec5; font-weight: bold;">value</span>&gt;
      &lt;/<span style="color: #bc6ec5; font-weight: bold;">array</span>&gt;
    &lt;/<span style="color: #bc6ec5; font-weight: bold;">property</span>&gt;
    <span style="color: #2aa1ae; background-color: #292e34;">&lt;!-- </span><span style="color: #2aa1ae; background-color: #292e34;">&#27880;&#20837;java.util.Properties&#23545;&#35937; </span><span style="color: #2aa1ae; background-color: #292e34;">--&gt;</span>
    &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"properties1"</span>&gt;
      &lt;<span style="color: #bc6ec5; font-weight: bold;">props</span>&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">prop</span> <span style="color: #7590db;">key</span>=<span style="color: #2d9574;">"key1"</span>&gt;java&#39640;&#24182;&#21457;&#31995;&#21015;&lt;/<span style="color: #bc6ec5; font-weight: bold;">prop</span>&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">prop</span> <span style="color: #7590db;">key</span>=<span style="color: #2d9574;">"key2"</span>&gt;mybatis&#31995;&#21015;&lt;/<span style="color: #bc6ec5; font-weight: bold;">prop</span>&gt;
        &lt;<span style="color: #bc6ec5; font-weight: bold;">prop</span> <span style="color: #7590db;">key</span>=<span style="color: #2d9574;">"key3"</span>&gt;mysql&#31995;&#21015;&lt;/<span style="color: #bc6ec5; font-weight: bold;">prop</span>&gt;
      &lt;/<span style="color: #bc6ec5; font-weight: bold;">props</span>&gt;
    &lt;/<span style="color: #bc6ec5; font-weight: bold;">property</span>&gt;
  &lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">beans</span>&gt;
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org0b5c383" class="outline-3">
<h3 id="org0b5c383"><span class="section-number-3">7.3</span> 总结</h3>
<div class="outline-text-3" id="text-7-3">
<ol class="org-ol">
<li>本文主要讲解了xml中bean的依赖注入，都是采用硬编码的方式进行注入的这种算是手动的方式</li>
<li>注入普通类型通过value属性或者value元素设置注入的值；注入对象如果是容器中的其它bean时候，需要使用ref属性，或者ref元素或者内置bean元素的方式</li>
<li>还介绍了其它几种类型List,Set,Map,数组,properties类型的注入。</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org4c00fb5" class="outline-2">
<h2 id="org4c00fb5"><span class="section-number-2">8</span> 依赖注入之自动注入(autowire)详解</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org3bb236b" class="outline-3">
<h3 id="org3bb236b"><span class="section-number-3">8.1</span> 手动注入不足</h3>
<div class="outline-text-3" id="text-8-1">
<p>
所谓手动注入就是指在xml中采用硬编码的方式来配置注入的对象，比如通过构造器注入或者set方法注入，这些注入的方式都存在不足。
</p>
<ul class="org-ul">
<li>如果需要注入的对象比较多，比如A类中有几十个属性是不是需要写几十个，此时配置文件中的代码量暴增。</li>
<li>如果A类新增或删除一些依赖，还需要手动去调整bean xml中的依赖配置信息，否则会报错</li>
<li>总的来说就是不利于维护和扩展</li>
</ul>

<p>
为了解决上面的问题，spring为我们提供了更加强大的功能，自动注入
</p>
</div>
</div>
<div id="outline-container-org3f0ef63" class="outline-3">
<h3 id="org3f0ef63"><span class="section-number-3">8.2</span> Class.isAssignableFrom方法</h3>
<div class="outline-text-3" id="text-8-2">
</div>
<div id="outline-container-orgf58e9d1" class="outline-4">
<h4 id="orgf58e9d1"><span class="section-number-4">8.2.1</span> 用法</h4>
<div class="outline-text-4" id="text-8-2-1">
<p>
isAssignableFrom方法是Class类中的一个方法，看一下这个方法的定义
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">native</span> <span style="color: #ce537a; font-weight: bold;">boolean</span> <span style="color: #bc6ec5; font-weight: bold;">isAssignableFrom</span><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span>?<span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">cls</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
用法如下：
</p>
<div class="org-src-container">
<pre class="src src-java">cl.isAssignableFrom<span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">c2</span><span style="color: #4f97d7;">)</span>;
</pre>
</div>
<p>
用来判断C2和c1是否相等，或者c2是否是c1的子类。
</p>
</div>
</div>
</div>
<div id="outline-container-orgb1d3778" class="outline-3">
<h3 id="orgb1d3778"><span class="section-number-3">8.3</span> 自动注入</h3>
<div class="outline-text-3" id="text-8-3">
<p>
自动注入是采用约定大于配置的方式来实现的，程序和spring容器之间约定好，遵守某一种都认同的规矩，来实现自动注入。
</p>

<p>
xml中可以在bean元素中通过 <b>autowire</b> 属性来设置自动注入的方式：
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">autowire</span>=<span style="color: #2d9574;">"byType|byName|constructor|default"</span> /&gt;
</pre>
</div>
<ul class="org-ul">
<li>byName: 按照名称进行注入</li>
<li>byType: 按照类型进行注入</li>
<li>constructor: 按照构造方法进行注入</li>
<li>default: 按照默认注入方式</li>
</ul>
</div>
<div id="outline-container-org5881bd7" class="outline-4">
<h4 id="org5881bd7"><span class="section-number-4">8.3.1</span> 按照名称进行注入(byName)</h4>
<div class="outline-text-4" id="text-8-3-1">
</div>
<ol class="org-ol">
<li><a id="org6d513b9"></a>用法<br />
<div class="outline-text-5" id="text-8-3-1-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"x&#31867;"</span> <span style="color: #7590db;">autowire</span>=<span style="color: #2d9574;">"byName"</span>
</pre>
</div>
<p>
spring容器会按照set属性的名称去容器中查找同名的bean对象，然后将查找到的对象通过set方法注入到对应的bean中，未找到对应的名称的bean对象
则set方法不进行注入。
</p>

<p>
需要注入的set属性的名称和被注入的bean的名称必须保持一致。
</p>
</div>
</li>
<li><a id="orgb56cfbc"></a>优缺点<br />
<div class="outline-text-5" id="text-8-3-1-2">
<p>
按照名称进行注入的时候，要求名称和set属性的名称必须同名，相对于硬编码的方式注入，确实节省了不少的代码。
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgf11293e" class="outline-4">
<h4 id="orgf11293e"><span class="section-number-4">8.3.2</span> 按照类型进行自动注入</h4>
<div class="outline-text-4" id="text-8-3-2">
</div>
<ol class="org-ol">
<li><a id="orge8adb74"></a>用法<br />
<div class="outline-text-5" id="text-8-3-2-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"x&#31867;"</span> <span style="color: #7590db;">autowire</span>=<span style="color: #2d9574;">"byType"</span>
</pre>
</div>
<p>
spring容器会遍历x类中的所有set方法，会在容器中查找和set参数类型相同的bean对象，将其通过set方法进行注入，未找到对应类型的bean对象
则set方法不进行注入。
</p>

<p>
<b>需要注入的set属性的类型和被注入的bean的类型需要满足isAssignableFrom关系</b>
</p>

<p>
按照类型自动装配的时候，如果按照类型找到了多个符合条件的bean，系统就会报错。
</p>

<p>
<b>set方法的参数如果是下面的类型或者下面类型的数组的时候，这个set方法会被跳过注入</b> ：
</p>
<div class="org-src-container">
<pre class="src src-java">Object;
Boolean;
<span style="color: #ce537a; font-weight: bold;">boolean</span>;
Byte;
<span style="color: #ce537a; font-weight: bold;">byte</span>;
Character;
<span style="color: #ce537a; font-weight: bold;">char</span>;
Double;
<span style="color: #ce537a; font-weight: bold;">double</span>;
Float;
<span style="color: #ce537a; font-weight: bold;">float</span>;
Integer;
<span style="color: #ce537a; font-weight: bold;">int</span>;
Long;
<span style="color: #ce537a; font-weight: bold;">long</span>;
Short;
<span style="color: #ce537a; font-weight: bold;">short</span>;
Enum;
CharSequence;
Number;
Date;
<span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">time</span>.<span style="color: #a45bad;">temportal</span>.Temporal;
<span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">net</span>.URI;
<span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">util</span>.<span style="color: #a45bad;">Locate</span>.<span style="color: #a45bad;">lang</span>.Class;
</pre>
</div>
</div>
</li>
<li><a id="org3fd5b60"></a>优缺点<br />
<div class="outline-text-5" id="text-8-3-2-2">
<p>
相对于手动注入，节省了不少代码，新增或者删除属性，只需要增加或减少对应的set方法就可以了，更容易扩展了。
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org2aba135" class="outline-4">
<h4 id="org2aba135"><span class="section-number-4">8.3.3</span> 注入类型匹配的所有bean(<b>重点</b>)</h4>
<div class="outline-text-4" id="text-8-3-3">
</div>
<ol class="org-ol">
<li><a id="org43f823f"></a>按照类型注入还有两个比较牛逼的用法<br />
<div class="outline-text-5" id="text-8-3-3-1">
<ul class="org-ul">
<li>一个容器中满足某种类型的bean可以有很多个，将容器中某种类型中的所有bean,通过set方法注入
给一个java.util.List&lt;需要注入的Bean的类型或者其父类型或者其接口对象&gt;</li>
<li>将容器中某种类型中的所有bean,通过set方法注入给java.util.Map&lt;String,需要注入的Bean的类型或者其父类型或者其接口对象&gt;</li>
</ul>
</div>
</li>
<li><a id="org668923f"></a>案例<br />
<div class="outline-text-5" id="text-8-3-3-2">
<p>
DiAutowireByTypeExtend.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">util</span>.<span style="color: #ce537a; font-weight: bold;">List</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">util</span>.<span style="color: #ce537a; font-weight: bold;">Map</span>;
<span style="color: #9f8766;">/**</span>
<span style="color: #9f8766;"> *&#28385;&#36275;&#26465;&#20214;&#30340;bean&#27880;&#20837;&#21040;&#38598;&#21512;&#20013;(&#37325;&#28857;)</span>
<span style="color: #9f8766;"> */</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">DiAutowireByTypeExtend</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#23450;&#20041;&#20102;&#19968;&#20010;&#25509;&#21475;</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">interface</span> <span style="color: #ce537a; font-weight: bold;">IService1</span> <span style="color: #bc6ec5;">{}</span>

    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">BaseServie</span><span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">desc</span>;
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">getDesc</span><span style="color: #2d9574;">()</span> <span style="color: #2d9574;">{</span>
            <span style="color: #4f97d7; font-weight: bold;">return</span> desc;
        <span style="color: #2d9574;">}</span>
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setDesc</span><span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">desc</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
            <span style="color: #4f97d7; font-weight: bold;">this</span>.desc = desc;
        <span style="color: #2d9574;">}</span>
        <span style="color: #a45bad;">@overide</span>
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">toString</span><span style="color: #2d9574;">(){</span>
            <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #2d9574;">"BaseService{desc="</span> + desc + <span style="color: #2d9574;">"}"</span>;
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Service1&#23454;&#29616;&#20102;IService1&#25509;&#21475;</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">Service1</span> <span style="color: #4f97d7; font-weight: bold;">extends</span> <span style="color: #ce537a; font-weight: bold;">BaseService</span> <span style="color: #4f97d7; font-weight: bold;">implements</span> <span style="color: #ce537a; font-weight: bold;">IService1</span> <span style="color: #bc6ec5;">{}</span>

    <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Service2&#23454;&#29616;&#20102;IService1&#25509;&#21475;</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">Service2</span> <span style="color: #4f97d7; font-weight: bold;">extends</span> <span style="color: #ce537a; font-weight: bold;">BaseService</span> <span style="color: #4f97d7; font-weight: bold;">implements</span> <span style="color: #ce537a; font-weight: bold;">IService1</span> <span style="color: #bc6ec5;">{}</span>

    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">List</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">IService1</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">serviceList</span>; <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">List</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">BaseService</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">baseServiceList</span>; <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">Map</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span>,<span style="color: #ce537a; font-weight: bold;">IService1</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">serviceMap</span>; <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">@3</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">Map</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span>,<span style="color: #ce537a; font-weight: bold;">BaseService</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">baseServiceMap</span>; <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@4</span>

    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">List</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">IService1</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">getServiceList</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> serviceList;
    <span style="color: #bc6ec5;">}</span>

    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setServiceList</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">List</span><span style="color: #2d9574;">&lt;</span><span style="color: #ce537a; font-weight: bold;">IService1</span><span style="color: #2d9574;">&gt;</span> <span style="color: #7590db;">serviceList</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">@5</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.serviceList = serviceList;
    <span style="color: #bc6ec5;">}</span>

    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">List</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">BaseService</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">getBaseServiceList</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> baseSreviceList;
    <span style="color: #bc6ec5;">}</span>

    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setBaseServiceList</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">List</span><span style="color: #2d9574;">&lt;</span><span style="color: #ce537a; font-weight: bold;">BaseService</span><span style="color: #2d9574;">&gt;</span> <span style="color: #7590db;">baseServiceList</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@6</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.baseServiceList = baseServiceList;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Map</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span>, <span style="color: #ce537a; font-weight: bold;">IService1</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">getService1Map</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> service1Map;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setService1Map</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Map</span><span style="color: #2d9574;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span>, <span style="color: #ce537a; font-weight: bold;">IService1</span><span style="color: #2d9574;">&gt;</span> <span style="color: #7590db;">service1Map</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span><span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@7</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.service1Map = service1Map;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Map</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span>, <span style="color: #ce537a; font-weight: bold;">BaseServie</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">getBaseServieMap</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> baseServieMap;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setBaseServieMap</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Map</span><span style="color: #2d9574;">&lt;</span><span style="color: #ce537a; font-weight: bold;">String</span>, <span style="color: #ce537a; font-weight: bold;">BaseServie</span><span style="color: #2d9574;">&gt;</span> <span style="color: #7590db;">baseServieMap</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span><span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@8</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.baseServieMap = baseServieMap;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">toString</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">9</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #2d9574;">"DiAutowireByTypeExtend{"</span> +
            <span style="color: #2d9574;">"serviceList="</span> + serviceList +
            <span style="color: #2d9574;">", baseServieList="</span> + baseServieList +
            <span style="color: #2d9574;">", service1Map="</span> + service1Map +
            <span style="color: #2d9574;">", baseServieMap="</span> + baseServieMap +
            <span style="color: #2d9574;">'}'</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<ul class="org-ul">
<li>@1,@2,@3,@4 定义了四个属性，都是反省类型的，都有对应的set方法。</li>
<li>@5： 参数类型是List&lt;BaseService&gt;,这个集合中元素的类型是BaseService,spring会找到容器中所有满足BaseService.isAssignableFrom(bean的类型)的
bean列表，将其通过@5的set方法进行注入。</li>
<li>@6： 通@5代码</li>
<li>@7： 这个参数类型是一个map了，map的key是String类型，value是IService类型，spring容器会将所有满足IService1类型的bean找到，
按照name-&gt;bean对象这种方式丢到一个map中，然后调用@7的set方法进行注入，最后注入的这个map就是bean的名称和bean对象进行映射的一个map对象。</li>
<li>@8： 通@7代码</li>
<li>@9： 重写了toString方法，</li>
</ul>
</div>
</li>
</ol>
</div>

<div id="outline-container-org1d5639b" class="outline-4">
<h4 id="org1d5639b"><span class="section-number-4">8.3.4</span> 按照构造函数进行自动注入</h4>
<div class="outline-text-4" id="text-8-3-4">
</div>
<ol class="org-ol">
<li><a id="org9bfd3c3"></a>用法<br />
<div class="outline-text-5" id="text-8-3-4-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"x&#31867;"</span> <span style="color: #7590db;">autowire</span>=<span style="color: #2d9574;">"constructor"</span> /&gt;
</pre>
</div>
<p>
spring会扎到x类中所有的构造方法(一个类可能有多个构造方法)，然后将这些构造方法进行排序（先按照修饰符进行排序，public在前面，其它的在后面，如果修饰符
一样，会按照构造函数参数数量倒叙，也就是采用贪婪的模式进行匹配，spring容器会尽量多注入一些需要的对象）得到一个构造函数列表，会轮询这个构造器列表，
判断当前构造器所有参数是否在容器中都可以找到匹配的bean对象，如果可以找到就使用这个构造器进行注入，如果不能找到，那么就会跳过这个构造器，继续采用同样的方式
匹配下一个构造器，知道找到一个何时的为止。
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgfaa12b2" class="outline-4">
<h4 id="orgfaa12b2"><span class="section-number-4">8.3.5</span> autowire=default</h4>
<div class="outline-text-4" id="text-8-3-5">
</div>
<ol class="org-ol">
<li><a id="org2bd5a1f"></a>用法<br />
<div class="outline-text-5" id="text-8-3-5-1">
<p>
bean xml 的根元素为beans,注意根元素有个default-autowire属性，这个属性可选值有 <b>no|byName|byType|constructor|default</b> ,这个属性可以批量设置当前文件中所有bean的自动注入的方式，
bean元素中如果省略了autowire属性，那么会取default-autowire的值作为其autowire的值，而每个bean元素还可以单独设置自己的autowire覆盖default-autowire的配置，如下：
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="color: #4f97d7; font-weight: bold;">xml</span> <span style="color: #9f8766;">version="1.0" encoding="UTF-8"</span>?&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">beans</span> <span style="color: #4f97d7;">xmlns</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans"</span>
       <span style="color: #4f97d7;">xmlns</span>:<span style="color: #7590db;">xsi</span>=<span style="color: #2d9574;">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span style="color: #4f97d7;">xsi</span>:<span style="color: #7590db;">schemaLocation</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans</span>
<span style="color: #2d9574;">                           http://www.springframework.org/schema/beans/spring-beans-4.3.xsd"</span>
       <span style="color: #7590db;">default-autowire</span>=<span style="color: #2d9574;">"byName"</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">beans</span>&gt;
</pre>
</div>
<p>
**
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org98fd13c" class="outline-3">
<h3 id="org98fd13c"><span class="section-number-3">8.4</span> 总结</h3>
<div class="outline-text-3" id="text-8-4">
<ul class="org-ul">
<li>xml中手动注入存在的不足，可以通过自动注入的方式来解决</li>
<li>按照类型注入中有个比较重要的是注入匹配类型所有的bean，可以将某种类型所有的bean注入给一个List对象，可以将某种类型的所有bean按照bean名称-&gt;bean对象
的映射方式注入给一个Map对象，这种方法比较重要，用途比较大。</li>
<li>spring中还有其它自动注入的方式。</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org4769e69" class="outline-2">
<h2 id="org4769e69"><span class="section-number-2">9</span> depend-on</h2>
<div class="outline-text-2" id="text-9">
<p>
干预bean的创建和销毁的顺序
</p>
</div>
<div id="outline-container-org29f5f00" class="outline-3">
<h3 id="org29f5f00"><span class="section-number-3">9.1</span> 无任何依赖bean创建和销毁顺序</h3>
<div class="outline-text-3" id="text-9-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">bean定义顺序</th>
<th scope="col" class="org-left">创建顺序</th>
<th scope="col" class="org-left">销毁顺序</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">bean3</td>
<td class="org-left">bean3</td>
<td class="org-left">bean1</td>
</tr>

<tr>
<td class="org-left">bean2</td>
<td class="org-left">bean2</td>
<td class="org-left">bean2</td>
</tr>

<tr>
<td class="org-left">bean1</td>
<td class="org-left">bean1</td>
<td class="org-left">bean3</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>bean对象的创建顺序和bean xml中定义顺序一致</li>
<li>bean销毁的顺序和bean xml中定义的顺序相反</li>
</ul>
</div>
</div>
<div id="outline-container-orge50cc86" class="outline-3">
<h3 id="orge50cc86"><span class="section-number-3">9.2</span> 通过构造器强依赖bean创建和销毁顺序</h3>
<div class="outline-text-3" id="text-9-2">
<p>
依赖关系是bean3-&gt;bean2-&gt;bean1
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">bean定义顺序</th>
<th scope="col" class="org-left">依赖顺序（下面依赖上面的）</th>
<th scope="col" class="org-left">创建顺序</th>
<th scope="col" class="org-left">销毁顺序</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">bean3</td>
<td class="org-left">bean1</td>
<td class="org-left">bean1</td>
<td class="org-left">bean3</td>
</tr>

<tr>
<td class="org-left">bean2</td>
<td class="org-left">bean2</td>
<td class="org-left">bean2</td>
<td class="org-left">bean2</td>
</tr>

<tr>
<td class="org-left">bean1</td>
<td class="org-left">bean3</td>
<td class="org-left">bean3</td>
<td class="org-left">bean1</td>
</tr>
</tbody>
</table>
<ul class="org-ul">
<li>bean对象的创建顺序和bean依赖的顺序一致</li>
<li>bean销毁的顺序和bean创建的顺序相反</li>
</ul>
</div>
</div>
<div id="outline-container-orgdf743fd" class="outline-3">
<h3 id="orgdf743fd"><span class="section-number-3">9.3</span> 通过depend-on干预bean创建和销毁顺序</h3>
<div class="outline-text-3" id="text-9-3">
<p>
上面看到了，对于无依赖的bean，通过定义的顺序确实可以干预bean的创建顺序，通过强依赖也可以干预bean的创建顺序。
</p>

<p>
那么如果xml中定义的bean特别多，而有些bean之间也没有强依赖关系，此时如果想去调整bean的创建和销毁顺序，得去调整xml中bean的定义顺序，或者去加强依赖，
这样是非常不好的，spring中可以通过 <b>depend-on</b> 来解决这些问题，在不调整bean的定义顺序和强加依赖的情况下，可以通过 <b>depend-on</b> 属性来设置当前bean的依赖于
哪些bean,那么可以保证depend-on指定的bean在当前bean之前创建好，销毁的时候在当前bean之后进行销毁。
</p>
</div>

<div id="outline-container-org162c44e" class="outline-4">
<h4 id="org162c44e"><span class="section-number-4">9.3.1</span> depend-on使用方式：</h4>
<div class="outline-text-4" id="text-9-3-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"bean1"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">""</span> <span style="color: #7590db;">depend-on</span>=<span style="color: #2d9574;">"bean2,bean3;bean4"</span> /&gt;
</pre>
</div>
<p>
depend-on: 设置当前bean依赖的bean名称，可以指定多个，多个之间可以用 <b>, ; 空格</b>  进行分割，上面不管bean2,bean3,bean4在任何地方定义，都可以确保在bean1创建
之前，会先将bean2,bean3,bean4创建好，表示bean1依赖于这三个bean,可能bean1需要用到bean2,bean3,bean4中生成的一些资源或者其它功能等，但是又没有强制去在
bean1类中通过属性定义强依赖的方式去依赖于bean2,bean3,bean4,当然销毁的时候也会先贤惠当前bean,再去销毁被依赖的bean,即先销毁bean1,再去销毁depend-on中指定的bean。
</p>
</div>
</div>
</div>


<div id="outline-container-orgffa6c2d" class="outline-3">
<h3 id="orgffa6c2d"><span class="section-number-3">9.4</span> 总结</h3>
<div class="outline-text-3" id="text-9-4">
<ol class="org-ol">
<li>无依赖的bean创建顺序和定义顺序一致，销毁顺序刚好相反</li>
<li>通过构造器强依赖的bean，会先创建构造器参数中对应的bean,然后才会创建当前bean,销毁顺序刚好相反</li>
<li>depend-on可以指定当前bean依赖的bean,通过这个可以确保depend-on指定的bean在当前bean之前先创建好，销毁顺序刚好相反</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org724ba89" class="outline-2">
<h2 id="org724ba89"><span class="section-number-2">10</span> primary可以解决什么问题？</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-orgcd8f449" class="outline-3">
<h3 id="orgcd8f449"><span class="section-number-3">10.1</span> 问题提出</h3>
<div class="outline-text-3" id="text-10-1">
<p>
当spring容器中定义了多个bean，分别是serviceA和serviceB&#x2026;&#x2026;,这两个bean对象都实现了IService接口，此时想从容器中获取Service接口对应的bean，
此时容器中有多个候选者（servceA,serviceB,serviceC&#x2026;..）满足我们的需求，此时spring容器不知道如何选择，到底是返回哪一个，spring懵了，就会报错。
</p>
</div>
</div>
<div id="outline-container-org1c9d852" class="outline-3">
<h3 id="org1c9d852"><span class="section-number-3">10.2</span> 解决方案</h3>
<div class="outline-text-3" id="text-10-2">
<p>
spring中可以通过bean元素的primary这个属性来解决问题，可以通过这个属性来指定当前bean为主要候选者，当容器中查询一个bean的时候，如果容器中有多个后选者匹配的时候，
此时spring会返回主要的后选者。
</p>
</div>
</div>
<div id="outline-container-orgb748897" class="outline-3">
<h3 id="orgb748897"><span class="section-number-3">10.3</span> 示例：</h3>
<div class="outline-text-3" id="text-10-3">
<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="color: #4f97d7; font-weight: bold;">xml</span> <span style="color: #9f8766;">version="1.0" encoding="UTF-8"</span>?&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">beans</span> <span style="color: #4f97d7;">xmlns</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans"</span>
       <span style="color: #4f97d7;">xmlns</span>:<span style="color: #7590db;">xsi</span>=<span style="color: #2d9574;">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span style="color: #4f97d7;">xsi</span>:<span style="color: #7590db;">schemaLocation</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans</span>
<span style="color: #2d9574;">                           http://www.springframework.org/schema/beans/spring-beans-4.3.xsd"</span>&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceA"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo8.PrimaryBean$ServiceA"</span> <span style="color: #7590db;">primary</span>=<span style="color: #2d9574;">"true"</span>/&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceB"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo8.PrimaryBean$ServiceA"</span>/&gt;

&lt;/<span style="color: #bc6ec5; font-weight: bold;">beans</span>&gt;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8979a0b" class="outline-2">
<h2 id="org8979a0b"><span class="section-number-2">11</span> autowire-candidate属性</h2>
<div class="outline-text-2" id="text-11">
<p>
解决自动注入时，出现多个相同类型的类，无法注入问题
</p>

<p>
设置某个bean是否在自动注入的时候是否为作为候选bean，通过bean元素的autowire-candidate属性来配置。
</p>
</div>
</div>
<div id="outline-container-org229b038" class="outline-2">
<h2 id="org229b038"><span class="section-number-2">12</span> lazy-init: bean延迟初始化</h2>
<div class="outline-text-2" id="text-12">
</div>
<div id="outline-container-org040d246" class="outline-3">
<h3 id="org040d246"><span class="section-number-3">12.1</span> bean初始化两种方式</h3>
<div class="outline-text-3" id="text-12-1">
<ul class="org-ul">
<li>实时初始化</li>
<li>延迟初始化</li>
</ul>
</div>
<div id="outline-container-orgc2b627a" class="outline-4">
<h4 id="orgc2b627a"><span class="section-number-4">12.1.1</span> bean实时初始化</h4>
<div class="outline-text-4" id="text-12-1-1">
<p>
在容器启动过程中被创建组装好的bean，称为实时初始化的bean，spring中默认定义的bean都是实时初始化的bean，这些bean默认都是单例的，在容器启动过程中会被创建好，
然后放在spring容器中以供使用
</p>
</div>
<ol class="org-ol">
<li><a id="org8a62e1e"></a>优点<br />
<div class="outline-text-5" id="text-12-1-1-1">
<ol class="org-ol">
<li>更早发下bean定义的错误：实时初始化的bean如果定义有问题，会在容器启动过程中抛出异常，让开发者快速发现问题。</li>
<li>查找bean更快：容器启动完毕之后，实时初始化的bean已经完全创建好了，此时被缓存在spring容器中，当我们需要使用的时候，容器直接
返回就可以了，速度是非常快的。</li>
</ol>
</div>
</li>
</ol>
</div>
<div id="outline-container-org1153fbb" class="outline-4">
<h4 id="org1153fbb"><span class="section-number-4">12.1.2</span> bean延迟初始化</h4>
<div class="outline-text-4" id="text-12-1-2">
<p>
实时初始化的bean都会在容器启动过程中创建好，如果程序中定义的bean非常多，并且有些bean创建的过程中比较耗时的时候，会导致系统消耗的资源比较多，
并且会让整个启动时间比较长。
</p>

<p>
针对以上问题，spring对这些问题提供了解决方案: <b>bean延迟初始化</b> 。
</p>

<p>
所谓延迟初始化，就是和实时初始化刚好相反，延迟初始化的bean在容器启动过程不会创建，而是需要的时候才会去创建，那么bean什么时候会被使用？
</p>
<ol class="org-ol">
<li>被其它bean作为依赖进行注入的时候,比如通过property元素的ref属性进行引用，通过构造器注入，通过sett注入，通过自动注入，这些都会导致被依赖bean的创建。</li>
<li>开发者自己写代码向容器中查找bean的时候，如调用容器的getBean方法获取bean.</li>
</ol>
</div>
<ol class="org-ol">
<li><a id="org3db7287"></a>延迟bean的配置<br />
<div class="outline-text-5" id="text-12-1-2-1">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">lazy-init</span>=<span style="color: #2d9574;">"true/false"</span> /&gt;
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org9714dd2" class="outline-2">
<h2 id="org9714dd2"><span class="section-number-2">13</span> 使用继承简化bean的配置(abstract &amp; parent)</h2>
<div class="outline-text-2" id="text-13">
</div>
<div id="outline-container-org67756cb" class="outline-3">
<h3 id="org67756cb"><span class="section-number-3">13.1</span> 案例引入</h3>
<div class="outline-text-3" id="text-13-1">
<p>
ServiceA.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ServiceA</span><span style="color: #4f97d7;">{}</span>
</pre>
</div>
<p>
ServiceB.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ServiceB</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span>;
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #7590db;">serviceA</span>;
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">getName</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> name;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setName</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.name = name;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #bc6ec5; font-weight: bold;">getServiceA</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> serviceA;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setServiceA</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #7590db;">serviceA</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.serviceA = serviceA;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">toString</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #2d9574;">"ServiceB{"</span> +
            <span style="color: #2d9574;">"name='"</span> + name + <span style="color: #2d9574;">'</span><span style="color: #2d9574; font-weight: bold;">\</span><span style="color: #2d9574; font-weight: bold;">'</span><span style="color: #2d9574;">'</span> +
            <span style="color: #2d9574;">", serviceA="</span> + serviceA +
            <span style="color: #2d9574;">'}'</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
ServiceC.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ServiceC</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span>;
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #7590db;">serviceA</span>;
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">getName</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> name;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setName</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.name = name;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #bc6ec5; font-weight: bold;">getServiceA</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> serviceA;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setServiceA</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #7590db;">serviceA</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.serviceA = serviceA;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">toString</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #2d9574;">"ServiceB{"</span> +
            <span style="color: #2d9574;">"name='"</span> + name + <span style="color: #2d9574;">'</span><span style="color: #2d9574; font-weight: bold;">\</span><span style="color: #2d9574; font-weight: bold;">'</span><span style="color: #2d9574;">'</span> +
            <span style="color: #2d9574;">", serviceA="</span> + serviceA +
            <span style="color: #2d9574;">'}'</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
beanExtend.xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="color: #4f97d7; font-weight: bold;">xml</span> <span style="color: #9f8766;">version="1.0" encoding="UTF-8"</span>?&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">beans</span> <span style="color: #4f97d7;">xmlns</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans"</span>
       <span style="color: #4f97d7;">xmlns</span>:<span style="color: #7590db;">xsi</span>=<span style="color: #2d9574;">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span style="color: #4f97d7;">xsi</span>:<span style="color: #7590db;">schemaLocation</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans</span>
<span style="color: #2d9574;">                           http://www.springframework.org/schema/beans/spring-beans-4.3.xsd"</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceA"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo12.ServiceA"</span>/&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceB"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo12.ServiceB"</span>&gt;
    &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"name"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"&#183;Java1"</span>/&gt;
    &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"serviceA"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"serviceA"</span>/&gt;
  &lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceC"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo12.ServiceB"</span>&gt;
    &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"name"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"Java2"</span>/&gt;
    &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"serviceA"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"serviceA"</span>/&gt;
  &lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">beans</span>&gt;
</pre>
</div>
<p>
BeanExtendTest.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">BeanExtendTest</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@Test</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">normalBean</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">beanXml</span> =<span style="color: #2d9574;">"classpath:/com/demo12/normalBean.xml"</span>;
        <span style="color: #ce537a; font-weight: bold;">ClassPathXmlApplicationContext</span> <span style="color: #7590db;">context</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">ClassPathXmlApplicationContext</span><span style="color: #2d9574;">(</span>beanExtend.xml<span style="color: #2d9574;">)</span>;
        System.out.println<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"serviceB:"</span> + context.getBean<span style="color: #67b11d;">(</span>ServiceB.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
        System.out.println<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"serviceC:"</span> + context.getBean<span style="color: #67b11d;">(</span>ServiceC.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
运行结果为：
</p>
<div class="org-src-container">
<pre class="src src-shell">serviceB:ServiceB<span style="color: #4f97d7;">{</span><span style="color: #7590db;">name</span>=<span style="color: #2d9574;">'Java1'</span>,<span style="color: #7590db;">serviceA</span>=com.javacode2018.demo12.ServiceA@222114ba<span style="color: #4f97d7;">}</span>
serviceC:ServiceC<span style="color: #4f97d7;">{</span><span style="color: #7590db;">name</span>=<span style="color: #2d9574;">'Java2'</span>,<span style="color: #7590db;">serviceA</span>=com.javacode2018.demo12.ServiceA@222114ba<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org80fcc1a" class="outline-3">
<h3 id="org80fcc1a"><span class="section-number-3">13.2</span> 通过继承优化代码</h3>
<div class="outline-text-3" id="text-13-2">
<p>
上面xml中有两个bean，serviceB和serviceC,这两个bean需要注入的属性值是一样的，都需要注入name和serviceA这两个属性，并且两个属性的值
也一样，我们可以将上面的代码抽取出来，通过spring中继承的方式来做到代码的重用。
</p>

<p>
xml更改如下：
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="color: #4f97d7; font-weight: bold;">xml</span> <span style="color: #9f8766;">version="1.0" encoding="UTF-8"</span>?&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">beans</span> <span style="color: #4f97d7;">xmlns</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans"</span>
       <span style="color: #4f97d7;">xmlns</span>:<span style="color: #7590db;">xsi</span>=<span style="color: #2d9574;">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span style="color: #4f97d7;">xsi</span>:<span style="color: #7590db;">schemaLocation</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans</span>
<span style="color: #2d9574;">                           http://www.springframework.org/schema/beans/spring-beans-4.3.xsd"</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceA"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo12.ServiceA"</span>/&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"baseService"</span> <span style="color: #7590db;">abstract</span>=<span style="color: #2d9574;">"true"</span>&gt;
    &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"name"</span> <span style="color: #7590db;">value</span>=<span style="color: #2d9574;">"Java1"</span>/&gt;
    &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"serviceA"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"serviceA"</span>/&gt;
  &lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceB"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo12.ServiceB"</span> <span style="color: #7590db;">parent</span>=<span style="color: #2d9574;">"baseService"</span>/&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceC"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo12.ServiceC"</span> <span style="color: #7590db;">parent</span>=<span style="color: #2d9574;">"baseService"</span>/&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">beans</span>&gt;
</pre>
</div>
<p>
上面多了一个baseService的bean,这个bean没有指定class对象，但是多了一个abstract="true"的属性，表示这个bean是抽象的，abstract
为true的bean在spring容器中不会被创建，只是会将其当作bean定义的模板，而serviceB和serviceC的定义中多了一个属性parent，用来指定
当前bean的父bean名称。
</p>

<p>
子bean中也可以重新定义父bean中已经定义好的配置，这样子配置会覆盖父bean中的配置信息。
</p>
</div>
</div>
</div>

<div id="outline-container-orgbe64089" class="outline-2">
<h2 id="orgbe64089"><span class="section-number-2">14</span> lookup-method和replaced-method</h2>
<div class="outline-text-2" id="text-14">
</div>
<div id="outline-container-org7845a29" class="outline-3">
<h3 id="org7845a29"><span class="section-number-3">14.1</span> lookup-method: 方法查找</h3>
<div class="outline-text-3" id="text-14-1">
<p>
通常情况下，我们使用的bean都是单例的，如果一个bean需要依赖于另一个bean的时候，可以在当前bean中声明另外一个bean引用，然后注入依赖的bean,
此时被依赖的bean在当前bean中自始至终都是同一个实例。
</p>
</div>
<div id="outline-container-orgb46bb79" class="outline-4">
<h4 id="orgb46bb79"><span class="section-number-4">14.1.1</span> 案例回顾</h4>
<div class="outline-text-4" id="text-14-1-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #4f97d7;">{}</span>

<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ServiceB</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #7590db;">serviceA</span>;

    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #bc6ec5; font-weight: bold;">getServiceA</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> serviceA;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setServiceA</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #7590db;">serviceA</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.serviceA = serviceA;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
bean.xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="color: #4f97d7; font-weight: bold;">xml</span> <span style="color: #9f8766;">version="1.0" encoding="UTF-8"</span>?&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">beans</span> <span style="color: #4f97d7;">xmlns</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans"</span>
       <span style="color: #4f97d7;">xmlns</span>:<span style="color: #7590db;">xsi</span>=<span style="color: #2d9574;">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span style="color: #4f97d7;">xsi</span>:<span style="color: #7590db;">schemaLocation</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans</span>
<span style="color: #2d9574;">                           http://www.springframework.org/schema/beans/spring-beans-4.3.xsd"</span>&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceA"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo13.normal.ServiceA"</span> <span style="color: #7590db;">scope</span>=<span style="color: #2d9574;">"prototype"</span>/&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceB"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo13.normal.ServiceB"</span>&gt;
    &lt;<span style="color: #bc6ec5; font-weight: bold;">property</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"serviceA"</span> <span style="color: #7590db;">ref</span>=<span style="color: #2d9574;">"serviceA"</span>/&gt;
  &lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">beans</span>&gt;
</pre>
</div>
<p>
上面serviceA的scope是prototype，表示serviceA是多例的，每次从容器中获取serviceA都会返回一个新的对象。
</p>

<p>
而serviceB的scope没有配置，默认是单例的，通过prototype元素将service注入。
</p>

<p>
如果我们希望beanB中每次使用beanA的时候beanA都是一个新的实例，我们可以在serviceB中价格方法去获取ServiceA,这个方法中我们主动去容器中
获取serviceA，每次获取到的都是不同的serviceA实例。
</p>

<p>
那么，如何在serviceB中获取到spring容器呢？
</p>

<p>
spring中有个接口ApplicationContextAware:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.ApplicationContextAware;
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">interface</span> <span style="color: #ce537a; font-weight: bold;">ApplicationContextAware</span> <span style="color: #4f97d7; font-weight: bold;">extends</span> <span style="color: #ce537a; font-weight: bold;">Aware</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setApplicationContext</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">ApplicationContext</span> <span style="color: #7590db;">applicationContext</span><span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">BeansException</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
上面这个接口有个方法 <b>setApplicationContext</b> ,这个接口给了自定义的bean中获取applicationContext的能力，当我们的类实现这个接口之后，spring容器
创建bean对象的时候bean实现了这个接口，那么容器会自动调用 <b>setApplicationContext</b> 方法，将容器对象applicationContext传入，此时在我们bean
对象中就可以使用容器的任何方法了。
</p>
</div>
</div>
<div id="outline-container-org611521c" class="outline-4">
<h4 id="org611521c"><span class="section-number-4">14.1.2</span> 单例bean中使用多例bean:ApplicationContext接口的方式</h4>
<div class="outline-text-4" id="text-14-1-2">
<p>
serviceA.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">serviceA</span><span style="color: #4f97d7;">{}</span>
</pre>
</div>
<p>
serviceB.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ServiceB</span> <span style="color: #4f97d7; font-weight: bold;">implements</span> <span style="color: #ce537a; font-weight: bold;">ApplicationContextAware</span> <span style="color: #4f97d7;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">say</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #7590db;">serviceA</span> = <span style="color: #4f97d7; font-weight: bold;">this</span>.getService<span style="color: #2d9574;">()</span>; <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
        System.out.println<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"this:"</span>+<span style="color: #4f97d7; font-weight: bold;">this</span>+<span style="color: #2d9574;">",serviceA:"</span>+ serviceA<span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #bc6ec5; font-weight: bold;">getServiceA</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">this</span>.context.getBean<span style="color: #2d9574;">(</span>ServiceA.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #2d9574;">)</span>;<span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@3</span>
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">ApplicationContext</span> <span style="color: #7590db;">context</span>;
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setApplicationContext</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">ApplicationContext</span> <span style="color: #7590db;">applicationContext</span><span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">BeansException</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.context = applicationContext;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
上面代码，serviceB实现了ApplicationContextAware接口，然后实现了这个接口中的setApplicationContext方法，spring容器在创建ServiceB的时候会自动调用
setApplicationContext方法。
</p>

<p>
@3： 从容器中主动获取ServiceA, 这样每次获取到的ServiceA都是一个新的实例。
</p>

<p>
@2： say方法中调用getServiceA方法获取ServiceA对象，然后将其输出。
</p>
</div>
</div>

<div id="outline-container-org24d26c1" class="outline-4">
<h4 id="org24d26c1"><span class="section-number-4">14.1.3</span> 单例bean中使用多例bean: lookup-method方式实现</h4>
<div class="outline-text-4" id="text-14-1-3">
<p>
上面这种方式实现了单例bean中使用多例bean的需求，但是用到spring中的接口 <b>ApplicationContextAware</b> ,此时对spring的
api有耦合的作用，我们一直推行高内聚低耦合，所以应该寻求更好的办法。--&#x2013;&#x2014;&gt;lookup-method
serviceA.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #4f97d7;">{}</span>
</pre>
</div>
<p>
serviceB.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ServiceB</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">say</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #7590db;">serviceA</span> = <span style="color: #4f97d7; font-weight: bold;">this</span>.getServiceA<span style="color: #2d9574;">()</span>;
    <span style="color: #bc6ec5;">}</span>

    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">ServiceA</span> <span style="color: #bc6ec5; font-weight: bold;">getServiceA</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">null</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
上面@1，这个方法中返回了一个null对象，下面我们通过spring来创建上面2个bean对象，然后让spring对上面的getServiceA方法进行拦截，
返回指定的bean，如下：
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="color: #4f97d7; font-weight: bold;">xml</span> <span style="color: #9f8766;">version="1.0" encoding="UTF-8"</span>?&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">beans</span> <span style="color: #4f97d7;">xmlns</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans"</span>
       <span style="color: #4f97d7;">xmlns</span>:<span style="color: #7590db;">xsi</span>=<span style="color: #2d9574;">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span style="color: #4f97d7;">xsi</span>:<span style="color: #7590db;">schemaLocation</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans</span>
<span style="color: #2d9574;">                           http://www.springframework.org/schema/beans/spring-beans-4.3.xsd"</span>&gt;

  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceA"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo13.lookupmethod.ServiceA"</span> <span style="color: #7590db;">scope</span>=<span style="color: #2d9574;">"prototype"</span>/&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceB"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo13.lookupmethod.ServiceB"</span>&gt;
    &lt;<span style="color: #bc6ec5; font-weight: bold;">lookup-method</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"getServiceA"</span> <span style="color: #7590db;">bean</span>=<span style="color: #2d9574;">"serviceA"</span>/&gt;
  &lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">beans</span>&gt;
</pre>
</div>
<p>
重点在于 <b>lookup-method</b> 这一行的配置，当我们调用serviceB中的getServiceA方法的时候，这个方法会拦截，然后会按照
lookup-method元素中bean属性的值作为bean的名称去容器中查找对应的bean，然后作为getServiceA的返回值返回，即调用
getServiceA方法的时候，会从spring容器中查找id为serviceA的bean然后返回。
</p>
</div>
</div>
</div>

<div id="outline-container-orgbf9e7a8" class="outline-3">
<h3 id="orgbf9e7a8"><span class="section-number-3">14.2</span> replaced-method: 方法替换</h3>
<div class="outline-text-3" id="text-14-2">
<p>
replace-method:方法替换，比如我们要调用serviceB中的getServiceA的时候，我们可以对ServiceB这个bean中的getServiceA方法进行拦截，
把这个调用请求转发到一个替换者处理，这就是replaced-method可以实现的功能，比lookup-method更强大更灵活。
</p>
</div>
<div id="outline-container-org566fc48" class="outline-4">
<h4 id="org566fc48"><span class="section-number-4">14.2.1</span> replaced-method的使用3个步骤</h4>
<div class="outline-text-4" id="text-14-2-1">
</div>
<ol class="org-ol">
<li><a id="orgd8d8fc1"></a>定义替换者<br />
<div class="outline-text-5" id="text-14-2-1-1">
<p>
自定义一个替换者，替换者需要实现spring中的MethodReplacer接口，接口定义如下：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">interface</span> <span style="color: #ce537a; font-weight: bold;">MethodReplacer</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #9f8766;">/**</span>
<span style="color: #9f8766;">   * </span><span style="color: #a45bad;">@param</span><span style="color: #9f8766;"> obj &#34987;&#26367;&#25442;&#26041;&#27861;&#30340;&#30446;&#26631;&#23545;&#35937;</span>
<span style="color: #9f8766;">   * </span><span style="color: #a45bad;">@param</span><span style="color: #9f8766;"> method &#30446;&#26631;&#23545;&#35937;&#30340;&#26041;&#27861;</span>
<span style="color: #9f8766;">   * </span><span style="color: #a45bad;">@param</span><span style="color: #9f8766;"> args &#26041;&#27861;&#30340;&#21442;&#25968;</span>
<span style="color: #9f8766;">   * </span><span style="color: #a45bad;">@return</span><span style="color: #9f8766;"> return value for the method</span>
<span style="color: #9f8766;">   */</span>
  <span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #bc6ec5; font-weight: bold;">reimplement</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #7590db;">obj</span>, <span style="color: #ce537a; font-weight: bold;">Method</span> <span style="color: #7590db;">method</span>, <span style="color: #ce537a; font-weight: bold;">Object</span><span style="color: #2d9574;">[]</span> <span style="color: #7590db;">args</span><span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">Throwable</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
当调用目标对象需要被替换的方法的时候，这个调用请求会被转发到上面的替换者的reimplement方法进行处理。
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">serviceB&#30340;&#26041;&#27861;&#26367;&#25442;&#32773;</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ServiceBMethodReplacer</span> <span style="color: #4f97d7; font-weight: bold;">implements</span> <span style="color: #ce537a; font-weight: bold;">MethodReplacer</span>,<span style="color: #ce537a; font-weight: bold;">ApplicationContextAware</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #bc6ec5; font-weight: bold;">reimplement</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #7590db;">obj</span>, <span style="color: #ce537a; font-weight: bold;">Method</span> <span style="color: #7590db;">method</span>, <span style="color: #ce537a; font-weight: bold;">Object</span><span style="color: #2d9574;">[]</span> <span style="color: #7590db;">args</span><span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">throw</span> Throwable <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">this</span>.context.getBean<span style="color: #2d9574;">(</span>ServiceA.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">ApplicationContext</span> <span style="color: #7590db;">context</span>;
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">setApplicationContext</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">ApplicationContext</span> <span style="color: #7590db;">applicationContext</span><span style="color: #bc6ec5;">)</span>
        <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">BeansException</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.context = applicationContext;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>
<li><a id="orgf3fb504"></a>定义替换者bean<br />
<div class="outline-text-5" id="text-14-2-1-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7;">&lt;</span><span style="color: #ce537a; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceBMethodReplacer"</span> <span style="color: #4f97d7; font-weight: bold;">class</span>=<span style="color: #2d9574;">"com.demo14.ServiceBMethodReplacer"</span> /<span style="color: #4f97d7;">&gt;</span>
</pre>
</div>
</div>
</li>
<li><a id="org412e30a"></a>通过replaced-method元素配置目标bean需要被替换的方法<br />
<div class="outline-text-5" id="text-14-2-1-3">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #bc6ec5; font-weight: bold;">bean</span> <span style="color: #7590db;">id</span>=<span style="color: #2d9574;">"serviceB"</span> <span style="color: #7590db;">class</span>=<span style="color: #2d9574;">"com.demo14.ServiceB"</span>&gt;
  &lt;<span style="color: #bc6ec5; font-weight: bold;">replaced-method</span> <span style="color: #7590db;">name</span>=<span style="color: #2d9574;">"getServiceA"</span> <span style="color: #7590db;">replacer</span>=<span style="color: #2d9574;">"serviceAMethodReplacer"</span>/&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">bean</span>&gt;
</pre>
</div>
<ul class="org-ul">
<li>name: 用于指定当前bean需要被替换的方法</li>
<li>replacer: 替换者，即实现了MethodReplace接口的类对应的bean</li>
</ul>
<p>
xml配置中当调用serviceB的getServiceA的时候，会自动调用serviceAMethodReplacer这个bean中的
reimplement方法进行处理。
</p>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org10e52d0" class="outline-2">
<h2 id="org10e52d0"><span class="section-number-2">15</span> 代理详解（java动态代理&amp;CGLIB代理）</h2>
<div class="outline-text-2" id="text-15">
</div>
<div id="outline-container-org1be0fcd" class="outline-3">
<h3 id="org1be0fcd"><span class="section-number-3">15.1</span> jdk动态代理详解</h3>
<div class="outline-text-3" id="text-15-1">
<p>
jdk中为实现代理提供了支持，主要用到两个类
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">reflect</span>.Proxy;
<span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">reflect</span>.InvocationHandler;
</pre>
</div>
<p>
jdk自带的代理使用上面有个限制，只能为接口创建代理，如果需要给具体的类创建代理类，需要用cglib
</p>
</div>
<div id="outline-container-org5009cfd" class="outline-4">
<h4 id="org5009cfd"><span class="section-number-4">15.1.1</span> java.lang.reflect.Proxy</h4>
<div class="outline-text-4" id="text-15-1-1">
<p>
这是jdk动态代理中主要的一个类，里面有一些静态方法会经常用到
</p>
</div>
<ol class="org-ol">
<li><a id="orgc709512"></a>getProxyClass方法<br />
<div class="outline-text-5" id="text-15-1-1-1">
<p>
为指定的接口创建代理类，返回代理类的Class对象
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #4f97d7;">&lt;</span>?<span style="color: #4f97d7;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">getProxyClass</span><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">ClassLoader</span> <span style="color: #7590db;">loader</span>, <span style="color: #a45bad;">Class</span><span style="color: #bc6ec5;">&lt;</span>?<span style="color: #bc6ec5;">&gt;</span>... <span style="color: #7590db;">interfaces</span><span style="color: #4f97d7;">)</span>;
</pre>
</div>
<p>
参数说明：
</p>
<ul class="org-ul">
<li>loader: 定义代理类的类加载器</li>
<li>interfaces: 指定需要实现的接口列表，创建的代理默认会按顺序实现interfaces指定的接口</li>
</ul>
</div>
</li>
<li><a id="org063ea3e"></a>newProxyInstance方法<br />
<div class="outline-text-5" id="text-15-1-1-2">
<p>
创建代理类的实例对象
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #bc6ec5; font-weight: bold;">newProxyInstance</span><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">ClassLoader</span> <span style="color: #7590db;">loader</span>, <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span>?<span style="color: #bc6ec5;">&gt;[]</span> <span style="color: #7590db;">interfaces</span>, <span style="color: #ce537a; font-weight: bold;">InvocationHandler</span> <span style="color: #7590db;">h</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
这个方法先为指定的接口创建代理类，然后会生成代理类的一个实例，最后一个参数比较特殊，是InvocatonHandler类型的，这个是个接口如下：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #bc6ec5; font-weight: bold;">invoke</span><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #7590db;">proxy</span>, <span style="color: #ce537a; font-weight: bold;">Method</span> <span style="color: #7590db;">method</span>, <span style="color: #ce537a; font-weight: bold;">Object</span><span style="color: #bc6ec5;">[]</span> <span style="color: #7590db;">args</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">Throwable</span>;
</pre>
</div>
<p>
上面方法会返回一个代理对象，当调用代理对象的任何方法的时候，会被InvocationHandler接口的invoke方法处理，所以主要代码需要写在invoke方法中。
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgc8d9a12" class="outline-4">
<h4 id="orgc8d9a12"><span class="section-number-4">15.1.2</span> isProxy方法</h4>
<div class="outline-text-4" id="text-15-1-2">
<p>
判断指定的类是否是一个代理类
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #ce537a; font-weight: bold;">boolean</span> <span style="color: #bc6ec5; font-weight: bold;">isProxyClass</span><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span>?<span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">cl</span><span style="color: #4f97d7;">)</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd548c69" class="outline-4">
<h4 id="orgd548c69"><span class="section-number-4">15.1.3</span> getInvocationHandler方法</h4>
<div class="outline-text-4" id="text-15-1-3">
<p>
获取代理对象的InvocationHandler对象
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #ce537a; font-weight: bold;">InvocationHandler</span> <span style="color: #bc6ec5; font-weight: bold;">getInvocationHandler</span><span style="color: #4f97d7;">(</span><span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #7590db;">proxy</span><span style="color: #4f97d7;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">IllegalArgumentException</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org758bb7d" class="outline-4">
<h4 id="org758bb7d"><span class="section-number-4">15.1.4</span> 创建代理：方式1</h4>
<div class="outline-text-4" id="text-15-1-4">
</div>
<ol class="org-ol">
<li><a id="org45b7c95"></a>步骤<br />
<div class="outline-text-5" id="text-15-1-4-1">
<ol class="org-ol">
<li>调用Proxy.getProxyClass方法获取代理类的Class对象</li>
<li>使用InvocationHandler接口创建代理类的处理器</li>
<li>通过代理类和InvocationHandler创建代理对象</li>
<li>使用代理对象了</li>
</ol>
</div>
</li>
<li><a id="org3fd54a4"></a>案例<br />
<div class="outline-text-5" id="text-15-1-4-2">
<p>
创建接口IService
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">interface</span> <span style="color: #ce537a; font-weight: bold;">IService</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m1</span><span style="color: #bc6ec5;">()</span>;
    <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m2</span><span style="color: #bc6ec5;">()</span>;
    <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m3</span><span style="color: #bc6ec5;">()</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
创建IService接口的代理对象
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Test</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m1</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">NoSuchMethodException</span>,<span style="color: #ce537a; font-weight: bold;">IllegalAccessException</span>,<span style="color: #ce537a; font-weight: bold;">InvocationTargetException</span>,<span style="color: #ce537a; font-weight: bold;">InstantiationException</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">1. &#33719;&#21462;&#25509;&#21475;&#23545;&#24212;&#30340;&#20195;&#29702;&#31867;</span>
  <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">IService</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">proxyClass</span> = <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #2d9574;">&lt;</span><span style="color: #ce537a; font-weight: bold;">IService</span><span style="color: #2d9574;">&gt;</span><span style="color: #bc6ec5;">)</span>Proxy.getProxyClass<span style="color: #bc6ec5;">(</span>IService.<span style="color: #4f97d7; font-weight: bold;">class</span>.getClassLoader<span style="color: #2d9574;">()</span>, IService.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #bc6ec5;">)</span>;
  <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">2. &#21019;&#24314;&#20195;&#29702;&#31867;&#30340;&#22788;&#29702;&#22120;</span>
  <span style="color: #ce537a; font-weight: bold;">InvocationHandler</span> <span style="color: #7590db;">invocationHandler</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">InvocationHandler</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
          <span style="color: #a45bad;">@override</span>
          <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #bc6ec5; font-weight: bold;">invoke</span><span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #7590db;">proxy</span>, <span style="color: #ce537a; font-weight: bold;">Method</span> <span style="color: #7590db;">method</span>, <span style="color: #ce537a; font-weight: bold;">Ojbect</span><span style="color: #67b11d;">[]</span> <span style="color: #7590db;">args</span><span style="color: #2d9574;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">Throwable</span> <span style="color: #2d9574;">{</span>
            System.out.println<span style="color: #67b11d;">(</span><span style="color: #2d9574;">"&#25105;&#26159;InvocationHandler,&#34987;&#35843;&#29992;&#30340;&#26041;&#27861;&#26159;"</span> + method.getName<span style="color: #b1951d;">()</span><span style="color: #67b11d;">)</span>;
            <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">null</span>;
          <span style="color: #2d9574;">}</span>
      <span style="color: #bc6ec5;">}</span>;
  <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">3. &#21019;&#24314;&#20195;&#29702;&#23454;&#20363;</span>
  <span style="color: #ce537a; font-weight: bold;">IService</span> <span style="color: #7590db;">proxyService</span> = proxyClass.getConstructor<span style="color: #bc6ec5;">(</span>InvocationHandler.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #bc6ec5;">)</span>.newInstance<span style="color: #bc6ec5;">(</span>invocationHandler<span style="color: #bc6ec5;">)</span>;
  <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">4. &#35843;&#29992;&#20195;&#29702;&#30340;&#26041;&#27861;</span>
  proxyService.m1<span style="color: #bc6ec5;">()</span>;
  proxyService.m2<span style="color: #bc6ec5;">()</span>;
  proxyService.m3<span style="color: #bc6ec5;">()</span>;
<span style="color: #4f97d7;">}</span>

</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org44cbb0c" class="outline-4">
<h4 id="org44cbb0c"><span class="section-number-4">15.1.5</span> 创建代理：方式2</h4>
<div class="outline-text-4" id="text-15-1-5">
</div>
<ol class="org-ol">
<li><a id="org87824ea"></a>步骤<br />
<div class="outline-text-5" id="text-15-1-5-1">
<ol class="org-ol">
<li>使用InvocationHandler接口创建代理类的处理器</li>
<li>使用proxy类的静态方法newProxyInstance直接创建代理对象</li>
<li>使用代理对象</li>
</ol>
</div>
</li>
<li><a id="org018c1c1"></a>案例<br />
<div class="outline-text-5" id="text-15-1-5-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Test</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m2</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">NoSuchMethodException</span>,<span style="color: #ce537a; font-weight: bold;">IllegalAccessException</span>,<span style="color: #ce537a; font-weight: bold;">InvocationTargetException</span>,<span style="color: #ce537a; font-weight: bold;">InstantiationException</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">1. &#21019;&#24314;&#20195;&#29702;&#22788;&#29702;&#22120;</span>
    <span style="color: #ce537a; font-weight: bold;">InvocationHandler</span> <span style="color: #7590db;">invocationHandler</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">InvocationHandler</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
            <span style="color: #a45bad;">@override</span>
            <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #bc6ec5; font-weight: bold;">invoke</span><span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">Object</span> <span style="color: #7590db;">proxy</span>, <span style="color: #ce537a; font-weight: bold;">Method</span> <span style="color: #7590db;">method</span>, <span style="color: #ce537a; font-weight: bold;">Object</span><span style="color: #67b11d;">[]</span> <span style="color: #7590db;">args</span><span style="color: #2d9574;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">Throwable</span> <span style="color: #2d9574;">{</span>
              System.out.println<span style="color: #67b11d;">(</span><span style="color: #2d9574;">"&#25105;&#26159;InvocationHandler,&#34987;&#35843;&#29992;&#30340;&#26041;&#27861;&#26159;"</span> + method.getName<span style="color: #b1951d;">()</span><span style="color: #67b11d;">)</span>;
              <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">null</span>;
            <span style="color: #2d9574;">}</span>
        <span style="color: #bc6ec5;">}</span>;
    <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">2. &#21019;&#24314;&#20195;&#29702;&#23454;&#20363;</span>
    <span style="color: #ce537a; font-weight: bold;">IService</span> <span style="color: #7590db;">proxyService</span> = <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">IService</span><span style="color: #bc6ec5;">)</span>Proxy.newProxyInstance<span style="color: #bc6ec5;">(</span>IService.<span style="color: #4f97d7; font-weight: bold;">class</span>.getClassLoader<span style="color: #2d9574;">()</span>, <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #2d9574;">[]{</span>IService.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #2d9574;">}</span>, invocationHandler<span style="color: #bc6ec5;">)</span>;
    <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">3. &#35843;&#29992;&#20195;&#29702;&#30340;&#26041;&#27861;</span>
    proxyService.m1<span style="color: #bc6ec5;">()</span>;
    proxyService.m2<span style="color: #bc6ec5;">()</span>;
    proxyService.m3<span style="color: #bc6ec5;">()</span>;
<span style="color: #4f97d7;">}</span>

</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orgfad9afd" class="outline-2">
<h2 id="orgfad9afd"><span class="section-number-2">16</span> java注解</h2>
<div class="outline-text-2" id="text-16">
</div>
<div id="outline-container-orge1ad8bc" class="outline-3">
<h3 id="orge1ad8bc"><span class="section-number-3">16.1</span> 什么是注解</h3>
<div class="outline-text-3" id="text-16-1">
<p>
注解是对代码的一种增强，可以在代码编译或者程序运行期间获取注解的信息，然后根据这些信息做各种你牛逼的事情
</p>
</div>
</div>
<div id="outline-container-orgb9335d4" class="outline-3">
<h3 id="orgb9335d4"><span class="section-number-3">16.2</span> 注解的使用方式</h3>
<div class="outline-text-3" id="text-16-2">
</div>
<div id="outline-container-orgf709024" class="outline-4">
<h4 id="orgf709024"><span class="section-number-4">16.2.1</span> 步骤</h4>
<div class="outline-text-4" id="text-16-2-1">
<ol class="org-ol">
<li>定义注解</li>
<li>使用注解</li>
<li>获取注解信息做各种牛逼的事情</li>
</ol>
</div>
</div>
<div id="outline-container-org57a90e7" class="outline-4">
<h4 id="org57a90e7"><span class="section-number-4">16.2.2</span> 定义注解</h4>
<div class="outline-text-4" id="text-16-2-2">
</div>
<ol class="org-ol">
<li><a id="org579387b"></a>定义注解语法<br />
<div class="outline-text-5" id="text-16-2-2-1">
<p>
jdk中注解相关的类和接口都定义于 java.lang.annotation 包中。
</p>

<p>
注解的定义和我们常见的类，接口类似，只是注解使用 @interface 来定义，如下定义一个名称为MyAnnotation的注解
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">MyAnnotation</span><span style="color: #4f97d7;">{}</span>
</pre>
</div>
</div>
</li>
<li><a id="org41ed42e"></a>注解中定义参数<br />
<div class="outline-text-5" id="text-16-2-2-2">
<p>
注解中有没有参数都可以，定义参数如下：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">&#27880;&#35299;&#21517;&#31216;</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #bc6ec5;">[</span><span style="color: #4f97d7; font-weight: bold;">public</span><span style="color: #bc6ec5;">]</span> &#21442;&#25968;&#31867;&#22411; &#21442;&#25968;&#21517;&#31216;1<span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">[</span><span style="color: #4f97d7; font-weight: bold;">default</span> &#21442;&#25968;&#40664;&#35748;&#20540;<span style="color: #bc6ec5;">]</span>;
    <span style="color: #bc6ec5;">[</span><span style="color: #4f97d7; font-weight: bold;">public</span><span style="color: #bc6ec5;">]</span> &#21442;&#25968;&#31867;&#22411; &#21442;&#25968;&#21517;&#31216;2<span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">[</span><span style="color: #4f97d7; font-weight: bold;">default</span> &#21442;&#25968;&#40664;&#35748;&#20540;<span style="color: #bc6ec5;">]</span>;
    <span style="color: #bc6ec5;">[</span><span style="color: #4f97d7; font-weight: bold;">public</span><span style="color: #bc6ec5;">]</span> &#21442;&#25968;&#31867;&#22411; &#21442;&#25968;&#21517;&#31216;3<span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">[</span><span style="color: #4f97d7; font-weight: bold;">default</span> &#21442;&#25968;&#40664;&#35748;&#20540;<span style="color: #bc6ec5;">]</span>;

<span style="color: #4f97d7;">}</span>

</pre>
</div>
<p>
注解中可以定义多个参数，参数的定义有以下特点：
</p>
<ol class="org-ol">
<li>访问修饰符必须为public,不屑默认为public</li>
<li>该元素的类型只能是基本数据类型，String,Class,枚举类型，注解类型(体现了注解的嵌套效果)以及上述类型的一位数组</li>
<li>该元素的名称一般定义为名词，如果注解中只有一个元素，请把名字起为value(后面使用会带来便利操作)</li>
<li>参数名称后面()不是定义方法参数的地方，也不能在括号中定义任何参数，仅仅只是一个特殊的语法。</li>
<li>default代表默认值，值比u和第二点定义的类型保持一致。</li>
<li>如果没有默认值，代表后续使用注解时必须给该类型元素赋值。</li>
</ol>
</div>
</li>
<li><a id="orgb129780"></a>指定注解的使用范围： @Target<br />
<div class="outline-text-5" id="text-16-2-2-3">
<p>
使用@Target注解定义注解的使用范围如下：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span>value=<span style="color: #bc6ec5;">{</span><span style="color: #a45bad;">ElementType</span>.TYPE, <span style="color: #a45bad;">ElementType</span>.METHOD<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">MyAnnotation</span><span style="color: #4f97d7;">{}</span>
</pre>
</div>
<p>
上面指定了MyAnnotation注解可以用在类，接口，注解类型，枚举类型以及方法上面，自定义注解上也可以不使用@Target注解，如果不使用，表示自定义
注解可以用在任何地方。
</p>

<p>
下面看一下@Target源码：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Documented</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">ANNOTATION_TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Target</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #ce537a; font-weight: bold;">ElementType</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
有一个参数时value,时ElemtnType类型的一个数组，再来看一下ElementType,是个枚举，源码如下：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ce537a; font-weight: bold;">pacage</span> java.lang.<span style="color: #7590db;">annotation</span>;
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">enum</span> <span style="color: #ce537a; font-weight: bold;">ElementType</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#31867;&#65292;&#25509;&#21475;&#65292;&#26522;&#20030;&#65292;&#27880;&#35299;&#19978;&#38754;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">TYPE</span>,
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#23383;&#27573;&#19978;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">FIELD</span>,
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#26041;&#27861;&#19978;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">Mehtod</span>,
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#26041;&#27861;&#21442;&#25968;&#19978;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">PARAMETER</span>,
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#26500;&#36896;&#20989;&#25968;&#19978;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">CONSTRUCTOR</span>,
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#26412;&#22320;&#21464;&#37327;&#19978;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">LOCAL_VARIABLE</span>,
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#27880;&#35299;&#19978;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">ANNOTATION_TYPE</span>,
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#21253;&#19978;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">PACKAGE</span>,
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#31867;&#22411;&#21442;&#25968;&#19978;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">TYPE_PARAMETER</span>,
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#31867;&#22411;&#21517;&#31216;&#19978;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">TYPE_USE</span>

<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>

<li><a id="org4a2395d"></a>指定注解的保留策略：@Retention<br />
<ol class="org-ol">
<li><a id="org9efea93"></a>java程序的三个过程<br />
<div class="outline-text-6" id="text-16-2-2-4-1">
<ol class="org-ol">
<li>源码阶段</li>
<li>源码被编译为字节码之后变成class文件</li>
<li>字节码被虚拟机加载然后运行</li>
</ol>
</div>
</li>
<li><a id="orgeed2ec8"></a>自定义保留策略<br />
<div class="outline-text-6" id="text-16-2-2-4-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">SOURCE</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">MyAnnotation</span><span style="color: #4f97d7;">{}</span>
</pre>
</div>
<p>
上面指定了MyAnnotation只存在于源码阶段，后面的阶段都会丢失。
</p>

<p>
@Retention源码
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Documented</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">ANNOTATION_TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Retention</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">RetentionPolicy</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span>;
<span style="color: #4f97d7;">}</span>

</pre>
</div>
<p>
有一个value参数，类型为RetentionPolicy枚举，如下：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">enum</span> <span style="color: #ce537a; font-weight: bold;">RetentionPolicy</span> <span style="color: #4f97d7;">{</span>
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#27880;&#35299;&#20540;&#20445;&#30041;&#22312;&#28304;&#30721;&#38454;&#27573;&#65292;&#32534;&#35793;&#20026;&#23383;&#33410;&#30721;&#20043;&#21518;&#23601;&#20002;&#22833;&#20102;&#65292;&#20063;&#23601;&#26159;class&#25991;&#20214;&#20013;&#23601;&#19981;&#23384;&#22312;&#20102;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">SOURCE</span>,
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#27880;&#35299;&#21482;&#20445;&#30041;&#22312;&#28304;&#30721;&#21644;&#23383;&#33410;&#30721;&#20013;&#65292;&#36816;&#34892;&#38454;&#27573;&#20250;&#20002;&#22833;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">CLASS</span>,
  <span style="color: #2aa1ae; background-color: #292e34;">/*</span><span style="color: #2aa1ae; background-color: #292e34;">&#28304;&#30721;&#65292;&#23383;&#33410;&#30721;&#65292;&#36816;&#34892;&#26399;&#38388;&#37117;&#23384;&#22312;</span><span style="color: #2aa1ae; background-color: #292e34;">*/</span>
  <span style="color: #7590db;">RUNTIME</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>

<div id="outline-container-orgd6b5da0" class="outline-4">
<h4 id="orgd6b5da0"><span class="section-number-4">16.2.3</span> 使用注解</h4>
<div class="outline-text-4" id="text-16-2-3">
</div>
<ol class="org-ol">
<li><a id="org882dc1f"></a>语法<br />
<div class="outline-text-5" id="text-16-2-3-1">
<p>
将注解加载使用的目标上面，如下：
</p>
<div class="org-src-container">
<pre class="src src-java">@&#27880;&#35299;&#21517;&#31216;<span style="color: #4f97d7;">(</span>&#21442;&#25968;1=&#20540;1&#65292;&#21442;&#25968;2=&#20540;2&#65292;&#21442;&#25968;n=&#20540;n<span style="color: #4f97d7;">)</span>
&#30446;&#26631;&#23545;&#35937;
</pre>
</div>
</div>
</li>
<li><a id="org49583d9"></a>无参注解<br />
<div class="outline-text-5" id="text-16-2-3-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann1</span><span style="color: #4f97d7;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #a45bad;">@Ann1</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation1</span><span style="color: #4f97d7;">{}</span>

</pre>
</div>
<p>
@1: Ann1为无参注解
</p>

<p>
@2：类上使用@Ann1注解，没有参数
</p>
</div>
</li>

<li><a id="orgcf24b1d"></a>一个参数注解<br />
<div class="outline-text-5" id="text-16-2-3-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann2</span> <span style="color: #4f97d7;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">name</span><span style="color: #bc6ec5;">()</span>;
<span style="color: #4f97d7;">}</span>
<span style="color: #a45bad;">@Ann2</span><span style="color: #4f97d7;">(</span>name = <span style="color: #2d9574;">"java1"</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation2</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>
<li><a id="orgcdec6f0"></a>一个参数为value的注解，可以省略参数名称<br />
<div class="outline-text-5" id="text-16-2-3-4">
<p>
只有一个参数，名称为value的时候，使用时参数名称可以省略
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann3</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span>;<span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
<span style="color: #4f97d7;">}</span>
<span style="color: #a45bad;">@Ann3</span><span style="color: #4f97d7;">(</span><span style="color: #2d9574;">"java1"</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation3</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
@1: 注解之后的一个参数，名称为value。
</p>

<p>
@2：使用注解，参数名称value省略了
</p>
</div>
</li>

<li><a id="orgad8c149"></a>数组类型参数<br />
<div class="outline-text-5" id="text-16-2-3-5">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann4</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">name</span><span style="color: #bc6ec5;">()</span>;<span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
<span style="color: #4f97d7;">}</span>

<span style="color: #a45bad;">@Ann4</span><span style="color: #4f97d7;">(</span>name = <span style="color: #bc6ec5;">{</span><span style="color: #2d9574;">"java1"</span>, <span style="color: #2d9574;">"java2"</span><span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation4</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@Ann4</span><span style="color: #bc6ec5;">(</span>name = <span style="color: #2d9574;">"&#22914;&#26524;&#21482;&#26377;&#19968;&#20010;&#20540;&#65292;{}&#21487;&#20197;&#30465;&#30053;}"</span><span style="color: #bc6ec5;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@3</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">T1</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
@1: name的类型是一个String类型的数组
</p>

<p>
@2：name有多个值的时候，需要用{}包含起来
</p>

<p>
@3: 如果name只有一个值，{}可以省略
</p>
</div>
</li>
<li><a id="org93b6b8f"></a>为参数指定默认值<br />
<div class="outline-text-5" id="text-16-2-3-6">
<p>
通过default为参数指定默认值，用的时候如果没有设置值，则取默认值的参数，使用的时候必须为参数设置值，如下
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann5</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">name</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #bc6ec5;">{</span><span style="color: #2d9574;">"java"</span>, <span style="color: #2d9574;">"spring"</span><span style="color: #bc6ec5;">}</span>;<span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
    <span style="color: #ce537a; font-weight: bold;">int</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">score</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> 1; <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
    <span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #bc6ec5; font-weight: bold;">age</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> 30; <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@3</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">address</span><span style="color: #bc6ec5;">()</span>; <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@4</span>
<span style="color: #4f97d7;">}</span>
<span style="color: #a45bad;">@Ann5</span><span style="color: #4f97d7;">(</span>age = 32,address = <span style="color: #2d9574;">"&#19978;&#28023;"</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@5</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation5</span> <span style="color: #4f97d7;">{}</span>
</pre>
</div>
<p>
@1： 数组类型通过{}指定默认值
</p>

<p>
@2： 数组类型参数，默认值只有一个省略了{}符号
</p>

<p>
@3： 默认值为30
</p>

<p>
@4： 未指定默认值
</p>

<p>
@5： age=32对默认值进行了覆盖，并且为address指定了值
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org4147f86" class="outline-4">
<h4 id="org4147f86"><span class="section-number-4">16.2.4</span> 综合案例</h4>
<div class="outline-text-4" id="text-16-2-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span>value = <span style="color: #bc6ec5;">{</span><span style="color: #a45bad;">ElementType</span>.TYPE,<span style="color: #a45bad;">ElementType</span>.METHOD,<span style="color: #a45bad;">ElementType</span>.FIELD,<span style="color: #a45bad;">ElementType</span>.PARAMETER,<span style="color: #a45bad;">ElementType</span>.CONSTRUCTOR,<span style="color: #a45bad;">ElementType</span>.LOCAL_VARIABLE<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann6</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span>;
    <span style="color: #ce537a; font-weight: bold;">ElementType</span> <span style="color: #bc6ec5; font-weight: bold;">elementType</span><span style="color: #bc6ec5;">()</span>;
<span style="color: #4f97d7;">}</span>


<span style="color: #a45bad;">@Ann6</span><span style="color: #4f97d7;">(</span>value = <span style="color: #2d9574;">"&#29992;&#22312;&#31867;&#19978;"</span>, elementType = <span style="color: #a45bad;">ElementType</span>.TYPE<span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation6</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@Ann6</span><span style="color: #bc6ec5;">(</span>value = <span style="color: #2d9574;">"&#29992;&#22312;&#23383;&#27573;&#19978;"</span>, elementType = <span style="color: #a45bad;">ElementType</span>.FIELD<span style="color: #bc6ec5;">)</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">a</span>;
    <span style="color: #a45bad;">@Ann6</span><span style="color: #bc6ec5;">(</span>value = <span style="color: #2d9574;">"&#29992;&#22312;&#26500;&#36896;&#26041;&#27861;&#19978;"</span>, elementType = <span style="color: #a45bad;">ElementType</span>.CONSTRUCTOR<span style="color: #bc6ec5;">)</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #bc6ec5; font-weight: bold;">UseAnnotation6</span><span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">@Ann6</span><span style="color: #2d9574;">(</span>value = <span style="color: #2d9574;">"&#29992;&#22312;&#26041;&#27861;&#21442;&#25968;&#19978;"</span>, elementType = <span style="color: #a45bad;">ElementType</span>.PARAMETER<span style="color: #2d9574;">)</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">a</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.a = a;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #a45bad;">@Ann6</span><span style="color: #bc6ec5;">(</span>value = <span style="color: #2d9574;">"&#29992;&#22312;&#26041;&#27861;&#19978;"</span>, elementType = <span style="color: #a45bad;">ElementType</span>.METHOD<span style="color: #bc6ec5;">)</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m1</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #a45bad;">@Ann6</span><span style="color: #2d9574;">(</span>value = <span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#26412;&#22320;&#21464;&#37327;&#19978;"</span>, elementType = <span style="color: #a45bad;">ElementType</span>.LOCAL_VARIABLE<span style="color: #2d9574;">)</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">a</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
上面演示了自定义注解在类，字段，构造器，方法参数，方法，本地变量上的使用，@Ann6注解有个elementType参数，我想通过这个参数的值告诉大家
对应@Target中的那个值来限制使用目标的，注意以下上面每个elementType的值。
</p>
</div>
</div>

<div id="outline-container-org2a28879" class="outline-4">
<h4 id="org2a28879"><span class="section-number-4">16.2.5</span> @Target(ElementType.TYPE<sub>PARAMETER</sub>)</h4>
<div class="outline-text-4" id="text-16-2-5">
<p>
这个是1.8之后才有的，用来标注类型参数，类型参数一般在类后面声明或者方法上面声明，这块需要先了解以下泛型
</p>

<p>
案例：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span>value = <span style="color: #bc6ec5;">{</span><span style="color: #a45bad;">ElementType</span>.TYPE_PARAMETER<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann7</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span>;
<span style="color: #4f97d7;">}</span>

<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation7</span><span style="color: #4f97d7;">&lt;</span><span style="color: #ce537a; font-weight: bold;">@Ann7</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"T0&#26159;&#22312;&#31867;&#19978;&#22768;&#26126;&#30340;&#19968;&#20010;&#27867;&#22411;&#31867;&#22411;&#21464;&#37327;"</span><span style="color: #bc6ec5;">)</span> T0, <span style="color: #ce537a; font-weight: bold;">@Ann7</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"T1&#26159;&#22312;&#31867;&#19978;&#22768;&#26126;&#30340;&#19968;&#20010;&#27867;&#22411;&#31867;&#22411;&#21464;&#37327;"</span><span style="color: #bc6ec5;">)</span> T1<span style="color: #4f97d7;">&gt;</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">@Ann7</span><span style="color: #2d9574;">(</span><span style="color: #2d9574;">"T2&#26159;&#22312;&#26041;&#27861;&#19978;&#22768;&#26126;&#30340;&#27867;&#22411;&#31867;&#22411;&#21464;&#37327;"</span><span style="color: #2d9574;">)</span> T2<span style="color: #bc6ec5;">&gt;</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m1</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">main</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #2d9574;">[]</span> <span style="color: #7590db;">args</span><span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">NoSuchMethodException</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">TypeVariable</span> <span style="color: #7590db;">typeVariable</span> : UseAnnotation7.<span style="color: #4f97d7; font-weight: bold;">class</span>.getTypeParameters<span style="color: #67b11d;">()</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
            print<span style="color: #67b11d;">(</span>typeVariable<span style="color: #67b11d;">)</span>;
        <span style="color: #2d9574;">}</span>
        <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">TypeVariable</span> <span style="color: #7590db;">typeVariable</span> : UseAnnotation7.<span style="color: #4f97d7; font-weight: bold;">class</span>.getDeclaredMethod<span style="color: #67b11d;">(</span><span style="color: #2d9574;">"m1"</span><span style="color: #67b11d;">)</span>.getTypeParameters<span style="color: #67b11d;">()</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
            print<span style="color: #67b11d;">(</span>typeVariable<span style="color: #67b11d;">)</span>;
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">print</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">TypeVariable</span> <span style="color: #7590db;">typeVariable</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"&#31867;&#22411;&#21464;&#37327;&#21517;&#31216;:"</span> + typeVariable.getName<span style="color: #67b11d;">()</span><span style="color: #2d9574;">)</span>;
        Arrays.stream<span style="color: #2d9574;">(</span>typeVariable.getAnnotations<span style="color: #67b11d;">()</span><span style="color: #2d9574;">)</span>.forEach<span style="color: #2d9574;">(</span>System.out::println<span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
类和方法上面可以声明泛型类型的变量，下面是运行结果
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">&#31867;&#22411;&#21464;&#37327;&#21517;&#31216;</span>:<span style="color: #ce537a; font-weight: bold;">T0</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.<span style="color: #bc6ec5; font-weight: bold;">Ann7</span><span style="color: #4f97d7;">(</span>value=T0&#26159;&#22312;&#31867;&#19978;&#22768;&#26126;&#30340;&#19968;&#20010;&#27867;&#22411;&#31867;&#22411;&#21464;&#37327;<span style="color: #4f97d7;">)</span>
&#31867;&#22411;&#21464;&#37327;&#21517;&#31216;:T1
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann7<span style="color: #4f97d7;">(</span>value=T1&#26159;&#22312;&#31867;&#19978;&#22768;&#26126;&#30340;&#19968;&#20010;&#27867;&#22411;&#31867;&#22411;&#21464;&#37327;<span style="color: #4f97d7;">)</span>
&#31867;&#22411;&#21464;&#37327;&#21517;&#31216;:T2
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann7<span style="color: #4f97d7;">(</span>value=T2&#26159;&#22312;&#26041;&#27861;&#19978;&#22768;&#26126;&#30340;&#27867;&#22411;&#31867;&#22411;&#21464;&#37327;<span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5928bb0" class="outline-4">
<h4 id="org5928bb0"><span class="section-number-4">16.2.6</span> @Target(ElementType.TYPE<sub>USE</sub>)</h4>
<div class="outline-text-4" id="text-16-2-6">
<p>
这个是1.8加上的，能用在任何类型名称上面
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span><span style="color: #a45bad;">ElementType</span>.TYPE_USE<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann10</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span>;
<span style="color: #4f97d7;">}</span>
<span style="color: #a45bad;">@Ann10</span><span style="color: #4f97d7;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#31867;&#19978;"</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UserAnnotation10</span><span style="color: #4f97d7;">&lt;</span><span style="color: #ce537a; font-weight: bold;">@Ann10</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#31867;&#21464;&#37327;&#31867;&#22411;V1&#19978;"</span><span style="color: #bc6ec5;">)</span> V1, <span style="color: #ce537a; font-weight: bold;">@Ann10</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#31867;&#21464;&#37327;&#31867;&#22411;V2&#19978;"</span><span style="color: #bc6ec5;">)</span> V2<span style="color: #4f97d7;">&gt;</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">Map</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">@Ann10</span><span style="color: #2d9574;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#27867;&#22411;&#31867;&#22411;&#19978;"</span><span style="color: #2d9574;">)</span> <span style="color: #ce537a; font-weight: bold;">String</span>, <span style="color: #ce537a; font-weight: bold;">Integer</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">map</span>;
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">@Ann10</span><span style="color: #2d9574;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#21442;&#25968;&#19978;"</span><span style="color: #2d9574;">)</span> T<span style="color: #bc6ec5;">&gt;</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">m1</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">null</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
类后面的V1、V2都是类型名称，Map后面的尖括号也是类型名称，m1方法前面也定义了一个类型变量，名称为T
</p>
</div>
</div>
</div>

<div id="outline-container-org56036f9" class="outline-3">
<h3 id="org56036f9"><span class="section-number-3">16.3</span> 注解信息的获取</h3>
<div class="outline-text-3" id="text-16-3">
<p>
为了运行时能准确获取到注解的相关信息，Java在java.lang.reflect反射包下新增了AnnotatedElement接口，他主要用于表示目前正在虚拟机中
运行的程序中已使用注解的元素，通过该接口提供的方法，可以利用反射技术读取注解的信息,UML图如下(实现类)
</p>
</div>
<div id="outline-container-orgaafa2d5" class="outline-4">
<h4 id="orgaafa2d5"><span class="section-number-4">16.3.1</span> AnnotateElement</h4>
<div class="outline-text-4" id="text-16-3-1">
<ul class="org-ul">
<li>Method： 用来表示方法信息</li>
<li>TypeVariable: 用来表示类型变量信息，如：类上定义的泛型类型变量，方法上面定义的泛型类型变量</li>
<li>Class: 用来表示类的信息</li>
<li>Package: 用来表示包的信息</li>
<li>Field: 用来表示类中属性信息</li>
<li>Constructor: 用来表示构造方法信息</li>
<li>Parameter: 用来表示方法参数信息</li>
</ul>
</div>
</div>
<div id="outline-container-org1bc011c" class="outline-4">
<h4 id="org1bc011c"><span class="section-number-4">16.3.2</span> AnnotateElement常用方法</h4>
<div class="outline-text-4" id="text-16-3-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">返回值</th>
<th scope="col" class="org-left">方法名称</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">&lt;A extends Annotation&gt;</td>
<td class="org-left">getAnnotation(Class&lt;A&gt; annotationClass)</td>
<td class="org-left">该元素如果存在指定类型的注解，则返回这些注解，否则返回 null。</td>
</tr>

<tr>
<td class="org-left">Annotation[]</td>
<td class="org-left">getAnnotations()</td>
<td class="org-left">返回此元素上存在的所有注解，包括从父类继承的</td>
</tr>

<tr>
<td class="org-left">boolean</td>
<td class="org-left">isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass)</td>
<td class="org-left">如果指定类型的注解存在于此元素上，则返回true，否则返回 false。</td>
</tr>

<tr>
<td class="org-left">Annotation[]</td>
<td class="org-left">getDeclaredAnnotations()</td>
<td class="org-left">返回直接存在于此元素上的所有注解，注意，不包括父类的注解，调用者可以随意修改返回的数组；这不会对其他调用者返回的数组产生任何影响，没有则返回长度为0的数组</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgbc3cd5d" class="outline-4">
<h4 id="orgbc3cd5d"><span class="section-number-4">16.3.3</span> 案例</h4>
<div class="outline-text-4" id="text-16-3-3">
<p>
要解析的类如下
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">ElementType</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">Retention</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">RetentionPolicy</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">Target</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">util</span>.<span style="color: #ce537a; font-weight: bold;">Map</span>;
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span><span style="color: #a45bad;">ElementType</span>.PACKAGE,
            <span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span>,
            <span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">FIELD</span>,
            <span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">CONSTRUCTOR</span>,
            <span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">METHOD</span>,
            <span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">PARAMETER</span>,
            <span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE_PARAMETER</span>,
            <span style="color: #a45bad;">ElementType</span>.TYPE_USE<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
            <span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
            <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann11</span> <span style="color: #4f97d7;">{</span>
                <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span>;
            <span style="color: #4f97d7;">}</span>

<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span><span style="color: #a45bad;">ElementType</span>.PACKAGE,
            <span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span>,
            <span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">FIELD</span>,
            <span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">CONSTRUCTOR</span>,
            <span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">METHOD</span>,
            <span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">PARAMETER</span>,
            <span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE_PARAMETER</span>,
            <span style="color: #a45bad;">ElementType</span>.TYPE_USE<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
            <span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
            <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann11_0</span> <span style="color: #4f97d7;">{</span>
                <span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span>;
            <span style="color: #4f97d7;">}</span>

<span style="color: #a45bad;">@Ann11</span><span style="color: #4f97d7;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#31867;&#19978;"</span><span style="color: #4f97d7;">)</span>
@Ann11_0<span style="color: #4f97d7;">(</span>0<span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation11</span><span style="color: #4f97d7;">&lt;</span><span style="color: #ce537a; font-weight: bold;">@Ann11</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#31867;&#21464;&#37327;&#31867;&#22411;V1&#19978;"</span><span style="color: #bc6ec5;">)</span> @Ann11_0<span style="color: #bc6ec5;">(</span>1<span style="color: #bc6ec5;">)</span> V1,<span style="color: #ce537a; font-weight: bold;">@Ann11</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#31867;&#21464;&#37327;&#31867;&#22411;V2&#19978;"</span><span style="color: #bc6ec5;">)</span> @Ann11_0<span style="color: #bc6ec5;">(</span>2<span style="color: #bc6ec5;">)</span> V2<span style="color: #4f97d7;">&gt;</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@Ann11</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#23383;&#27573;&#19978;"</span><span style="color: #bc6ec5;">)</span>
    @Ann11_0<span style="color: #bc6ec5;">(</span>3<span style="color: #bc6ec5;">)</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span>;

    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">Map</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">@Ann11</span><span style="color: #2d9574;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#27867;&#22411;&#31867;&#22411;&#19978;,String"</span><span style="color: #2d9574;">)</span> @Ann11_0<span style="color: #2d9574;">(</span>4<span style="color: #2d9574;">)</span> <span style="color: #ce537a; font-weight: bold;">String</span>, <span style="color: #ce537a; font-weight: bold;">@Ann11</span><span style="color: #2d9574;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#27867;&#22411;&#31867;&#22411;&#19978;,Integer"</span><span style="color: #2d9574;">)</span> @Ann11_0<span style="color: #2d9574;">(</span>5<span style="color: #2d9574;">)</span> <span style="color: #ce537a; font-weight: bold;">Integer</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">map</span>;

    <span style="color: #a45bad;">@Ann11</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#26500;&#36896;&#26041;&#27861;&#19978;"</span><span style="color: #bc6ec5;">)</span>
    @Ann11_0<span style="color: #bc6ec5;">(</span>6<span style="color: #bc6ec5;">)</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #bc6ec5; font-weight: bold;">UseAnnotation11</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">this</span>.name = name;
    <span style="color: #bc6ec5;">}</span>

    <span style="color: #a45bad;">@Ann11</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#36820;&#22238;&#20540;&#19978;"</span><span style="color: #bc6ec5;">)</span>
    @Ann11_0<span style="color: #bc6ec5;">(</span>7<span style="color: #bc6ec5;">)</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">m1</span><span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">@Ann11</span><span style="color: #2d9574;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#21442;&#25968;&#19978;"</span><span style="color: #2d9574;">)</span> @Ann11_0<span style="color: #2d9574;">(</span>8<span style="color: #2d9574;">)</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">null</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="orga314e72"></a>解析类上的注解<br />
<ol class="org-ol">
<li><a id="org56b7b85"></a>解析这部分<br />
<div class="outline-text-6" id="text-16-3-3-1-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Ann11</span><span style="color: #4f97d7;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#31867;&#19978;"</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org5f4a5b5"></a>代码<br />
<div class="outline-text-6" id="text-16-3-3-1-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Test</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m1</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Annotation</span> <span style="color: #7590db;">annotation</span> : UserAnnotation11.<span style="color: #4f97d7; font-weight: bold;">class</span>.getAnnotations<span style="color: #2d9574;">()</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span>annotation<span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
运行输出
</p>
<div class="org-src-container">
<pre class="src src-java">@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">demo18</span>.Ann11<span style="color: #4f97d7;">(</span>value=&#29992;&#22312;&#20102;&#31867;&#19978;<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">demo18</span>.Ann11_0<span style="color: #4f97d7;">(</span>value=0<span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org08682f8"></a>解析类上的类型变量<br />
<div class="outline-text-5" id="text-16-3-3-2">
<p>
解析类名后面的尖括号的部分，即下面这部分
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ce537a; font-weight: bold;">UseAnnotation11</span><span style="color: #4f97d7;">&lt;</span><span style="color: #ce537a; font-weight: bold;">@Ann11</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#31867;&#21464;&#37327;&#31867;&#22411;V1&#19978;"</span><span style="color: #bc6ec5;">)</span> @Ann11_0<span style="color: #bc6ec5;">(</span>1<span style="color: #bc6ec5;">)</span> V1, <span style="color: #ce537a; font-weight: bold;">@Ann11</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"&#29992;&#22312;&#20102;&#31867;&#21464;&#37327;&#31867;&#22411;V2&#19978;"</span><span style="color: #bc6ec5;">)</span> @Ann11_0<span style="color: #bc6ec5;">(</span>2<span style="color: #bc6ec5;">)</span> V2<span style="color: #4f97d7;">&gt;</span>
</pre>
</div>
<p>
用例代码：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Test</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m2</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">TypeVariable</span><span style="color: #bc6ec5;">&lt;</span><span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #2d9574;">&lt;</span><span style="color: #ce537a; font-weight: bold;">UserAnnotation10</span><span style="color: #2d9574;">&gt;</span><span style="color: #bc6ec5;">&gt;[]</span> <span style="color: #7590db;">typeParameters</span> = UserAnnotation10.<span style="color: #4f97d7; font-weight: bold;">class</span>.getTypeParameters<span style="color: #bc6ec5;">()</span>;
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">TypeVariable</span><span style="color: #2d9574;">&lt;</span><span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #67b11d;">&lt;</span><span style="color: #ce537a; font-weight: bold;">UserAnnotation10</span><span style="color: #67b11d;">&gt;</span><span style="color: #2d9574;">&gt;</span> <span style="color: #7590db;">typeParameter</span> : typeParameters<span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span>typeParameter.getName<span style="color: #67b11d;">()</span> + <span style="color: #2d9574;">"&#21464;&#37327;&#31867;&#22411;&#27880;&#35299;&#20449;&#24687;&#65306;"</span><span style="color: #2d9574;">)</span>;
        <span style="color: #ce537a; font-weight: bold;">Annotation</span><span style="color: #2d9574;">[]</span> <span style="color: #7590db;">annotations</span> = typeParameter.getAnnotations<span style="color: #2d9574;">()</span>;
        <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">Annotation</span> <span style="color: #7590db;">annotation</span> : annotations<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
            System.out.println<span style="color: #67b11d;">(</span>annotation<span style="color: #67b11d;">)</span>;
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
运行输出：
</p>
<div class="org-src-container">
<pre class="src src-java">V1&#21464;&#37327;&#31867;&#22411;&#27880;&#35299;&#20449;&#24687;&#65306;
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">demo18</span>.Ann11<span style="color: #4f97d7;">(</span>value=&#29992;&#22312;&#20102;&#31867;&#21464;&#37327;&#31867;&#22411;V1&#19978;<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">demo18</span>.Ann11_0<span style="color: #4f97d7;">(</span>value=1<span style="color: #4f97d7;">)</span>
V2&#21464;&#37327;&#31867;&#22411;&#27880;&#35299;&#20449;&#24687;&#65306;
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">demo18</span>.Ann11<span style="color: #4f97d7;">(</span>value=&#29992;&#22312;&#20102;&#31867;&#21464;&#37327;&#31867;&#22411;V2&#19978;<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">demo18</span>.Ann11_0<span style="color: #4f97d7;">(</span>value=2<span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="orgb0cda2c"></a>解析字段name上的注解<br />
<div class="outline-text-5" id="text-16-3-3-3">
<p>
用例代码：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Test</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m3</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">NoSuchFieldException</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">Field</span> <span style="color: #7590db;">nameField</span> = UserAnnotation11.<span style="color: #4f97d7; font-weight: bold;">class</span>.getDeclaredField<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"name"</span><span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Annotation</span> <span style="color: #7590db;">annotation</span> : nameField.getAnnotations<span style="color: #2d9574;">()</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span>annotation<span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
运行输出
</p>
<div class="org-src-container">
<pre class="src src-java">@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann11<span style="color: #4f97d7;">(</span>value=&#29992;&#22312;&#20102;&#23383;&#27573;&#19978;<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann11_0<span style="color: #4f97d7;">(</span>value=3<span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org6b38f45"></a>解析泛型字段map上的注解<br />
<div class="outline-text-5" id="text-16-3-3-4">
<p>
用例代码：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Test</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m4</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">NoSuchFieldException</span>, <span style="color: #ce537a; font-weight: bold;">ClassNotFoundException</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">Field</span> <span style="color: #7590db;">field</span> = UseAnnotation11.<span style="color: #4f97d7; font-weight: bold;">class</span>.getDeclaredField<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"map"</span><span style="color: #bc6ec5;">)</span>;
    <span style="color: #ce537a; font-weight: bold;">Type</span> <span style="color: #7590db;">genericType</span> = field.getGenericType<span style="color: #bc6ec5;">()</span>;
    <span style="color: #ce537a; font-weight: bold;">Type</span><span style="color: #bc6ec5;">[]</span> <span style="color: #7590db;">actualTypeArguments</span> = <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">ParameterizedType</span><span style="color: #2d9574;">)</span>genericType<span style="color: #bc6ec5;">)</span>.getActualTypeArguments<span style="color: #bc6ec5;">()</span>;
    <span style="color: #ce537a; font-weight: bold;">AnnotatedType</span> <span style="color: #7590db;">annotatedType</span> = field.getAnnotatedType<span style="color: #bc6ec5;">()</span>;
    <span style="color: #ce537a; font-weight: bold;">AnnotatedType</span><span style="color: #bc6ec5;">[]</span> <span style="color: #7590db;">annotatedActualTypeArguments</span> = <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">AnnotatedParameterizedType</span><span style="color: #2d9574;">)</span>annotatedType<span style="color: #bc6ec5;">)</span>.getAnnotatedActualTypeArguments<span style="color: #bc6ec5;">()</span>;
    <span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #7590db;">i</span> = 0;
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">AnnotatedType</span> <span style="color: #7590db;">actualTypeArgument</span> : annotatedActualTypeArguments<span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #ce537a; font-weight: bold;">Type</span> <span style="color: #7590db;">actualTypeArgument1</span> = actualTypeArguments<span style="color: #2d9574;">[</span>i++<span style="color: #2d9574;">]</span>;
        System.out.println<span style="color: #2d9574;">(</span>actualTypeArgument1.getTypeName<span style="color: #67b11d;">()</span> + <span style="color: #2d9574;">"&#31867;&#22411;&#19978;&#30340;&#27880;&#35299;&#22914;&#19979;&#65306;"</span><span style="color: #2d9574;">)</span>;
        <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">Annotation</span> <span style="color: #7590db;">annotation</span> : actualTypeArgument.getAnnotations<span style="color: #67b11d;">()</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
            System.out.println<span style="color: #67b11d;">(</span>annotation<span style="color: #67b11d;">)</span>;
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
输出如下：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.String&#31867;&#22411;&#19978;&#30340;&#27880;&#35299;&#22914;&#19979;&#65306;
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann11<span style="color: #4f97d7;">(</span>value=&#29992;&#22312;&#20102;&#27867;&#22411;&#31867;&#22411;&#19978;,String<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann11_0<span style="color: #4f97d7;">(</span>value=4<span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.Integer&#31867;&#22411;&#19978;&#30340;&#27880;&#35299;&#22914;&#19979;&#65306;
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann11<span style="color: #4f97d7;">(</span>value=&#29992;&#22312;&#20102;&#27867;&#22411;&#31867;&#22411;&#19978;,Integer<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann11_0<span style="color: #4f97d7;">(</span>value=5<span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="org8634790"></a>解析构造函数上的注解<br />
<div class="outline-text-5" id="text-16-3-3-5">
<p>
用例代码：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Test</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m5</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">Constructor</span><span style="color: #bc6ec5;">&lt;</span>?<span style="color: #bc6ec5;">&gt;</span> <span style="color: #7590db;">constructor</span> = UseAnnotation11.<span style="color: #4f97d7; font-weight: bold;">class</span>.getConstructors<span style="color: #bc6ec5;">()[</span>0<span style="color: #bc6ec5;">]</span>;
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Annotation</span> <span style="color: #7590db;">annotation</span> : constructor.getAnnotations<span style="color: #2d9574;">()</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span>annotation<span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
运行输出：
</p>
<div class="org-src-container">
<pre class="src src-java">@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann11<span style="color: #4f97d7;">(</span>value=&#29992;&#22312;&#20102;&#26500;&#36896;&#26041;&#27861;&#19978;<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann11_0<span style="color: #4f97d7;">(</span>value=6<span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</li>



<li><a id="org61c4965"></a>解析m1方法上的注解<br />
<div class="outline-text-5" id="text-16-3-3-6">
<p>
用例代码：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Test</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m6</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">NoSuchMethodException</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">Method</span> <span style="color: #7590db;">method</span> = UseAnnotation11.<span style="color: #4f97d7; font-weight: bold;">class</span>.getMethod<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"m1"</span>, String.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Annotation</span> <span style="color: #7590db;">annotation</span> : method.getAnnotations<span style="color: #2d9574;">()</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span>annotation<span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
输出：
</p>
<div class="org-src-container">
<pre class="src src-java">@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann11<span style="color: #4f97d7;">(</span>value=&#29992;&#22312;&#20102;&#36820;&#22238;&#20540;&#19978;<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann11_0<span style="color: #4f97d7;">(</span>value=7<span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</li>


<li><a id="orgf111bc2"></a>解析m1方法参数注解<br />
<div class="outline-text-5" id="text-16-3-3-7">
<p>
用例代码：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Test</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">m7</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">NoSuchMethodException</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">Method</span> <span style="color: #7590db;">method</span> = UseAnnotation11.<span style="color: #4f97d7; font-weight: bold;">class</span>.getMethod<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"m1"</span>, String.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Parameter</span> <span style="color: #7590db;">parameter</span> : method.getParameters<span style="color: #2d9574;">()</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span>String.format<span style="color: #67b11d;">(</span><span style="color: #2d9574;">"&#21442;&#25968;%s&#19978;&#30340;&#27880;&#35299;&#22914;&#19979;:"</span>,parameter.getName<span style="color: #b1951d;">()</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
        <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">Annotation</span> <span style="color: #7590db;">annotation</span> : parameter.getAnnotations<span style="color: #67b11d;">()</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
            System.out.println<span style="color: #67b11d;">(</span>annotation<span style="color: #67b11d;">)</span>;
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
运行输出：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">&#21442;&#25968;arg0&#19978;&#30340;&#27880;&#35299;&#22914;&#19979;</span>:
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann11<span style="color: #4f97d7;">(</span>value=&#29992;&#22312;&#20102;&#21442;&#25968;&#19978;<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann11_0<span style="color: #4f97d7;">(</span>value=8<span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org21de5bc" class="outline-3">
<h3 id="org21de5bc"><span class="section-number-3">16.4</span> @Inherit: 实现类之间的注解继承</h3>
<div class="outline-text-3" id="text-16-4">
</div>
<div id="outline-container-org4358b5a" class="outline-4">
<h4 id="org4358b5a"><span class="section-number-4">16.4.1</span> 用法</h4>
<div class="outline-text-4" id="text-16-4-1">
<p>
首先看一下源码
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Documented</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">ANNOTATION_TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Inherited</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
我们通过@Target元注解的属性可以看出，这个@Inherit是专门用来修饰注解的。
</p>
</div>
<ol class="org-ol">
<li><a id="org21674f0"></a>作用<br />
<div class="outline-text-5" id="text-16-4-1-1">
<p>
让子类可以继承父类中被 <b>@Inherit</b> 修饰的注解，注意是继承父类中的，如果接口中的注解也使用 <b>@Inherit</b> 修饰了，那么接口的实现类是无法继承这个注解的。
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org1b87ec7" class="outline-4">
<h4 id="org1b87ec7"><span class="section-number-4">16.4.2</span> 案例</h4>
<div class="outline-text-4" id="text-16-4-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.*;
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">InheritAnnotationTest</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@Target</span><span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #a45bad;">@Retention</span><span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #a45bad;">@Inherited</span>
    <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">A1</span><span style="color: #bc6ec5;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #a45bad;">@Target</span><span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #a45bad;">@Retention</span><span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #a45bad;">@Inherited</span>
    <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">A2</span><span style="color: #bc6ec5;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #a45bad;">@A1</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@3</span>
    <span style="color: #4f97d7; font-weight: bold;">interface</span> <span style="color: #ce537a; font-weight: bold;">I1</span><span style="color: #bc6ec5;">{}</span>
    <span style="color: #a45bad;">@A2</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@4</span>
    <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">C1</span><span style="color: #bc6ec5;">{}</span>
    <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">C2</span> <span style="color: #4f97d7; font-weight: bold;">extends</span> <span style="color: #ce537a; font-weight: bold;">C1</span> <span style="color: #4f97d7; font-weight: bold;">implements</span> <span style="color: #ce537a; font-weight: bold;">I1</span><span style="color: #bc6ec5;">{}</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@5</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">main</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #2d9574;">[]</span> <span style="color: #7590db;">args</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">Annotation</span> <span style="color: #7590db;">annotation</span> : C2.<span style="color: #4f97d7; font-weight: bold;">class</span>.getAnnotations<span style="color: #67b11d;">()</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@6</span>
            System.out.println<span style="color: #67b11d;">(</span>annotation<span style="color: #67b11d;">)</span>;
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
@1：定义了一个注解A1，上面使用了@Inherited，表示这个具有继承功能
</p>

<p>
@2：定义了一个注解A2，上面使用了@Inherited，表示这个具有继承功能
</p>

<p>
@3：定义接口I1，上面使用了@A1注解
</p>

<p>
@4：定义了一个C1类，使用了A2注解
</p>

<p>
@5：C2继承了C1并且实现了I1接口
</p>

<p>
@6：获取C2上以及从父类继承过来的所有注解，然后输出
</p>
<div class="org-src-container">
<pre class="src src-java">@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.InheritAnnotationTest$A2<span style="color: #4f97d7;">()</span>
</pre>
</div>
<p>
从输出中可以看出类可以继承父类上被@Inherit修饰的注解，而不能继承接口上被@Inherit修饰的注解，这个 <b>一定要要注意！！！！！！</b> 。
</p>
</div>
</div>
</div>

<div id="outline-container-orgac83d7d" class="outline-3">
<h3 id="orgac83d7d"><span class="section-number-3">16.5</span> @Repeatable重复使用注解</h3>
<div class="outline-text-3" id="text-16-5">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann12</span><span style="color: #4f97d7;">{}</span>
<span style="color: #a45bad;">@Ann12</span>
<span style="color: #a45bad;">@Ann12</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation12</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
上面代码会报错，原因是：UseAnnotation12上面重复使用了@Ann12注解，默认情况下@Ann12注解是不允许重复使用的。
</p>

<p>
像上面这样，如果我们想重复使用注解的时候，需要用到 @Repeatable 注解
</p>
</div>
<div id="outline-container-org8227d41" class="outline-4">
<h4 id="org8227d41"><span class="section-number-4">16.5.1</span> 使用步骤</h4>
<div class="outline-text-4" id="text-16-5-1">
</div>
<ol class="org-ol">
<li><a id="orga2f334c"></a>先定义容器注解<br />
<div class="outline-text-5" id="text-16-5-1-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span><span style="color: #a45bad;">ElementType</span>.TYPE, <span style="color: #a45bad;">ElementType</span>.FIELD<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann12s</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">Ann12</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span>; <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
容器注解中必须有个value类型的参数，参数类型为子注解类型的数组。
</p>
</div>
</li>
<li><a id="org4e6df71"></a>为注解指定容器<br />
<div class="outline-text-5" id="text-16-5-1-2">
<p>
要让一个注解可以反复使用，需要在注解上加上@Repeatable注解，@Repeatable中value的值为容器注解，如下代码中的@2
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span><span style="color: #a45bad;">ElementType</span>.TYPE, <span style="color: #a45bad;">ElementType</span>.FIELD<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Repeatable</span><span style="color: #4f97d7;">(</span>Ann12s.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #4f97d7;">)</span><span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Ann12</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">name</span><span style="color: #bc6ec5;">()</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>
<li><a id="org65846fe"></a>使用注解<br />
<div class="outline-text-5" id="text-16-5-1-3">
<p>
重复使用相同的注解有2种方式，如下面代码
</p>
<ol class="org-ol">
<li>重复使用注解，如下面的类上重复使用@Ann12注解</li>
<li>通过容器注解来使用更多个注解，如下面的字段v1上使用@Ann12s容器注解</li>
</ol>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Ann12</span><span style="color: #4f97d7;">(</span>name = <span style="color: #2d9574;">"Java"</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Ann12</span><span style="color: #4f97d7;">(</span>name = <span style="color: #2d9574;">"Spring"</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation12</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@Ann12s</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">{</span><span style="color: #a45bad;">@Ann12</span><span style="color: #67b11d;">(</span>name = <span style="color: #2d9574;">"Java&#39640;&#24182;&#21457;"</span><span style="color: #67b11d;">)</span>,<span style="color: #bc6ec5; font-weight: bold;">@Ann12</span><span style="color: #67b11d;">(</span>name = <span style="color: #2d9574;">"mysql&#39640;&#25163;"</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">}</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">v1</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>
<li><a id="orgacbc32b"></a>获取注解信息<br />
<div class="outline-text-5" id="text-16-5-1-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Test</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">test1</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">NoSuchFieldException</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">Annotation</span><span style="color: #bc6ec5;">[]</span> <span style="color: #7590db;">annotations</span> = UseAnnotation12.<span style="color: #4f97d7; font-weight: bold;">class</span>.getAnnotations<span style="color: #bc6ec5;">()</span>;
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Annotation</span> <span style="color: #7590db;">annotation</span> : annotations<span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span>annotation<span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
    System.out.println<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"-------------"</span><span style="color: #bc6ec5;">)</span>;
    <span style="color: #ce537a; font-weight: bold;">Field</span> <span style="color: #7590db;">v1</span> = UseAnnotation12.<span style="color: #4f97d7; font-weight: bold;">class</span>.getDeclaredField<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"v1"</span><span style="color: #bc6ec5;">)</span>;
    <span style="color: #ce537a; font-weight: bold;">Annotation</span><span style="color: #bc6ec5;">[]</span> <span style="color: #7590db;">declaredAnnotations</span> = v1.getDeclaredAnnotations<span style="color: #bc6ec5;">()</span>;
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">Annotation</span> <span style="color: #7590db;">declaredAnnotation</span> : declaredAnnotations<span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span>declaredAnnotation<span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
运行输出：
</p>
<div class="org-src-container">
<pre class="src src-java">@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann12s<span style="color: #4f97d7;">(</span>value=<span style="color: #bc6ec5;">[</span>@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann12<span style="color: #2d9574;">(</span>name=Java<span style="color: #2d9574;">)</span>,@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann12<span style="color: #2d9574;">(</span>name=Spring&#31995;&#21015;<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>
-------------
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann12s<span style="color: #4f97d7;">(</span>value=<span style="color: #bc6ec5;">[</span>@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann12<span style="color: #2d9574;">(</span>name=Java&#39640;&#24182;&#21457;&#31995;&#21015;<span style="color: #2d9574;">)</span>,@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.Ann12<span style="color: #2d9574;">(</span>name=mysql&#39640;&#25163;&#31995;&#21015;<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">]</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org6181e67" class="outline-3">
<h3 id="org6181e67"><span class="section-number-3">16.6</span> <code>=以上是Java中对注解的支持，下面是spring中对于注解方面的支持=</code></h3>
</div>
<div id="outline-container-org3d8dddb" class="outline-3">
<h3 id="org3d8dddb"><span class="section-number-3">16.7</span> Spring中对于注解方面的支持</h3>
<div class="outline-text-3" id="text-16-7">
</div>
<div id="outline-container-org044f57a" class="outline-4">
<h4 id="org044f57a"><span class="section-number-4">16.7.1</span> 先瞅一个问题</h4>
<div class="outline-text-4" id="text-16-7-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">A1</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">"a"</span>;<span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@0</span>
<span style="color: #4f97d7;">}</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@A1</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">B1</span> <span style="color: #4f97d7;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">"b"</span>;<span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
<span style="color: #4f97d7;">}</span>
<span style="color: #a45bad;">@B1</span><span style="color: #4f97d7;">(</span><span style="color: #2d9574;">"Java"</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@3</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation13</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@Test</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">test1</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">AnnotatedElementUtils&#26159;spring&#25552;&#20379;&#30340;&#19968;&#20010;&#26597;&#25214;&#27880;&#35299;&#30340;&#24037;&#20855;&#31867;</span>
        System.out.println<span style="color: #2d9574;">(</span>AnnotatedElementUtils.getMergedAnnotation<span style="color: #67b11d;">(</span>UseAnnotation13.<span style="color: #4f97d7; font-weight: bold;">class</span>, B1.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
        System.out.println<span style="color: #2d9574;">(</span>AnnotatedElementUtils.getMergedAnnotation<span style="color: #67b11d;">(</span>UseAnnotation13.<span style="color: #4f97d7; font-weight: bold;">class</span>, A1.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
@0：A1注解value参数值默认为a
</p>

<p>
@1：B1注解上使用到了@A1注解
</p>

<p>
@2：B1注解value参数值默认为b
</p>

<p>
@2：UseAnnotation13上面使用了@B1注解，value参数的值为：java
</p>

<p>
test1方法中使用到了spring中的一个类 AnnotatedElementUtils ，通过这个工具类可以很方便的获取注解的各种信息，方法中的2行代码用于获取UseAnnotation13类上B1注解和A1注解的信息。
</p>

<p>
输出结果如下：
</p>
<div class="org-src-container">
<pre class="src src-java">@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.B1<span style="color: #4f97d7;">(</span>value=Java<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.A1<span style="color: #4f97d7;">(</span>value=a<span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
此时有个问题：此时如果想在 UseAnnotation13 上给B1上的A1注解设置值是没有办法的，注解定义无法继承导致的，如果注解定义上面能够继承，那用起来会爽很多，spring通过@Aliasfor方法解决了这个问题。
</p>
</div>
</div>
<div id="outline-container-orgfcb5b54" class="outline-4">
<h4 id="orgfcb5b54"><span class="section-number-4">16.7.2</span> Spring @AliasFor: 对注解进行增强</h4>
<div class="outline-text-4" id="text-16-7-2">
</div>
<ol class="org-ol">
<li><a id="org0e9dd7a"></a>案例1 通过 @AliasFor 解决刚才的难题<br />
<div class="outline-text-5" id="text-16-7-2-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">junit</span>.<span style="color: #ce537a; font-weight: bold;">Test</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">core</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">AliasFor</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">core</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">AnnotatedElementUtils</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">ElementType</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">Retention</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">RetentionPolicy</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">Target</span>;
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">A14</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">"a"</span>;<span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@0</span>
<span style="color: #4f97d7;">}</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@A14</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@6</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">B14</span> <span style="color: #4f97d7;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">"b"</span>;<span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span>annotation = A14.<span style="color: #4f97d7; font-weight: bold;">class</span>, value = <span style="color: #2d9574;">"value"</span><span style="color: #bc6ec5;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@5</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">a14Value</span><span style="color: #bc6ec5;">()</span>;
<span style="color: #4f97d7;">}</span>
<span style="color: #a45bad;">@B14</span><span style="color: #4f97d7;">(</span>value = <span style="color: #2d9574;">"Java"</span>,a14Value = <span style="color: #2d9574;">"&#36890;&#36807;B14&#32473;A14&#30340;value&#21442;&#25968;&#36171;&#20540;"</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@3</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation14</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@Test</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">test1</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">AnnotatedElementUtils&#26159;spring&#25552;&#20379;&#30340;&#19968;&#20010;&#26597;&#25214;&#27880;&#35299;&#30340;&#24037;&#20855;&#31867;</span>
        System.out.println<span style="color: #2d9574;">(</span>AnnotatedElementUtils.getMergedAnnotation<span style="color: #67b11d;">(</span>UseAnnotation14.<span style="color: #4f97d7; font-weight: bold;">class</span>, B14.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
        System.out.println<span style="color: #2d9574;">(</span>AnnotatedElementUtils.getMergedAnnotation<span style="color: #67b11d;">(</span>UseAnnotation14.<span style="color: #4f97d7; font-weight: bold;">class</span>, A14.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
运行输出：
</p>
<div class="org-src-container">
<pre class="src src-java">@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.B14<span style="color: #4f97d7;">(</span>a14Value=&#36890;&#36807;B14&#32473;A14&#30340;value&#21442;&#25968;&#36171;&#20540;, value=Java<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.A14<span style="color: #4f97d7;">(</span>value=&#36890;&#36807;B14&#32473;A14&#30340;value&#21442;&#25968;&#36171;&#20540;<span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
这个相当于给某个注解指定别名，即将B1注解中 a14Value 参数作为 A14 中 value 参数的别名，当给B1的a14Value 设置值的时候，就相当于给 A14的value设置值 ，有个前提是@AliasFor注解的annotation 参数指定的注解需要加载当前注解上面，如：@6
</p>
</div>
</li>
<li><a id="orgdcfccd5"></a>案例2 同一个注解中使用@AliasFor<br />
<div class="outline-text-5" id="text-16-7-2-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">junit</span>.<span style="color: #ce537a; font-weight: bold;">Test</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">core</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">AliasFor</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">core</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">AnnotatedElementUtils</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">ElementType</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">Retention</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">RetentionPolicy</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">Target</span>;
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span><span style="color: #a45bad;">ElementType</span>.TYPE, <span style="color: #a45bad;">ElementType</span>.FIELD<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">A15</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"v2"</span><span style="color: #bc6ec5;">)</span><span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">v1</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">""</span>;
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"v1"</span><span style="color: #bc6ec5;">)</span><span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">v2</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">""</span>;
<span style="color: #4f97d7;">}</span>
<span style="color: #a45bad;">@A15</span><span style="color: #4f97d7;">(</span>v1 = <span style="color: #2d9574;">"&#25105;&#26159;v1"</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@3</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation15</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@A15</span><span style="color: #bc6ec5;">(</span>v2 = <span style="color: #2d9574;">"&#25105;&#26159;v2"</span><span style="color: #bc6ec5;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@4</span>
    <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">name</span>;
    <span style="color: #a45bad;">@Test</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">test1</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">NoSuchFieldException</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">AnnotatedElementUtils&#26159;spring&#25552;&#20379;&#30340;&#19968;&#20010;&#26597;&#25214;&#27880;&#35299;&#30340;&#24037;&#20855;&#31867;</span>
        System.out.println<span style="color: #2d9574;">(</span>AnnotatedElementUtils.getMergedAnnotation<span style="color: #67b11d;">(</span>UseAnnotation15.<span style="color: #4f97d7; font-weight: bold;">class</span>, A15.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
        System.out.println<span style="color: #2d9574;">(</span>AnnotatedElementUtils.getMergedAnnotation<span style="color: #67b11d;">(</span>UseAnnotation15.<span style="color: #4f97d7; font-weight: bold;">class</span>.getDeclaredField<span style="color: #b1951d;">(</span><span style="color: #2d9574;">"name"</span><span style="color: #b1951d;">)</span>, A15.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
注意上面代码，A15注解中（@1和@2）的2个参数都设置了@AliasFor，@AliasFor如果不指定annotation 参数的值，那么 annotation 默认值就是当前注解，所以上面2个属性互为别名，当
给v1设置值的时候也相当于给v2设置值，当给v2设置值的时候也相当于给v1设置值。
</p>

<p>
运行输出：
</p>
<div class="org-src-container">
<pre class="src src-java">@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.A15<span style="color: #4f97d7;">(</span>v1=&#25105;&#26159;v1, v2=&#25105;&#26159;v1<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.A15<span style="color: #4f97d7;">(</span>v1=&#25105;&#26159;v2, v2=&#25105;&#26159;v2<span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
从输出中可以看出v1和v2的值始终是相等的，上面如果同时给v1和v2设置值的时候运行代码会报错。
</p>

<p>
回头来看看@AliasFor的源码:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">METHOD</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Documented</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">AliasFor</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"attribute"</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">""</span>;
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"value"</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">attribute</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">""</span>;
    <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span>? <span style="color: #4f97d7; font-weight: bold;">extends</span> <span style="color: #ce537a; font-weight: bold;">Annotation</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">annotation</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> Annotation.<span style="color: #4f97d7; font-weight: bold;">class</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
AliasFor注解中 value 和 attribute 互为别名，随便设置一个，同时会给另外一个设置相同的值。
</p>
</div>
</li>


<li><a id="org13e1fee"></a>案例3 @AliasFor中不指定value和attribute<br />
<div class="outline-text-5" id="text-16-7-2-3">
<p>
当@AliasFor中不指定value或者attribute的时候，自动将@AliasFor修饰的参数作为value和attribute的值，如下@AliasFor注解的value参数值为name
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">junit</span>.<span style="color: #ce537a; font-weight: bold;">Test</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">core</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">AliasFor</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">core</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">AnnotatedElementUtils</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">ElementType</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">Retention</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">RetentionPolicy</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">Target</span>;
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">A16</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">name</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">"a"</span>;<span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@0</span>
<span style="color: #4f97d7;">}</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@A16</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">B16</span> <span style="color: #4f97d7;">{</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span>annotation = A16.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #bc6ec5;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@5</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">name</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">"b"</span>;<span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
<span style="color: #4f97d7;">}</span>
<span style="color: #a45bad;">@B16</span><span style="color: #4f97d7;">(</span>name=<span style="color: #2d9574;">"&#25105;&#26159;v1"</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@3</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UseAnnotation16</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@Test</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">test1</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">NoSuchFieldException</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">AnnotatedElementUtils&#26159;spring&#25552;&#20379;&#30340;&#19968;&#20010;&#26597;&#25214;&#27880;&#35299;&#30340;&#24037;&#20855;&#31867;</span>
        System.out.println<span style="color: #2d9574;">(</span>AnnotatedElementUtils.getMergedAnnotation<span style="color: #67b11d;">(</span>UseAnnotation16.<span style="color: #4f97d7; font-weight: bold;">class</span>, A16.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
        System.out.println<span style="color: #2d9574;">(</span>AnnotatedElementUtils.getMergedAnnotation<span style="color: #67b11d;">(</span>UseAnnotation16.<span style="color: #4f97d7; font-weight: bold;">class</span>, B16.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
运行输出：
</p>
<div class="org-src-container">
<pre class="src src-java">@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.A16<span style="color: #4f97d7;">(</span>name=&#25105;&#26159;v1<span style="color: #4f97d7;">)</span>
@<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo18</span>.B16<span style="color: #4f97d7;">(</span>name=&#25105;&#26159;v1<span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org021a4ed" class="outline-2">
<h2 id="org021a4ed"><span class="section-number-2">17</span> @Configration和@Bean注解</h2>
<div class="outline-text-2" id="text-17">
</div>
<div id="outline-container-org34df195" class="outline-3">
<h3 id="org34df195"><span class="section-number-3">17.1</span> 前言</h3>
<div class="outline-text-3" id="text-17-1">
<p>
之前我们都是通过xml的方式定义bean，里面会写很多bean元素，然后spring启动的时候，就会读取bean xml配置文件，然后解析这些配置，然后会将这些bean注册到spring容器中，供使用者使用。
jdk1.5里面有了注解的功能，spring也没闲着，觉得注解挺好用的，就将注解加了进来，让我们通过注解的方式来定义bean，用起来能达到xml中定义bean一样的效果，并且更简洁一些，这里面需要用到的
注解就有 @Configuration 注解和 @Bean 注解。
</p>
</div>
</div>
<div id="outline-container-orgff17e6b" class="outline-3">
<h3 id="orgff17e6b"><span class="section-number-3">17.2</span> @Configration注解</h3>
<div class="outline-text-3" id="text-17-2">
</div>
<div id="outline-container-orgc857eea" class="outline-4">
<h4 id="orgc857eea"><span class="section-number-4">17.2.1</span> 用法</h4>
<div class="outline-text-4" id="text-17-2-1">
<p>
@Configuration这个注解可以加在类上，让这个类的功能等同于一个bean xml配置文件，如下：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Configuration</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ConfigBean</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
上面代码类似于xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="color: #4f97d7; font-weight: bold;">xml</span> <span style="color: #9f8766;">version="1.0" encoding="UTF-8"</span>?&gt;
&lt;<span style="color: #bc6ec5; font-weight: bold;">beans</span> <span style="color: #4f97d7;">xmlns</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans"</span>
       <span style="color: #4f97d7;">xmlns</span>:<span style="color: #7590db;">xsi</span>=<span style="color: #2d9574;">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span style="color: #4f97d7;">xsi</span>:<span style="color: #7590db;">schemaLocation</span>=<span style="color: #2d9574;">"http://www.springframework.org/schema/beans</span>
<span style="color: #2d9574;">                           http://www.springframework.org/schema/beans/spring-beans-4.3.xsd"</span>&gt;
&lt;/<span style="color: #bc6ec5; font-weight: bold;">beans</span>&gt;
</pre>
</div>
<p>
通过 AnnotationConfigApplicationContext 来加载 @Configuration 修饰的类，如下：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ce537a; font-weight: bold;">AnnotationConfigApplicationContext</span> <span style="color: #7590db;">context</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">AnnotationConfigApplicationContext</span><span style="color: #4f97d7;">(</span>ConfigBean.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #4f97d7;">)</span>;
</pre>
</div>
<p>
此时ConfigBean类中没有任何内容，相当于一个空的xml配置文件，此时我们要在ConfigBean类中注册bean，那么我们就要用到@Bean注解了。
</p>
</div>
</div>
<div id="outline-container-org369b157" class="outline-4">
<h4 id="org369b157"><span class="section-number-4">17.2.2</span> 总结 @Configuration 使用步骤：</h4>
<div class="outline-text-4" id="text-17-2-2">
<ol class="org-ol">
<li>在类上使用 @Configuration 注解</li>
<li>通过 AnnotationConfigApplicationContext 容器来加 @Configuration 注解修饰的类</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org9e12fa0" class="outline-3">
<h3 id="org9e12fa0"><span class="section-number-3">17.3</span> @Bean注解</h3>
<div class="outline-text-3" id="text-17-3">
</div>
<div id="outline-container-org7e01af7" class="outline-4">
<h4 id="org7e01af7"><span class="section-number-4">17.3.1</span> 用法</h4>
<div class="outline-text-4" id="text-17-3-1">
<p>
这个注解类似于bean xml配置文件中的bean元素，用来在spring容器中注册一个bean。@Bean注解用在方法上，表示通过方法来定义一个bean，默认将方法名称作为bean名称，将方法返回值作为bean对象，注册到spring容器中。
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Bean</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">User</span> <span style="color: #bc6ec5; font-weight: bold;">user1</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">User</span><span style="color: #bc6ec5;">()</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
@Bean注解还有很多属性，我们来看一下其源码：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span><span style="color: #a45bad;">ElementType</span>.METHOD, <span style="color: #a45bad;">ElementType</span>.ANNOTATION_TYPE<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Documented</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Bean</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"name"</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #bc6ec5;">{}</span>;
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"value"</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">name</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #bc6ec5;">{}</span>;
    <span style="color: #a45bad;">@Deprecated</span>
    <span style="color: #ce537a; font-weight: bold;">Autowire</span> <span style="color: #bc6ec5; font-weight: bold;">autowire</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #a45bad;">Autowire</span>.NO;
    <span style="color: #ce537a; font-weight: bold;">boolean</span> <span style="color: #bc6ec5; font-weight: bold;">autowireCandidate</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #a45bad;">true</span>;
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">initMethod</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">""</span>;
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">destroyMethod</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #a45bad;">AbstractBeanDefinition</span>.INFER_METHOD;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
@1：说明这个注解可以用在方法和注解类型上面。
</p>

<p>
每个参数含义：
</p>
<ol class="org-ol">
<li>value和name是一样的，设置的时候，这2个参数只能选一个，原因是@AliasFor导致的@AliasFor这个注解不清楚的可以看这个文章：详解注解</li>
<li>value：字符串数组，第一个值作为bean的名称，其他值作为bean的别名</li>
<li>autowire：这个参数上面标注了@Deprecated，表示已经过期了，不建议使用了</li>
<li>autowireCandidate：是否作为其他对象注入时候的候选bean，之前的文章中专门介绍过这个属性，不清楚的可以去看看：autowire-candidate详解</li>
<li>initMethod：bean初始化的方法，这个和生命周期有关，后面详解</li>
<li>destroyMethod：bean销毁的方法，也是和生命周期相关的，后面详解</li>
</ol>
</div>
</div>

<div id="outline-container-orge6703ed" class="outline-4">
<h4 id="orge6703ed"><span class="section-number-4">17.3.2</span> 案例</h4>
<div class="outline-text-4" id="text-17-3-2">
<p>
User类
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">User</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
Bean配置类：ConfigBean
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">Bean</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">Configuration</span>;
<span style="color: #a45bad;">@Configuration</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ConfigBean</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">bean&#21517;&#31216;&#20026;&#26041;&#27861;&#40664;&#35748;&#20540;&#65306;user1</span>
    <span style="color: #a45bad;">@Bean</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">User</span> <span style="color: #bc6ec5; font-weight: bold;">user1</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">User</span><span style="color: #2d9574;">()</span>;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">bean&#21517;&#31216;&#36890;&#36807;value&#25351;&#23450;&#20102;&#65306;user2Bean</span>
    <span style="color: #a45bad;">@Bean</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"user2Bean"</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">User</span> <span style="color: #bc6ec5; font-weight: bold;">user2</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">User</span><span style="color: #2d9574;">()</span>;
    <span style="color: #bc6ec5;">}</span>
    <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">bean&#21517;&#31216;&#20026;&#65306;user3Bean&#65292;2&#20010;&#21035;&#21517;&#65306;[user3BeanAlias1,user3BeanAlias2]</span>
    <span style="color: #a45bad;">@Bean</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">{</span><span style="color: #2d9574;">"user3Bean"</span>, <span style="color: #2d9574;">"user3BeanAlias1"</span>, <span style="color: #2d9574;">"user3BeanAlias2"</span><span style="color: #2d9574;">}</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">User</span> <span style="color: #bc6ec5; font-weight: bold;">user3</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">User</span><span style="color: #2d9574;">()</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
测试类
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">junit</span>.<span style="color: #ce537a; font-weight: bold;">Test</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">AnnotationConfigApplicationContext</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">util</span>.<span style="color: #ce537a; font-weight: bold;">Arrays</span>;
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ConfigurationTest</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@Test</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">test1</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #ce537a; font-weight: bold;">AnnotationConfigApplicationContext</span> <span style="color: #7590db;">context</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">AnnotationConfigApplicationContext</span><span style="color: #2d9574;">(</span>ConfigBean.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #2d9574;">)</span>;<span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
        <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">beanName</span> : context.getBeanDefinitionNames<span style="color: #67b11d;">()</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
            <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">&#21035;&#21517;</span>
            <span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #67b11d;">[]</span> <span style="color: #7590db;">aliases</span> = context.getAliases<span style="color: #67b11d;">(</span>beanName<span style="color: #67b11d;">)</span>;
            System.out.println<span style="color: #67b11d;">(</span>String.format<span style="color: #b1951d;">(</span><span style="color: #2d9574;">"bean&#21517;&#31216;:%s,&#21035;&#21517;:%s,bean&#23545;&#35937;:%s"</span>,beanName,Arrays.asList<span style="color: #4f97d7;">(</span>aliases<span style="color: #4f97d7;">)</span>,context.getBean<span style="color: #4f97d7;">(</span>beanName<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>;
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
@1：通过 AnnotationConfigApplicationContext 来加载配置类 ConfigBean ，会将配置类中所有的bean注册到spring容器中
</p>

<p>
for循环中输出了bean名称、别名、bean对象
</p>

<p>
输出如下：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">bean&#21517;&#31216;</span>:org.springframework.context.annotation.internalConfigurationAnnotationProcessor,&#21035;&#21517;:<span style="color: #4f97d7;">[]</span>,bean&#23545;&#35937;:<span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.ConfigurationClassPostProcessor@3bd82cf5
bean&#21517;&#31216;:org.springframework.context.annotation.internalAutowiredAnnotationProcessor,&#21035;&#21517;:<span style="color: #4f97d7;">[]</span>,bean&#23545;&#35937;:<span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">beans</span>.<span style="color: #a45bad;">factory</span>.<span style="color: #a45bad;">annotation</span>.AutowiredAnnotationBeanPostProcessor@544fa968
bean&#21517;&#31216;:org.springframework.context.annotation.internalCommonAnnotationProcessor,&#21035;&#21517;:<span style="color: #4f97d7;">[]</span>,bean&#23545;&#35937;:<span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.CommonAnnotationBeanPostProcessor@247bddad
bean&#21517;&#31216;:org.springframework.context.event.internalEventListenerProcessor,&#21035;&#21517;:<span style="color: #4f97d7;">[]</span>,bean&#23545;&#35937;:<span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">event</span>.EventListenerMethodProcessor@d35dea7
bean&#21517;&#31216;:org.springframework.context.event.internalEventListenerFactory,&#21035;&#21517;:<span style="color: #4f97d7;">[]</span>,bean&#23545;&#35937;:<span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">event</span>.DefaultEventListenerFactory@7770f470
bean&#21517;&#31216;:configBean,&#21035;&#21517;:<span style="color: #4f97d7;">[]</span>,bean&#23545;&#35937;:<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo20</span>.ConfigBean$$EnhancerBySpringCGLIB$$dde45976@5e5d171f
bean&#21517;&#31216;:user1,&#21035;&#21517;:<span style="color: #4f97d7;">[]</span>,bean&#23545;&#35937;:<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo20</span>.User@24313fcc
bean&#21517;&#31216;:user2Bean,&#21035;&#21517;:<span style="color: #4f97d7;">[]</span>,bean&#23545;&#35937;:<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo20</span>.User@7d20d0b
bean&#21517;&#31216;:user3Bean,&#21035;&#21517;:<span style="color: #4f97d7;">[</span>user3BeanAlias2, user3BeanAlias1<span style="color: #4f97d7;">]</span>,bean&#23545;&#35937;:<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo20</span>.User@77f1baf5
</pre>
</div>
<p>
从输出中可以看出，有个名称为 configBean 的bean，正是ConfigBean这个类型，可以得出，被@Configuration修饰的类，也被注册到spring容器中了最后3行输出就是几个User的bean对象了。
</p>
</div>
</div>
</div>

<div id="outline-container-org28bf29b" class="outline-3">
<h3 id="org28bf29b"><span class="section-number-3">17.4</span> @Configuration加不加到底区别在哪里呢</h3>
<div class="outline-text-3" id="text-17-4">
<p>
通常情况下bean和bean之间是有依赖关系的。
</p>

<p>
被@Configuration修饰的类，spring容器中会通过cglib给这个类创建一个代理，代理会拦截所有被@Bean修饰的方法，默认情况(bean为单例)下确保这些方法只被调用一次，从而
确保这些bean是同一个bean，即单例的。
</p>
</div>
</div>
</div>

<div id="outline-container-org5d2ef2e" class="outline-2">
<h2 id="org5d2ef2e"><span class="section-number-2">18</span> @ComponentScan,@ComponentScans详解</h2>
<div class="outline-text-2" id="text-18">
</div>
<div id="outline-container-org1eb9956" class="outline-3">
<h3 id="org1eb9956"><span class="section-number-3">18.1</span> 灵魂拷问</h3>
<div class="outline-text-3" id="text-18-1">
<ol class="org-ol">
<li>@ComponetsScan注解是做什么的？</li>
<li>basePackages的方式和basePackageClasses的方式有什么区别？你建议用哪个？为什么？</li>
<li>useDefaultFilters有什么用？</li>
<li>常见的过滤器有哪些？</li>
<li>@ComponetsScan是在哪个类中处理的</li>
</ol>
</div>
</div>
<div id="outline-container-orgc05c3cc" class="outline-3">
<h3 id="orgc05c3cc"><span class="section-number-3">18.2</span> 背景介绍</h3>
<div class="outline-text-3" id="text-18-2">
<p>
目前为止我们知道了两种注册bean的方式
</p>
<ol class="org-ol">
<li>xml中bean元素的方式</li>
<li>@Bean注解标注方法的方式</li>
</ol>

<p>
通常情况下 ，项目中大部分类都需要交给spring去管理，按照上面这两种方式，代码量还是挺大的，为了更方便bean的注册，spring提供了
批量的方式注册bean,方便大量bean批量注册，spring中的@ComponentScan就是干这个事情的。
</p>
</div>
</div>
<div id="outline-container-org1d458d4" class="outline-3">
<h3 id="org1d458d4"><span class="section-number-3">18.3</span> @ComponentScan</h3>
<div class="outline-text-3" id="text-18-3">
<p>
@ComponentScan用于批量注册bean。
</p>

<p>
这个注解会让spring去扫描某些包及其子包中所有的类，然后将满足一定条件的类作为bean注册到spring容器容器中。
</p>

<p>
具体需要扫描哪些包？以及这些包中的类满足什么条件时被注册到容器中，这些都可以通过这个注解中的参数动态配置。
</p>
</div>

<div id="outline-container-orge955255" class="outline-4">
<h4 id="orge955255"><span class="section-number-4">18.3.1</span> 注解的定义</h4>
<div class="outline-text-4" id="text-18-3-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Documented</span>
<span style="color: #a45bad;">@Repeatable</span><span style="color: #4f97d7;">(</span>ComponentScans.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">ComponentScan</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"basePackages"</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #bc6ec5;">{}</span>;
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"value"</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">basePackages</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #bc6ec5;">{}</span>;
    <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span>?<span style="color: #bc6ec5;">&gt;[]</span> <span style="color: #bc6ec5; font-weight: bold;">basePackageClasses</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #bc6ec5;">{}</span>;
    <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span>? <span style="color: #4f97d7; font-weight: bold;">extends</span> <span style="color: #ce537a; font-weight: bold;">BeanNameGenerator</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">nameGenerator</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span>
        BeanNameGenerator.<span style="color: #4f97d7; font-weight: bold;">class</span>;
    <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span>? <span style="color: #4f97d7; font-weight: bold;">extends</span> <span style="color: #ce537a; font-weight: bold;">ScopeMetadataResolver</span><span style="color: #bc6ec5;">&gt;</span> <span style="color: #bc6ec5; font-weight: bold;">scopeResolver</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span>
        AnnotationScopeMetadataResolver.<span style="color: #4f97d7; font-weight: bold;">class</span>;
    <span style="color: #ce537a; font-weight: bold;">ScopedProxyMode</span> <span style="color: #bc6ec5; font-weight: bold;">scopedProxy</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #a45bad;">ScopedProxyMode</span>.DEFAULT;
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">resourcePattern</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">"**/*.class"</span>;
    <span style="color: #ce537a; font-weight: bold;">boolean</span> <span style="color: #bc6ec5; font-weight: bold;">useDefaultFilters</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #a45bad;">true</span>;
    <span style="color: #ce537a; font-weight: bold;">Filter</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">includeFilters</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #bc6ec5;">{}</span>;
    <span style="color: #ce537a; font-weight: bold;">Filter</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">excludeFilters</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #bc6ec5;">{}</span>;
    <span style="color: #ce537a; font-weight: bold;">boolean</span> <span style="color: #bc6ec5; font-weight: bold;">lazyInit</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #a45bad;">false</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
定义上可以看出此注解可以用在任何类型上面，不过我们通常将其用在类上面。
</p>

<p>
常用参数：
</p>
<div class="org-src-container">
<pre class="src src-doc">
value：指定需要扫描的包，如：com.javacode2018

basePackages：作用同value；value和basePackages不能同时存在设置，可二选一

basePackageClasses：指定一些类，spring容器会扫描这些类所在的包及其子包中的类

nameGenerator：自定义bean名称生成器

resourcePattern：需要扫描包中的那些资源，默认是：**/*.class，即会扫描指定包中所有的class文件

useDefaultFilters：对扫描的类是否启用默认过滤器，默认为true

includeFilters：过滤器：用来配置被扫描出来的那些类会被作为组件注册到容器中

excludeFilters：过滤器，和includeFilters作用刚好相反，用来对扫描的类进行排除的，被排除的类不会被注册到容器中

lazyInit：是否延迟初始化被注册的bean

@1：@Repeatable(ComponentScans.class)，这个注解可以同时使用多个。

</pre>
</div>
<p>
@ComponentScan工作的过程：
</p>
<ol class="org-ol">
<li>Spring会扫描指定的包，且会递归下面子包，得到一批类的数组</li>
<li>然后这些类会经过上面的各种过滤器，最后剩下的类会被注册到容器中</li>
</ol>

<p>
第一：需要扫描哪些包？通过 value、backPackages、basePackageClasses 这3个参数来控制
</p>

<p>
第二：过滤器有哪些？通过 useDefaultFilters、includeFilters、excludeFilters 这3个参数来控制过滤器
</p>

<p>
默认情况下，任何参数都不设置的情况下，此时，会将@ComponentScan修饰的类所在的包作为扫描包；默认情况下useDefaultFilters为true，
这个为true的时候，spring容器内部会使用默认过滤器，规则是：凡是类上有 @Repository、@Service、@Controller、@Component 这几个注解中的任何一
个的，那么这个类就会被作为bean注册到spring容器中，所以默认情况下，只需在类上加上这几个注解中的任何一个，这些类就会自动交给spring容器来管理了。
</p>
</div>
</div>
</div>

<div id="outline-container-orgc295a68" class="outline-3">
<h3 id="orgc295a68"><span class="section-number-3">18.4</span> @Component,@Repository,@Service,@Controller</h3>
<div class="outline-text-3" id="text-18-4">
<p>
这几个注解都是spring提供的。
</p>
</div>

<div id="outline-container-orgdc916df" class="outline-4">
<h4 id="orgdc916df"><span class="section-number-4">18.4.1</span> @Component注解</h4>
<div class="outline-text-4" id="text-18-4-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Documented</span>
<span style="color: #a45bad;">@Indexed</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Component</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">""</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
从定义中可以看出，这个注解可以用在任何类型上面。通常情况下将这个注解用在类上面，标注这个类为一个组件，
默认情况下，被扫描的时候会被作为bean注册到容器中。value参数：被注册为bean的时候，用来指定bean的名称，如果不指定，
默认为类名首字母小写。如：类UserService对应的beanname为userService
</p>
</div>
</div>
<div id="outline-container-org8ec2521" class="outline-4">
<h4 id="org8ec2521"><span class="section-number-4">18.4.2</span> @Repository注解</h4>
<div class="outline-text-4" id="text-18-4-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span><span style="color: #a45bad;">ElementType</span>.TYPE<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Documented</span>
<span style="color: #a45bad;">@Component</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Repository</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span>annotation = Component.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">""</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
Repository上面有@Component注解。value参数上面有 @AliasFor(annotation = Component.class) ，
设置value参数的时候，也相当于给 @Component 注解中的value设置值。
</p>
</div>
</div>
<div id="outline-container-org5a25609" class="outline-4">
<h4 id="org5a25609"><span class="section-number-4">18.4.3</span> @Service和@Controller注解源码和@Respository源码类似</h4>
</div>
<div id="outline-container-org4553381" class="outline-4">
<h4 id="org4553381"><span class="section-number-4">18.4.4</span> 总结</h4>
<div class="outline-text-4" id="text-18-4-4">
<p>
这4个注解本质上是没有任何差别，都可以用在类上面，表示这个类被spring容器扫描的时候，可以作为一个bean组件注册到spring容器中。
spring容器中对这4个注解的解析并没有进行区分，统一采用 @Component 注解的方式进行解析，所以这几个注解之间可以相互替换。
spring提供这4个注解，是为了让系统更清晰，通常情况下，系统是分层结构的，多数系统一般分为controller层、service层、dao层。
@controller通常用来标注controller层组件，@service注解标注service层的组件，@Repository标注dao层的组件，
这样可以让整个系统的结构更清晰，当看到这些注解的时候，会和清晰的知道属于哪个层，对于spring来说，
将这3个注解替换成@Component注解，对系统没有任何影响，产生的效果是一样的。
</p>
</div>
</div>
</div>

<div id="outline-container-org1c42401" class="outline-3">
<h3 id="org1c42401"><span class="section-number-3">18.5</span> 案例</h3>
<div class="outline-text-3" id="text-18-5">
</div>
<div id="outline-container-orgf4d493b" class="outline-4">
<h4 id="orgf4d493b"><span class="section-number-4">18.5.1</span> 案例1：任何参数未设置</h4>
<div class="outline-text-4" id="text-18-5-1">
<p>
UserController.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">stereotype</span>.<span style="color: #ce537a; font-weight: bold;">Controller</span>;
<span style="color: #a45bad;">@Controller</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UserController</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
UserService.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">stereotype</span>.<span style="color: #ce537a; font-weight: bold;">Service</span>;
<span style="color: #a45bad;">@Service</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UserService</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
UserDao.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">stereotype</span>.<span style="color: #ce537a; font-weight: bold;">Repository</span>;
<span style="color: #a45bad;">@Repository</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UserDao</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
UserModel.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Component</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UserModel</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
上面几个类中，分别使用了4种注解
</p>

<p>
@ComponentScan修饰的类(最外层)
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">ComponentScan</span>;
<span style="color: #a45bad;">@ComponentScan</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ScanBean1</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
测试用例
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo22</span>.<span style="color: #a45bad;">test1</span>.<span style="color: #ce537a; font-weight: bold;">ScanBean1</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">junit</span>.<span style="color: #ce537a; font-weight: bold;">Test</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">AnnotationConfigApplicationContext</span>;
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ComponentScanTest</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@Test</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">test1</span><span style="color: #bc6ec5;">()</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #ce537a; font-weight: bold;">AnnotationConfigApplicationContext</span> <span style="color: #7590db;">context</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">AnnotationConfigApplicationContext</span><span style="color: #2d9574;">(</span>ScanBean1.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #2d9574;">)</span>;
        <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">beanName</span> : context.getBeanDefinitionNames<span style="color: #67b11d;">()</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
            System.out.println<span style="color: #67b11d;">(</span>beanName + <span style="color: #2d9574;">"-&gt;"</span> + context.getBean<span style="color: #b1951d;">(</span>beanName<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>;
        <span style="color: #2d9574;">}</span>
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
@1：使用AnnotationConfigApplicationContext作为ioc容器，将 ScanBean 作为参数传入。
</p>

<p>
默认会扫描 ScanBean 类所在的包中的所有类，类上有@Component、@Repository、@Service、@Controller任何一个注解的都会被注册到容器中
</p>
</div>
</div>

<div id="outline-container-org07e1385" class="outline-4">
<h4 id="org07e1385"><span class="section-number-4">18.5.2</span> 案例2： 指定需要扫描的包</h4>
<div class="outline-text-4" id="text-18-5-2">
<p>
指定需要扫描哪些包，可以通过value或者basePackage来配置，二者选其一，都配置运行会报错，下面我们通过value来配置。
</p>

<p>
ScanBean2.java
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">ComponentScan</span>;
<span style="color: #a45bad;">@ComponentScan</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span><span style="color: #2d9574;">"com.demo22.test1.controller"</span>,<span style="color: #2d9574;">"com.demo22.test1.service"</span><span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ScanBean2</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
上面指定了2需要扫描的包，这两个包中有2个类。
</p>
</div>

<ol class="org-ol">
<li><a id="org0912575"></a>测试用例<br />
<div class="outline-text-5" id="text-18-5-2-1">
<p>
ComponentScanTest中新增两个方法
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Test</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">test2</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">AnnotationConfigApplicationContext</span> <span style="color: #7590db;">context</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">AnnotationConfigApplicationContext</span><span style="color: #bc6ec5;">(</span>ScanBean2.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">beanName</span> : context.getBeanDefinitionNames<span style="color: #2d9574;">()</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span>beanName + <span style="color: #2d9574;">"-&gt;"</span> + context.getBean<span style="color: #67b11d;">(</span>beanName<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>
<li><a id="orgb59dc7c"></a>运行输出<br />
<div class="outline-text-5" id="text-18-5-2-2">
<p>
可以看出只有controller包和service包中的2个类被注册为bean了。
</p>
</div>
</li>
<li><a id="orgd94e410"></a>注意<br />
<div class="outline-text-5" id="text-18-5-2-3">
<p>
指定包名的方式扫描存在的一个隐患，若包被重名了，会导致扫描会失效，一般情况下面我们使用basePackageClasses的方式来指定需要扫描的包，这个参数
可以指定一些类型，默认会扫描这些类所在的包及其子包中所有的类，这种方式可以有效避免这种问题。
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org0577b6e" class="outline-4">
<h4 id="org0577b6e"><span class="section-number-4">18.5.3</span> 案例3：basePackageClasses指定扫描范围</h4>
<div class="outline-text-4" id="text-18-5-3">
<p>
我们可以在需要扫描的包中定义一个标记的接口或者类，他们的唯一的作用是作为basePackageClasses的值，其他没有任何用途。
</p>

<p>
定义接口
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">interface</span> <span style="color: #ce537a; font-weight: bold;">ScanClass</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
定义两个类
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">stereotype</span>.<span style="color: #ce537a; font-weight: bold;">Component</span>;
<span style="color: #a45bad;">@Component</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">Service1</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>



<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">stereotype</span>.<span style="color: #ce537a; font-weight: bold;">Component</span>;
<span style="color: #a45bad;">@Component</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">Service2</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
@ComponentScan标记的类
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">ComponentScan</span>;
<span style="color: #a45bad;">@ComponentScan</span><span style="color: #4f97d7;">(</span>basePackageClasses = ScanClass.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ScanBean6</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
测试用例
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Test</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">test6</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">AnnotationConfigApplicationContext</span> <span style="color: #7590db;">context</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">AnnotationConfigApplicationContext</span><span style="color: #bc6ec5;">(</span>ScanBean6.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #7590db;">beanName</span> : context.getBeanDefinitionNames<span style="color: #2d9574;">()</span><span style="color: #bc6ec5;">)</span> <span style="color: #bc6ec5;">{</span>
        System.out.println<span style="color: #2d9574;">(</span>beanName + <span style="color: #2d9574;">"-&gt;"</span> + context.getBean<span style="color: #67b11d;">(</span>beanName<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
运行输出
</p>
<div class="org-src-container">
<pre class="src src-java">service1-&gt;<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo22</span>.<span style="color: #a45bad;">test6</span>.<span style="color: #a45bad;">beans</span>.Service1@79924b
service2-&gt;<span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo22</span>.<span style="color: #a45bad;">test6</span>.<span style="color: #a45bad;">beans</span>.Service2@7b9a4292
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org561101e" class="outline-3">
<h3 id="org561101e"><span class="section-number-3">18.6</span> includeFilters的使用</h3>
<div class="outline-text-3" id="text-18-6">
</div>
<div id="outline-container-orgcbdb167" class="outline-4">
<h4 id="orgcbdb167"><span class="section-number-4">18.6.1</span> 用法</h4>
<div class="outline-text-4" id="text-18-6-1">
<p>
includeFilters参数的定义：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #ce537a; font-weight: bold;">Filter</span><span style="color: #4f97d7;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">includeFilters</span><span style="color: #4f97d7;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #4f97d7;">{}</span>;
</pre>
</div>
<p>
是一个 Filter 类型的数组，多个Filter之间为或者关系，即满足任意一个就可以了，看一下 Filter 的代码：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{}</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">Filter</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #ce537a; font-weight: bold;">FilterType</span> <span style="color: #bc6ec5; font-weight: bold;">type</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #a45bad;">FilterType</span>.ANNOTATION;
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"classes"</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span>?<span style="color: #bc6ec5;">&gt;[]</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #bc6ec5;">{}</span>;
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"value"</span><span style="color: #bc6ec5;">)</span>
    <span style="color: #ce537a; font-weight: bold;">Class</span><span style="color: #bc6ec5;">&lt;</span>?<span style="color: #bc6ec5;">&gt;[]</span> <span style="color: #bc6ec5; font-weight: bold;">classes</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #bc6ec5;">{}</span>;
    <span style="color: #ce537a; font-weight: bold;">String</span><span style="color: #bc6ec5;">[]</span> <span style="color: #bc6ec5; font-weight: bold;">pattern</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #bc6ec5;">{}</span>;  <span style="color: #4f97d7;">}</span>

</pre>
</div>
<p>
可以看出Filter也是一个注解，参数：
</p>

<p>
type：过滤器的类型，是个枚举类型，5种类型
</p>

<p>
ANNOTATION：通过注解的方式来筛选候选者，即判断候选者是否有指定的注解
</p>

<p>
ASSIGNABLE<sub>TYPE</sub>：通过指定的类型来筛选候选者，即判断候选者是否是指定的类型
</p>

<p>
ASPECTJ：ASPECTJ表达式方式，即判断候选者是否匹配ASPECTJ表达式
</p>

<p>
REGEX：正则表达式方式，即判断候选者的完整名称是否和正则表达式匹配
</p>

<p>
CUSTOM：用户自定义过滤器来筛选候选者，对候选者的筛选交给用户自己来判断
</p>

<p>
value：和参数classes效果一样，二选一
</p>

<p>
classes：3种情况如下
</p>

<p>
当type=FilterType.ANNOTATION时，通过classes参数可以指定一些注解，用来判断被扫描的类上是否有classes参数指定的注解
</p>

<p>
当type=FilterType.ASSIGNABLE<sub>TYPE时</sub>，通过classes参数可以指定一些类型，用来判断被扫描的类是否是classes参数指定的类型
</p>

<p>
当type=FilterType.CUSTOM时，表示这个过滤器是用户自定义的，classes参数就是用来指定用户自定义的过滤器，自定义的过滤器需要实现org.springframework.core.type.filter.TypeFilter接口
</p>

<p>
pattern：2种情况如下
</p>

<p>
当type=FilterType.ASPECTJ时，通过pattern来指定需要匹配的ASPECTJ表达式的值
</p>

<p>
当type=FilterType.REGEX时，通过pattern来自正则表达式的值
</p>
</div>
</div>

<div id="outline-container-org1f59671" class="outline-4">
<h4 id="org1f59671"><span class="section-number-4">18.6.2</span> 案例：扫描包含注解的类</h4>
<div class="outline-text-4" id="text-18-6-2">
</div>
<ol class="org-ol">
<li><a id="org6e64aeb"></a>需求<br />
<div class="outline-text-5" id="text-18-6-2-1">
<p>
我们自定义一个注解，让标注有这些注解的类自动注册到容器中
</p>
</div>
</li>
<li><a id="org841aaaf"></a>代码实现<br />
<div class="outline-text-5" id="text-18-6-2-2">
<p>
定义一个注解
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">lang</span>.<span style="color: #a45bad;">annotation</span>.*;
<span style="color: #a45bad;">@Documented</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">MyBean</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
创建一个类，使用这个注解标注
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@MyBean</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">Service1</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
再来一个类，使用spring中的 @Compontent 标注
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">stereotype</span>.<span style="color: #ce537a; font-weight: bold;">Component</span>;
<span style="color: #a45bad;">@Component</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">Service2</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>

</pre>
</div>
<p>
再来一个类，使用@CompontentScan标注
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">ComponentScan</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">FilterType</span>;
<span style="color: #a45bad;">@ComponentScan</span><span style="color: #4f97d7;">(</span>includeFilters = <span style="color: #bc6ec5;">{</span>
        @<span style="color: #a45bad;">ComponentScan</span>.Filter<span style="color: #2d9574;">(</span>type = <span style="color: #a45bad;">FilterType</span>.ANNOTATION, classes = MyBean.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #2d9574;">)</span>
<span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ScanBean3</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
上面指定了Filter的type为注解的类型，只要类上面有 @MyBean 注解的，都会被作为bean注册到容器中
</p>
</div>
</li>

<li><a id="orgb604f87"></a>扩展：自定义注解支持定义bean名称<br />
<div class="outline-text-5" id="text-18-6-2-3">
<p>
上面的自定义的@MyBean注解，是无法指定bean的名称的，可以对这个注解做一下改造，加个value参
数来指定bean的名称，如下：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@Documented</span>
<span style="color: #a45bad;">@Target</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">ElementType</span>.<span style="color: #ce537a; font-weight: bold;">TYPE</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Retention</span><span style="color: #4f97d7;">(</span><span style="color: #a45bad;">RetentionPolicy</span>.<span style="color: #ce537a; font-weight: bold;">RUNTIME</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@Component</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">@interface</span> <span style="color: #ce537a; font-weight: bold;">MyBean</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #a45bad;">@AliasFor</span><span style="color: #bc6ec5;">(</span>annotation = Component.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #bc6ec5;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@2</span>
    <span style="color: #ce537a; font-weight: bold;">String</span> <span style="color: #bc6ec5; font-weight: bold;">value</span><span style="color: #bc6ec5;">()</span> <span style="color: #4f97d7; font-weight: bold;">default</span> <span style="color: #2d9574;">""</span>; <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@3</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
重点在于@1和@2这2个地方的代码，通过上面的参数可以间接给@Component注解中的value设
置值。这块用到了@AliasFor注解，
</p>
</div>
</li>

<li><a id="org0ca6648"></a>自定义Filter案例<br />
<ol class="org-ol">
<li><a id="org87a5f3f"></a>需求<br />
<div class="outline-text-6" id="text-18-6-2-4-1">
<p>
我们来个自定义的Filter，判断被扫描的类如果是 IService 接口类型的，就让其注册到容器中。
</p>
</div>
</li>
<li><a id="org6a98f42"></a>代码实现<br />
<div class="outline-text-6" id="text-18-6-2-4-2">
<p>
来个自定义的TypeFilter类
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">com</span>.<span style="color: #a45bad;">javacode2018</span>.<span style="color: #a45bad;">lesson001</span>.<span style="color: #a45bad;">demo22</span>.<span style="color: #a45bad;">test4</span>.<span style="color: #ce537a; font-weight: bold;">IService</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">core</span>.<span style="color: #a45bad;">type</span>.<span style="color: #ce537a; font-weight: bold;">ClassMetadata</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">core</span>.<span style="color: #a45bad;">type</span>.<span style="color: #a45bad;">classreading</span>.<span style="color: #ce537a; font-weight: bold;">MetadataReader</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">core</span>.<span style="color: #a45bad;">type</span>.<span style="color: #a45bad;">classreading</span>.<span style="color: #ce537a; font-weight: bold;">MetadataReaderFactory</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">core</span>.<span style="color: #a45bad;">type</span>.<span style="color: #a45bad;">filter</span>.<span style="color: #ce537a; font-weight: bold;">TypeFilter</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">java</span>.<span style="color: #a45bad;">io</span>.<span style="color: #ce537a; font-weight: bold;">IOException</span>;
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">MyFilter</span> <span style="color: #4f97d7; font-weight: bold;">implements</span> <span style="color: #ce537a; font-weight: bold;">TypeFilter</span> <span style="color: #4f97d7;">{</span>
    <span style="color: #9f8766;">/**</span>
<span style="color: #9f8766;">     *</span><span style="color: #a45bad;">@param</span><span style="color: #9f8766;"> metadataReader</span>
<span style="color: #9f8766;">     *</span><span style="color: #a45bad;">@param</span><span style="color: #9f8766;"> metadataReaderFactory</span>
<span style="color: #9f8766;">     *</span><span style="color: #a45bad;">@return</span>
<span style="color: #9f8766;">     *</span><span style="color: #a45bad;">@throws</span><span style="color: #9f8766;"> IOException</span>
<span style="color: #9f8766;">     */</span>
    <span style="color: #a45bad;">@Override</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">boolean</span> <span style="color: #bc6ec5; font-weight: bold;">match</span><span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">MetadataReader</span> <span style="color: #7590db;">metadataReader</span>, <span style="color: #ce537a; font-weight: bold;">MetadataReaderFactory</span> <span style="color: #7590db;">metadataReaderFactory</span><span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7; font-weight: bold;">throws</span> <span style="color: #ce537a; font-weight: bold;">IOException</span> <span style="color: #bc6ec5;">{</span>
        <span style="color: #ce537a; font-weight: bold;">Class</span> <span style="color: #7590db;">curClass</span> = <span style="color: #a45bad;">null</span>;
        <span style="color: #4f97d7; font-weight: bold;">try</span> <span style="color: #2d9574;">{</span>
            <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">&#24403;&#21069;&#34987;&#25195;&#25551;&#30340;&#31867;</span>
            curClass = Class.forName<span style="color: #67b11d;">(</span>metadataReader.getClassMetadata<span style="color: #b1951d;">()</span>.getClassName<span style="color: #b1951d;">()</span><span style="color: #67b11d;">)</span>;
        <span style="color: #2d9574;">}</span> <span style="color: #4f97d7; font-weight: bold;">catch</span> <span style="color: #2d9574;">(</span><span style="color: #ce537a; font-weight: bold;">ClassNotFoundException</span> <span style="color: #7590db;">e</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">{</span>
            e.printStackTrace<span style="color: #67b11d;">()</span>;
        <span style="color: #2d9574;">}</span>
        <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">&#21028;&#26029;curClass&#26159;&#21542;&#26159;IService&#31867;&#22411;</span>
        <span style="color: #ce537a; font-weight: bold;">boolean</span> <span style="color: #7590db;">result</span> = IService.<span style="color: #4f97d7; font-weight: bold;">class</span>.isAssignableFrom<span style="color: #2d9574;">(</span>curClass<span style="color: #2d9574;">)</span>;
        <span style="color: #4f97d7; font-weight: bold;">return</span> result;
    <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>

</pre>
</div>
<p>
来个@ComponetScan标注的类
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">ComponentScan</span>;
<span style="color: #4f97d7; font-weight: bold;">import</span> <span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.<span style="color: #ce537a; font-weight: bold;">FilterType</span>;
<span style="color: #a45bad;">@ComponentScan</span><span style="color: #4f97d7;">(</span>basePackages = <span style="color: #bc6ec5;">{</span><span style="color: #2d9574;">"com.demo22.test4"</span><span style="color: #bc6ec5;">}</span>,useDefaultFilters = <span style="color: #a45bad;">false</span>, <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">&#19981;&#21551;&#29992;&#40664;&#35748;&#36807;&#28388;&#22120;</span>
               includeFilters = <span style="color: #bc6ec5;">{</span>@<span style="color: #a45bad;">ComponentScan</span>.Filter<span style="color: #2d9574;">(</span>type = <span style="color: #a45bad;">FilterType</span>.CUSTOM, classes =MyFilter.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #2d9574;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">@1 })</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> ScanBean5 <span style="color: #2d9574;">{</span>
<span style="color: #2d9574;">}</span>

</pre>
</div>
<p>
@1：type为FilterType.CUSTOM，表示Filter是用户自定义的，classes为自定义的过滤器
</p>
</div>
</li>
</ol>
</li>

<li><a id="org30695cb"></a>excludeFilters<br />
<div class="outline-text-5" id="text-18-6-2-5">
<p>
配置排除的过滤器，满足这些过滤器的类不会被注册到容器中
</p>
</div>
</li>
<li><a id="org977a143"></a>@ComponentScan重复使用<br />
<div class="outline-text-5" id="text-18-6-2-6">
<p>
从这个注解的定义上可以看出这个注解可以同时使用多个
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@ComponentScan</span><span style="color: #4f97d7;">(</span>basePackageClasses = ScanClass.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #4f97d7;">)</span>
<span style="color: #a45bad;">@ComponentScan</span><span style="color: #4f97d7;">(</span>
               useDefaultFilters = <span style="color: #a45bad;">false</span>, <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">&#19981;&#21551;&#29992;&#40664;&#35748;&#36807;&#28388;&#22120;</span>
               includeFilters = <span style="color: #bc6ec5;">{</span>
                   @<span style="color: #a45bad;">ComponentScan</span>.Filter<span style="color: #2d9574;">(</span>type = <span style="color: #a45bad;">FilterType</span>.ASSIGNABLE_TYPE, classes=IService.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #2d9574;">)</span>
               <span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ScanBean7</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
<p>
还有一种写法
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@ComponentScans</span><span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">{</span>
        <span style="color: #a45bad;">@ComponentScan</span><span style="color: #2d9574;">(</span>basePackageClasses = ScanClass.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #2d9574;">)</span>,
        <span style="color: #bc6ec5; font-weight: bold;">@ComponentScan</span><span style="color: #2d9574;">(</span>
                       useDefaultFilters = <span style="color: #a45bad;">false</span>, <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">&#19981;&#21551;&#29992;&#40664;&#35748;&#36807;&#28388;&#22120;</span>
                       includeFilters = <span style="color: #67b11d;">{</span>@<span style="color: #a45bad;">ComponentScan</span>.Filter<span style="color: #b1951d;">(</span>type = <span style="color: #a45bad;">FilterType</span>.ASSIGNABLE_TYPE,classes = IService.<span style="color: #4f97d7; font-weight: bold;">class</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">}</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">ScanBean7</span> <span style="color: #4f97d7;">{</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>
</div>
</li>

<li><a id="orgf80d04e"></a>spring中这一块的源码<br />
<div class="outline-text-5" id="text-18-6-2-7">
<p>
@ComponetScan注解是被下面这个类处理的
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">org</span>.<span style="color: #a45bad;">springframework</span>.<span style="color: #a45bad;">context</span>.<span style="color: #a45bad;">annotation</span>.ConfigurationClassPostProcessor
</pre>
</div>
<p>
这个类非常非常关键，主要用户bean的注册，前面我们介绍的@Configuration,@Bean注解也是被这个类处理的。
</p>

<p>
还有下面这些注解
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a45bad;">@PropertySource</span>
<span style="color: #a45bad;">@Import</span>
<span style="color: #a45bad;">@ImportResource</span>
<span style="color: #a45bad;">@Compontent</span>
</pre>
</div>
<p>
以上这些注解都是被ConfigurationClassPostProcessor这个类处理的，内部会递归处理这些注解，完成bean的注册。
</p>

<p>
以@CompontentScan来说一下过程，第一次扫描之后会得到一批需要注册的类，然后会对这些需要注册的类进行遍历，判断是否有上面任意一个注解，如果有，会将这个类交给
ConfigurationClassPostProcessor继续处理，直到递归完成所有bean的注册。
</p>

<p>
<b>想成为高手，这个类是必看的。</b>
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org131a58c" class="outline-3">
<h3 id="org131a58c"><span class="section-number-3">18.7</span> 总结</h3>
<div class="outline-text-3" id="text-18-7">
<ol class="org-ol">
<li>@ComponentScan用于批量注册bean，spring会按照这个注解的配置，递归扫描指定包中的所有类，将满足条件的类批量注册到spring容器中</li>
<li>可以通过value、basePackages、basePackageClasses 这几个参数来配置包的扫描范围</li>
<li>可以通过useDefaultFilters、includeFilters、excludeFilters这几个参数来配置类的过滤器，被过滤器处理之后剩下的类会被注册到容器中</li>
<li>指定包名的方式配置扫描范围存在隐患，包名被重命名之后，会导致扫描实现，所以一般我们在需要扫描的包中可以创建一个标记的接口或者类，作为basePackageClasses的值，通过这个来控制包的扫描范围</li>
<li>@CompontScan注解会被ConfigurationClassPostProcessor类递归处理，最终得到所有需要注册的类。</li>
</ol>




<div id="org01da25d" class="figure">
<p><img src=" ../image/phoneIcon.png" alt="phoneIcon.png" />
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: CONGPEITONG</p>
<p class="date">Created: 2022-07-08 Fri 17:26</p>
</div>
</body>
</html>
